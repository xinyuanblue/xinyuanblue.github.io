<!DOCTYPE html>
<html lang="zh" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="河洛书苑 - 洛阳城市书房项目">
    <meta name="keywords" content="河洛书苑,城市书房,洛阳,阅读,文化">
    <meta name="baidu-site-verification" content="codeva-6ruBzPj1CN" />
    <title>河洛书苑生长笔记</title>

<!-- Favicon 链接 - 开始 -->
<!-- 优先使用 PNG 图标 (确保 static/favicon.png 存在且已压缩) -->
<link rel="icon" href="static/favicon.png" type="image/png">

<!-- 保留 ICO 作为备用和兼容旧版浏览器 (确保 static/favicon.ico 存在) -->
<link rel="shortcut icon" href="static/favicon.ico">

<!-- 同时添加标准的 icon 链接指向 ICO，增强兼容性 -->
<link rel="icon" href="static/favicon.ico" type="image/x-icon">
<!-- Favicon 链接 - 结束 -->

    <link rel="stylesheet" href="static/css/style.css">
    <!-- 添加字体图标库 -->
    <link rel="stylesheet" href="static/vendor/fontawesome/css/all.min.css">
    <script src="static/js/translations.js"></script>
    <script src="static/vendor/plotly/plotly-2.27.1.min.js"></script>
<style>
  /* 基础样式 */
  * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2ecc71;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --navbar-bg: rgba(255, 255, 255, 0.9);
            --navbar-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --font-size-base: 16px;
            --line-height: 1.6;
            --transition-speed: 0.3s;
            --font-size-base: 16px;
            --line-height-base: 1.6;
            --focus-outline-color: #2ecc71;
            --focus-outline-width: 3px;
        }

        /* 无障碍模式变量 */
        body.accessibility-mode {
            --primary-color: #0066cc;
            --text-color: #000;
            --bg-color: #fff;
            --navbar-bg: rgba(255, 255, 255, 1);
            --navbar-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            --font-size-base: 18px;
            --line-height: 1.8;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: var(--line-height);
            font-size: var(--font-size-base);
            transition: all 0.3s ease;
        }

        /* 内容容器 */
        .content-container {
            margin-top: 20px;
            min-height: calc(100vh - 40px);
        }

        /* 新的简化版无障碍按钮 */
        .accessibility-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: var(--navbar-bg);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .accessibility-buttons button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .accessibility-buttons button[aria-pressed="true"] {
            background: var(--primary-color);
            color: var(--bg-color);
        }

        .accessibility-buttons button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .accessibility-buttons button i {
            font-size: 1.2em;
        }

        /* 字体大小控制 */
        body.font-size-large {
            --font-size-base: 20px;
        }

        body.font-size-larger {
            --font-size-base: 22px;
        }

        /* 高对比度模式 */
        :root[class~="high-contrast"] {
            --primary-color: #ffff00;
            --text-color: #ffffff;
            --bg-color: #000000;
            --navbar-bg: #000000;
            --navbar-shadow: 0 2px 10px rgba(255, 255, 255, 0.2);
        }

        /* 高对比度模式下的输入框和文本框样式 */
        :root[class~="high-contrast"] input,
        :root[class~="high-contrast"] textarea,
        :root[class~="high-contrast"] select,
        :root[class~="high-contrast"] .input-card,
        :root[class~="high-contrast"] .input-item,
        :root[class~="high-contrast"] .amap-info-content,
        :root[class~="high-contrast"] .amap-info-outer {
            background-color: #000000 !important;
            color: #ffffff !important;
            border: 1px solid #ffff00 !important;
        }

        :root[class~="high-contrast"] .btn {
            background-color: #333333 !important;
            color: #ffff00 !important;
            border: 1px solid #ffff00 !important;
        }

        :root[class~="high-contrast"] .btn:hover,
        :root[class~="high-contrast"] .btn.active {
            background-color: #ffff00 !important;
            color: #000000 !important;
        }

        :root[class~="high-contrast"] .stat-item,
        :root[class~="high-contrast"] .feature-card,
        :root[class~="high-contrast"] .timeline-card,
        :root[class~="high-contrast"] .problem-item,
        :root[class~="high-contrast"] .dialogue-box {
            background-color: #333333 !important;
            color: #ffffff !important;
            border: 1px solid #ffff00 !important;
        }

        /* 高对比度模式下的链接和按钮 */
        :root[class~="high-contrast"] a {
            color: #ffff00 !important;
            text-decoration: underline !important;
        }

        /* 焦点样式 */
        a:focus, button:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 3px;
        }

        /* 无障碍增强样式 */
        [data-theme="high-contrast"] {
            --primary-color: #ffff00;
            --text-color: #ffffff;
            --bg-color: #000000;
            --navbar-bg: rgba(0, 0, 0, 0.9);
        }

        /* 大字体模式 */
        :root[data-font-size="large"] {
            --font-size-base: 20px;
        }

        :root[data-font-size="x-large"] {
            --font-size-base: 24px;
        }

        /* 行高增强模式 */
        :root[data-line-height="increased"] {
            --line-height: 2;
        }

        /* 焦点样式增强 */
        *:focus {
            outline: var(--focus-outline-width) solid var(--focus-outline-color);
            outline-offset: 2px;
        }

        /* 语言切换按钮样式 */
        .language-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
        }

        .language-switch button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-switch button.active {
            background: var(--primary-color);
            color: white;
        }

        .language-switch button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .language-switch button i {
            font-size: 1.2em;
            margin-right: 2px;
        }

        .lang-text {
            font-size: 0.8em;
            font-weight: bold;
        }

        /* 响应式设计增强 */
        @media (max-width: 768px) {
            .accessibility-buttons {
                bottom: 10px;
                right: 10px;
                flex-direction: row;
                flex-wrap: wrap;
            }

            .language-switch {
                top: 10px;
                right: 10px;
            }

            .lang-text {
                display: none;
            }

            .language-switch button i {
                margin-right: 0;
            }
        }

        /* 打印优化 */
        @media print {
            .accessibility-buttons,
            .language-switch {
                display: none;
            }
        }

    /* 首页主要内容样式 */
    .container {
        max-width: 1200px;  /* 内容最大宽度 */
        margin: 0 auto;  /* 水平居中 */
        padding: 40px 20px;  /* 内边距 */
    }

    /* 主标题样式 */
    h1 {
        text-align: center;  /* 居中对齐 */
        color: #2c3e50;  /* 深蓝色 */
        margin-bottom: 40px;  /* 底部外边距 */
        font-size: 2.5em;  /* 字体大小 */
    }

    /* 副标题样式 */
    .subtitle {
        text-align: center;  /* 居中对齐 */
        color: #7f8c8d;  /* 灰色 */
        margin-bottom: 30px;  /* 底部外边距 */
        font-size: 1.2em;  /* 字体大小 */
    }

    /* 时间线容器样式 */
    .timeline {
        position: relative;  /* 相对定位 */
        max-width: 1000px;  /* 最大宽度 */
        margin: 0 auto;  /* 水平居中 */
        background:
            url("static/picture/生长背景.png") no-repeat bottom center;  /* 仅保留第一张背景图片 */
        background-size: 95%;  /* 背景图片尺寸调整为单一值 */
        padding: 40px 0;  /* 内边距 */
        border-radius: 12px;  /* 圆角边框 */
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);  /* 阴影效果 */
    }

    /* 时间线中轴线样式 */
    .timeline::after {
        content: '';  /* 创建伪元素 */
        position: absolute;  /* 绝对定位 */
        width: 6px;  /* 宽度6px */
        background: linear-gradient(to bottom, #2ecc71, #27ae60, #219653, #1e874b);  /* 绿色渐变背景 */
        top: 0;  /* 顶部对齐 */
        bottom: 0;  /* 底部对齐 */
        left: 50%;  /* 居中放置 */
        margin-left: -3px;  /* 向左偏移以居中 */
        z-index: 1;  /* 层级 */
    }

    /* 时间线项目样式 */
    .timeline-item {
        padding: 10px 40px;  /* 内边距 */
        position: relative;  /* 相对定位 */
        width: 50%;  /* 宽度为容器的一半 */
        animation: fadeIn 1s ease-in;  /* 淡入动画 */
        z-index: 2;  /* 层级 */
    }

    /* 定义淡入动画 */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }  /* 起始状态 */
        to { opacity: 1; transform: translateY(0); }  /* 结束状态 */
    }

    /* 时间线项目装饰点样式 */
    .timeline-item::after {
        content: '🌱';  /* 使用植物emoji作为装饰 */
        position: absolute;  /* 绝对定位 */
        width: 30px;  /* 宽度 */
        height: 30px;  /* 高度 */
        right: -17px;  /* 右侧偏移 */
        background-color: white;  /* 白色背景 */
        border: 4px solid #2ecc71;  /* 绿色边框 */
        top: 15px;  /* 顶部偏移 */
        border-radius: 50%;  /* 圆形边框 */
        z-index: 3;  /* 层级 */
        font-size: 16px;  /* 字体大小 */
        line-height: 22px;  /* 行高 */
        text-align: center;  /* 文本居中 */
        display: flex;  /* 弹性布局 */
        align-items: center;  /* 垂直居中 */
        justify-content: center;  /* 水平居中 */
    }

    /* 左侧时间线项目样式 */
    .left {
        left: 0;  /* 左对齐 */
    }

    /* 右侧时间线项目样式 */
    .right {
        left: 50%;  /* 右侧偏移50% */
    }

    /* 右侧时间线项目装饰点位置调整 */
    .right::after {
        left: -16px;  /* 左侧偏移 */
    }

    /* 时间线内容样式 */
    .content {
        padding: 20px 30px;  /* 内边距 */
        background-color: rgba(255, 255, 255, 0.85);  /* 半透明白色背景 */
        position: relative;  /* 相对定位 */
        border-radius: 6px;  /* 圆角边框 */
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);  /* 阴影效果 */
        z-index: 2;  /* 层级 */
    }

    /* 内容标题样式 */
    .content h2 {
        color: #2ecc71;  /* 绿色文字 */
        margin-bottom: 10px;  /* 底部外边距 */
        font-size: 1.5em;  /* 字体大小 */
    }

    /* 内容列表样式 */
    .content ul {
        margin-left: 20px;  /* 左侧外边距 */
    }

    /* 列表项样式 */
    .content li {
        margin-bottom: 8px;  /* 底部外边距 */
    }

    /* 政策相关文本样式 */
    .policy {
        color: #2980b9;  /* 蓝色文字 */
        font-weight: 500;  /* 字体粗细 */
    }

    /* 成长阶段说明文本样式 */
    .growth-stage {
        font-size: 0.9em;  /* 字体大小 */
        color: #7f8c8d;  /* 灰色文字 */
        margin-top: 5px;  /* 顶部外边距 */
        font-style: italic;  /* 斜体 */
    }

    /* 地图预览区域样式 */
    .map-preview {
        margin-top: 60px;  /* 顶部外边距 */
        text-align: center;  /* 文本居中 */
        padding: 30px 0;  /* 内边距 */
        background-color: #fff;  /* 白色背景 */
        border-radius: 8px;  /* 圆角边框 */
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);  /* 阴影效果 */
    }

    /* 地图预览标题样式 */
    .map-preview h2 {
        color: #2c3e50;  /* 深蓝色文字 */
        margin-bottom: 20px;  /* 底部外边距 */
    }

    /* 地图链接容器样式 */
    .map-links {
        display: flex;  /* 弹性布局 */
        justify-content: center;  /* 水平居中 */
        gap: 30px;  /* 元素间距 */
        margin-top: 20px;  /* 顶部外边距 */
    }

    /* 地图链接按钮样式 */
    .map-link {
        padding: 12px 25px;  /* 内边距 */
        background-color: #2ecc71;  /* 绿色背景 */
        color: white;  /* 白色文字 */
        text-decoration: none;  /* 移除下划线 */
        border-radius: 30px;  /* 圆角边框 */
        font-weight: bold;  /* 粗体文字 */
        transition: all 0.3s ease;  /* 过渡动画 */
        display: inline-flex;  /* 内联弹性布局 */
        align-items: center;  /* 垂直居中 */
    }

    /* 地图链接悬停效果 */
    .map-link:hover {
        transform: translateY(-3px);  /* 向上移动 */
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);  /* 阴影效果 */
    }

    /* 地图链接图标样式 */
    .map-link svg {
        margin-right: 8px;  /* 右侧外边距 */
    }

    /* 响应式布局调整 */
    @media screen and (max-width: 600px) {
        /* 时间线中轴线位置调整 */
        .timeline::after {
            left: 31px;  /* 左侧偏移 */
            z-index: 1;  /* 层级 */
        }

        /* 时间线项目宽度调整 */
        .timeline-item {
            width: 100%;  /* 全宽 */
            padding-left: 70px;  /* 左侧内边距 */
            padding-right: 25px;  /* 右侧内边距 */
            z-index: 2;  /* 层级 */
        }

        /* 时间线项目装饰点位置调整 */
        .timeline-item::after {
            left: 15px;  /* 左侧偏移 */
            z-index: 3;  /* 层级 */
        }

        /* 右侧时间线项目位置调整 */
        .right {
            left: 0%;  /* 左对齐 */
        }

        /* 地图链接容器布局调整 */
        .map-links {
            flex-direction: column;  /* 垂直布局 */
            align-items: center;  /* 居中对齐 */
        }
    }

    /* 数据分析区域样式 */
    .data-analysis {
        max-width: 1200px;  /* 最大宽度 */
        margin: 60px auto;  /* 外边距 */
        padding: 0 20px;  /* 内边距 */
    }

    /* 分析部分样式 */
    .analysis-section {
        background: white;  /* 白色背景 */
        border-radius: 8px;  /* 圆角边框 */
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);  /* 阴影效果 */
        padding: 30px;  /* 内边距 */
        margin-bottom: 40px;  /* 底部外边距 */
    }

    /* 图表容器样式 */
    .chart-container {
        max-width: 600px;  /* 最大宽度 */
        margin: 0 auto 30px;  /* 外边距 */
        height: 350px;  /* 高度 */
        position: relative;  /* 相对定位 */
    }

    /* 演示数据提示样式 */
    .demo-data-notice {
        position: absolute;  /* 绝对定位 */
        top: 10px;  /* 顶部偏移 */
        right: 10px;  /* 右侧偏移 */
        background-color: rgba(255, 193, 7, 0.2);  /* 半透明黄色背景 */
        color: #856404;  /* 文字颜色 */
        padding: 5px 10px;  /* 内边距 */
        border-radius: 4px;  /* 圆角边框 */
        font-size: 0.8em;  /* 字体大小 */
        border: 1px solid rgba(255, 193, 7, 0.4);  /* 边框样式 */
        z-index: 10;  /* 层级 */
    }

    /* 成本项目列表样式 */
    .cost-items {
        display: grid;  /* 网格布局 */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));  /* 响应式列宽 */
        gap: 20px;  /* 网格间距 */
        margin: 20px 0;  /* 外边距 */
    }

    /* 单个成本项目样式 */
    .cost-item {
        background: #f8f9fa;  /* 浅灰色背景 */
        padding: 15px;  /* 内边距 */
        border-radius: 6px;  /* 圆角边框 */
        text-align: center;  /* 文本居中 */
    }

    /* 成本标签样式 */
    .cost-label {
        font-weight: bold;  /* 粗体文字 */
        color: #2c3e50;  /* 深蓝色文字 */
    }

    /* 成本数值样式 */
    .cost-value {
        color: #e74c3c;  /* 红色文字 */
        font-size: 1.2em;  /* 字体大小 */
    }

    /* 成本百分比样式 */
    .cost-percent {
        color: #7f8c8d;  /* 灰色文字 */
        font-size: 0.9em;  /* 字体大小 */
    }

    /* 资金来源区域样式 */
    .funding-sources {
        margin-top: 30px;  /* 顶部外边距 */
        padding: 20px;  /* 内边距 */
        background: #f8f9fa;  /* 浅灰色背景 */
        border-radius: 6px;  /* 圆角边框 */
    }

    /* 市民反馈分析区域样式 */
    .feedback-analysis {
        margin-top: 40px;  /* 顶部外边距 */
    }

    /* 反馈趋势区域样式 */
    .feedback-trend {
        margin-top: 20px;  /* 顶部外边距 */
    }

    /* 社交媒体分析区域样式 */
    .social-media-analysis {
        margin-top: 40px;  /* 顶部外边距 */
    }

    /* 词云图容器样式 */
    .wordcloud-container {
        max-width: 600px;  /* 最大宽度 */
        margin: 40px auto;  /* 外边距 */
        height: 400px;  /* 高度 */
        position: relative;  /* 相对定位 */
        background: #fff;  /* 白色背景 */
        padding: 20px;  /* 内边距 */
        border-radius: 8px;  /* 圆角边框 */
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);  /* 阴影效果 */
        display: flex;  /* 弹性布局 */
        justify-content: center;  /* 水平居中 */
        align-items: center;  /* 垂直居中 */
    }

    /* 词云图画布定位样式 */
    .wordcloud-container canvas {
        position: absolute;  /* 绝对定位 */
        top: 50%;  /* 垂直居中 */
        left: 50%;  /* 水平居中 */
        transform: translate(-50%, -50%);  /* 居中偏移 */
    }

    /* 标签列表样式 */
    .tag-list {
        display: flex;  /* 弹性布局 */
        flex-wrap: wrap;  /* 允许换行 */
        gap: 10px;  /* 标签间距 */
        margin-top: 15px;  /* 顶部外边距 */
    }

    /* 单个标签样式 */
    .tag {
        background-color: #f0f2f5;  /* 浅灰色背景 */
        padding: 5px 12px;  /* 内边距 */
        border-radius: 15px;  /* 圆角边框 */
        font-size: 0.9em;  /* 字体大小 */
        color: #2c3e50;  /* 深蓝色文字 */
    }

    /* 标签悬停效果 */
    .tag:hover {
        background-color: #e2e5e9;  /* 深一点的背景色 */
        transform: translateY(-2px);  /* 向上移动 */
        transition: all 0.3s ease;  /* 过渡动画 */
    }

    /* 底部信息区域样式 */
    .footer-info {
        margin-top: 60px;  /* 顶部外边距 */
        padding: 40px 20px;  /* 内边距 */
        background: #f8f9fa;  /* 浅灰色背景 */
        border-top: 1px solid #eee;  /* 顶部边框 */
    }

    /* 制作人员信息样式 */
    .credits {
        max-width: 800px;  /* 最大宽度 */
        margin: 0 auto;  /* 水平居中 */
        display: grid;  /* 网格布局 */
        grid-template-columns: repeat(2, 1fr);  /* 两列布局 */
        gap: 20px;  /* 减小列间距 */
        text-align: center;  /* 文本居中 */
        margin-bottom: 20px;  /* 减小底部外边距 */
    }

    /* 制作人员标题样式 */
    .credits h3 {
        color: #2c3e50;  /* 深蓝色文字 */
        margin-bottom: 10px;  /* 底部外边距 */
        font-size: 1.2em;  /* 字体大小 */
    }

    /* 制作人员文本样式 */
    .credits p {
        color: #7f8c8d;  /* 灰色文字 */
        margin: 0;  /* 移除外边距 */
        padding: 10px;  /* 内边距 */
        background: #f8f9fa;  /* 浅灰色背景 */
        border-radius: 6px;  /* 圆角边框 */
        transition: all 0.3s ease;  /* 过渡动画 */
    }

    /* 制作人员文本悬停效果 */
    .credits p:hover {
        background: #e9ecef;  /* 深一点的背景色 */
        transform: translateY(-2px);  /* 向上移动 */
    }

    /* 版权信息样式 */
    .copyright {
        text-align: center;  /* 文本居中 */
        color: #95a5a6;  /* 灰色文字 */
        margin: 20px 0;  /* 外边距 */
        font-size: 0.9em;  /* 字体大小 */
    }

    /* 免责声明样式 */
    .disclaimer {
        text-align: center;  /* 文本居中 */
        color: #7f8c8d;  /* 灰色文字 */
        font-size: 0.85em;  /* 字体大小 */
        padding: 10px;  /* 内边距 */
        background: rgba(0,0,0,0.02);  /* 半透明背景 */
        border-radius: 4px;  /* 圆角边框 */
    }

    /* 免责声明段落样式 */
    .disclaimer p {
        margin: 0;  /* 移除外边距 */
    }

    /* 新增的解释性章节样式 */
    .why-205-section {
        max-width: 1000px;  /* 最大宽度 */
        margin: 60px auto;  /* 外边距 */
        padding: 0 20px;  /* 内边距 */
    }

    /* 过去与现在对比区域样式 */
    .past-present {
        display: grid;  /* 网格布局 */
        grid-template-columns: 1fr 1fr;  /* 两列布局 */
        gap: 40px;  /* 列间距 */
        margin-bottom: 40px;  /* 底部外边距 */
        background: #fff;  /* 白色背景 */
        padding: 30px;  /* 内边距 */
        border-radius: 15px;  /* 圆角边框 */
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);  /* 阴影效果 */
    }

    /* 过去和现在的共同样式 */
    .past, .present {
        padding: 20px;  /* 内边距 */
        background: #f8f9fa;  /* 浅灰色背景 */
        border-radius: 10px;  /* 圆角边框 */
        height: 100%;  /* 全高 */
    }

    /* 过去和现在的标题样式 */
    .past h3, .present h3 {
        color: #2c3e50;  /* 深蓝色文字 */
        margin-bottom: 20px;  /* 底部外边距 */
        font-size: 1.4em;  /* 字体大小 */
        border-bottom: 2px solid #2ecc71;  /* 底部边框 */
        padding-bottom: 10px;  /* 底部内边距 */
    }

    /* 对话框样式 */
    .dialogue {
        background: rgba(46, 204, 113, 0.1);  /* 半透明绿色背景 */
        padding: 20px;  /* 内边距 */
        border-radius: 10px;  /* 圆角边框 */
        margin: 20px 0;  /* 外边距 */
        border-left: 4px solid #2ecc71;  /* 左侧边框 */
    }

    /* 儿童和母亲引用样式 */
    .child-quote, .mother-quote {
        margin: 10px 0;  /* 外边距 */
        font-style: italic;  /* 斜体 */
        position: relative;  /* 相对定位 */
        padding-left: 20px;  /* 左侧内边距 */
    }

    /* 引用装饰样式 */
    .child-quote:before, .mother-quote:before {
        content: '"';  /* 引号内容 */
        position: absolute;  /* 绝对定位 */
        left: 0;  /* 左对齐 */
        color: #2ecc71;  /* 绿色文字 */
        font-size: 1.5em;  /* 字体大小 */
    }

    /* 问题列表容器样式 */
    .problems ul {
        list-style: none;  /* 移除列表样式 */
        padding: 0;  /* 移除内边距 */
    }

    /* 问题列表项样式 */
    .problems li {
        margin: 12px 0;  /* 外边距 */
        display: flex;  /* 弹性布局 */
        align-items: center;  /* 垂直居中 */
        gap: 10px;  /* 元素间距 */
        padding: 8px 12px;  /* 内边距 */
        background: white;  /* 白色背景 */
        border-radius: 8px;  /* 圆角边框 */
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);  /* 阴影效果 */
        transition: transform 0.2s ease;  /* 过渡动画 */
    }

    /* 问题列表项悬停效果 */
    .problems li:hover {
        transform: translateX(5px);  /* 向右移动 */
    }

    /* 问题列表项图标样式 */
    .problems li i {
        color: #2ecc71;  /* 绿色图标 */
    }

    /* 信念列表样式 */
    .beliefs {
        display: grid;  /* 网格布局 */
        grid-template-columns: repeat(2, 1fr);  /* 两列布局 */
        gap: 20px;  /* 网格间距 */
        margin: 30px 0;  /* 外边距 */
    }

    /* 信念介绍区域样式 */
    .belief-intro {
        grid-column: 1 / -1;  /* 跨越所有列 */
        text-align: center;  /* 文本居中 */
        margin-bottom: 20px;  /* 底部外边距 */
    }

    /* 信念介绍标题样式 */
    .belief-intro h2 {
        color: #2c3e50;  /* 深蓝色文字 */
        margin-bottom: 15px;  /* 底部外边距 */
        font-size: 1.8em;  /* 字体大小 */
    }

    /* 信念介绍段落样式 */
    .belief-intro p {
        color: #34495e;  /* 深灰色文字 */
        line-height: 1.6;  /* 行高 */
        max-width: 800px;  /* 最大宽度 */
        margin: 0 auto;  /* 水平居中 */
        font-size: 1.1em;  /* 字体大小 */
    }

    /* 信念项目样式 */
    .belief-item {
        background: white;  /* 白色背景 */
        padding: 25px;  /* 内边距 */
        border-radius: 10px;  /* 圆角边框 */
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);  /* 阴影效果 */
        text-align: left;  /* 文本左对齐 */
        display: flex;  /* 弹性布局 */
        align-items: flex-start;  /* 顶部对齐 */
        gap: 15px;  /* 元素间距 */
        transition: transform 0.3s ease;  /* 过渡动画 */
    }

    /* 信念项目悬停效果 */
    .belief-item:hover {
        transform: translateY(-5px);  /* 向上移动 */
    }

    /* 信念项目图标样式 */
    .belief-item i {
        color: #2ecc71;  /* 绿色图标 */
        font-size: 1.5em;  /* 字体大小 */
        padding-top: 3px;  /* 顶部内边距 */
    }

    /* 信念项目段落样式 */
    .belief-item p {
        margin: 0;  /* 移除外边距 */
        line-height: 1.6;  /* 行高 */
    }

    /* 影响网格样式 */
    .impact-grid {
        display: grid;  /* 网格布局 */
        grid-template-columns: repeat(2, 1fr);  /* 两列布局 */
        gap: 25px;  /* 网格间距 */
        margin: 40px 0;  /* 外边距 */
    }

    /* 影响组样式 */
    .impact-group {
        background: white;  /* 白色背景 */
        padding: 25px;  /* 内边距 */
        border-radius: 10px;  /* 圆角边框 */
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);  /* 阴影效果 */
        transition: transform 0.3s ease;  /* 过渡动画 */
    }

    /* 影响组悬停效果 */
    .impact-group:hover {
        transform: translateY(-5px);  /* 向上移动 */
    }

    /* 影响组标题样式 */
    .impact-group h3 {
        color: #2ecc71;  /* 绿色文字 */
        margin-bottom: 15px;  /* 底部外边距 */
        display: flex;  /* 弹性布局 */
        align-items: center;  /* 垂直居中 */
        gap: 10px;  /* 元素间距 */
    }

    /* 影响组标题装饰样式 */
    .impact-group h3:before {
        content: '•';  /* 圆点内容 */
        color: #2ecc71;  /* 绿色文字 */
        font-size: 1.5em;  /* 字体大小 */
    }

    /* 影响组列表样式 */
    .impact-group ul {
        list-style: none;  /* 移除列表样式 */
        padding: 0;  /* 移除内边距 */
        margin: 0;  /* 移除外边距 */
    }

    /* 影响组列表项样式 */
    .impact-group li {
        margin: 10px 0;  /* 外边距 */
        padding-left: 20px;  /* 左侧内边距 */
        position: relative;  /* 相对定位 */
    }

    /* 影响组列表项装饰样式 */
    .impact-group li:before {
        content: '→';  /* 箭头内容 */
        position: absolute;  /* 绝对定位 */
        left: 0;  /* 左对齐 */
        color: #2ecc71;  /* 绿色文字 */
    }

    /* 意外发现区域样式 */
    .unexpected-findings {
        background: #fff;  /* 白色背景 */
        padding: 30px;  /* 内边距 */
        border-radius: 15px;  /* 圆角边框 */
        margin: 40px 0;  /* 外边距 */
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);  /* 阴影效果 */
        text-align: center;  /* 文本居中 */
    }

    /* 意外发现标题样式 */
    .unexpected-findings h2 {
        color: #2c3e50;  /* 深蓝色文字 */
        margin-bottom: 20px;  /* 底部外边距 */
        text-align: center;  /* 文本居中 */
    }

    /* 发现列表样式 */
    .findings-list {
        max-width: 600px;  /* 最大宽度 */
        margin: 0 auto;  /* 水平居中 */
        text-align: center;  /* 文本居中 */
    }

    /* 发现列表段落样式 */
    .findings-list p {
        margin-bottom: 20px;  /* 底部外边距 */
        font-size: 1.1em;  /* 字体大小 */
    }

    /* 发现列表无序列表样式 */
    .findings-list ul {
        list-style: none;  /* 移除列表样式 */
        padding: 0;  /* 移除内边距 */
        margin: 0;  /* 移除外边距 */
        display: inline-block;  /* 内联块级显示 */
    }

    /* 发现列表项样式 */
    .findings-list li {
        margin: 15px 0;  /* 外边距 */
        font-size: 1.1em;  /* 字体大小 */
        color: #2c3e50;  /* 深蓝色文字 */
    }

    /* 发现列表项装饰样式 */
    .findings-list li:before {
        content: '✓';  /* 勾选符号 */
        position: absolute;  /* 绝对定位 */
        left: 0;  /* 左对齐 */
        color: #2ecc71;  /* 绿色文字 */
        display: none;  /* 隐藏显示 */
    }

    /* 结论部分样式优化 */
    .conclusion {
        text-align: center;  /* 文本居中 */
        margin: 40px 0;  /* 外边距 */
        padding: 40px;  /* 内边距 */
        background: #fff;  /* 白色背景 */
        border-radius: 15px;  /* 圆角边框 */
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);  /* 阴影效果 */
    }

    .conclusion h2 {
        font-size: 2em;
        color: #2c3e50;
        margin-bottom: 30px;
    }

    .highlight {
        font-size: 1.6em;
        color: #2ecc71;
        margin: 40px 0;
        line-height: 1.6;
    }

    .insights {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
    }

    .insights p {
        font-size: 1.3em;
        color: #2c3e50;
        margin: 30px 0;
    }

    .insights ul {
        list-style: none;
        padding: 0;
        margin: 30px 0;
    }

    .insights li {
        margin: 20px 0;
        color: #2c3e50;
        font-size: 1.3em;
        line-height: 1.6;
    }

    .final-message {
        margin-top: 50px;
        text-align: center;
    }

    .final-message p {
        font-size: 1.3em;
        margin: 15px 0;
        color: #2c3e50;
    }

    .emphasis {
        font-size: 1.5em;
        font-weight: 500;
        margin: 20px 0;
        color: #2c3e50;
        line-height: 1.6;
    }

    @media screen and (max-width: 768px) {
        .past-present,
        .beliefs,
        .impact-grid {
            grid-template-columns: 1fr;
        }

        .belief-item,
        .impact-group {
            margin-bottom: 15px;
        }

        .chart-container {
            height: 300px;
        }

        .wordcloud-container {
            height: 350px;
        }
    }

    /* 添加响应式布局 */
    @media screen and (max-width: 480px) {
        .chart-container {
            height: 250px;
        }

        .wordcloud-container {
            height: 300px;
        }
    }

    /* 添加新的样式 */
    .present-intro {
        font-size: 1.1em;
        color: #2c3e50;
        margin-bottom: 20px;
        line-height: 1.6;
    }

    .achievement-list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px 0;
    }

    .achievement-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.3s ease;
    }

    .achievement-item:hover {
        transform: translateY(-3px);
    }

    .achievement-item i {
        color: #2ecc71;
        font-size: 1.5em;
    }

    .achievement-content {
        display: flex;
        flex-direction: column;
    }

    .achievement-number {
        font-size: 1.2em;
        font-weight: bold;
        color: #2c3e50;
    }

    .achievement-desc {
        font-size: 0.9em;
        color: #7f8c8d;
    }

    .present-features {
        margin-top: 20px;
    }

    .present-features ul {
        list-style: none;
        padding: 0;
    }

    .present-features li {
        margin: 10px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #2c3e50;
    }

    .present-features i {
        color: #2ecc71;
    }

    @media screen and (max-width: 768px) {
        .achievement-list {
            grid-template-columns: 1fr;
        }
    }

    .public-reading, .reading-issues, .service-gap {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .public-reading h4, .reading-issues h4, .service-gap h4 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.1em;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .public-reading h4 i, .reading-issues h4 i, .service-gap h4 i {
        color: #2ecc71;
    }

    .reading-issues ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .reading-issues li {
        margin: 10px 0;
        padding-left: 25px;
        position: relative;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .reading-issues li i {
        color: #2ecc71;
        width: 20px;
    }

    .evidence-box {
        background: rgba(46, 204, 113, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
    }

    .evidence-box p {
        margin: 0 0 10px 0;
        color: #7f8c8d;
        font-size: 0.9em;
    }

    .feedback-quote {
        color: #2c3e50;
        font-style: italic;
        position: relative;
        padding-left: 20px;
        margin: 0;
    }

    .feedback-quote:before {
        content: '"';  /* 引号内容 */
        position: absolute;  /* 绝对定位 */
        left: 0;  /* 左对齐 */
        color: #2ecc71;  /* 绿色文字 */
        font-size: 1.5em;  /* 字体大小 */
    }

    .we-believe {
        text-align: center;  /* 文本居中 */
        margin-bottom: 20px;  /* 底部外边距 */
        font-size: 1.2em;  /* 字体大小 */
        color: #2c3e50;  /* 深蓝色文字 */
        grid-column: 1 / -1;  /* 跨越所有列 */
    }

    .policy-note {
        background: #f8f9fa;  /* 浅灰色背景 */
        border-left: 4px solid #2980b9;  /* 左侧蓝色边框 */
        padding: 10px;  /* 内边距 */
        margin-top: 15px;  /* 顶部外边距 */
    }

    .present-features h4 {
        text-align: center;  /* 文本居中 */
        margin-bottom: 25px;  /* 底部外边距 */
        color: #2c3e50;  /* 深蓝色文字 */
        font-size: 1.4em;  /* 字体大小 */
    }

    .features-grid {
        display: grid;  /* 网格布局 */
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));  /* 响应式列宽 */
        gap: 20px;  /* 网格间距 */
        margin-top: 15px;  /* 顶部外边距 */
    }

    .feature-card {
        background: #f8f9fa;  /* 浅灰色背景 */
        border-radius: 8px;  /* 圆角边框 */
        padding: 20px;  /* 内边距 */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);  /* 阴影效果 */
        transition: transform 0.3s ease, box-shadow 0.3s ease;  /* 过渡动画 */
        display: flex;  /* 弹性布局 */
        flex-direction: column;  /* 垂直方向 */
        align-items: center;  /* 水平居中 */
        text-align: center;  /* 文本居中 */
    }

    /* 特点卡片悬停效果 */
    .feature-card:hover {
        transform: translateY(-5px);  /* 向上移动 */
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);  /* 增强阴影 */
    }

    /* 特点卡片图标样式 */
    .feature-card i {
        font-size: 2.5em;  /* 字体大小 */
        color: #3498db;  /* 蓝色图标 */
        margin-bottom: 15px;  /* 底部外边距 */
    }

    /* 特点卡片标题样式 */
    .feature-card h5 {
        font-size: 1.2em;  /* 字体大小 */
        margin-bottom: 10px;  /* 底部外边距 */
        color: #2c3e50;  /* 深蓝色文字 */
    }

    /* 特点卡片段落样式 */
    .feature-card p {
        color: #7f8c8d;  /* 灰色文字 */
        line-height: 1.5;  /* 行高 */
    }

    @media (max-width: 768px) {
        .features-grid {
            grid-template-columns: 1fr;
        }
    }

    .why-205-section {
        padding: 40px 0;
    }

    .section-title {
        text-align: center;
        margin-bottom: 40px;
        color: #2c3e50;
        font-size: 2em;
    }

    .past-present-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .timeline-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        padding: 25px;
        height: 100%;
    }

    .past-card {
        border-top: 5px solid #e74c3c;
    }

    .present-card {
        border-top: 5px solid #2ecc71;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
    }

    .card-header h3 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.5em;
    }

    .timeline-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
    }

    .past-card .timeline-icon {
        background-color: #e74c3c;
        color: white;
    }

    .present-card .timeline-icon {
        background-color: #2ecc71;
        color: white;
    }

    .problem-item {
        margin-bottom: 20px;
    }

    .problem-item h4 {
        display: flex;
        align-items: center;
        color: #e74c3c;
        margin-bottom: 10px;
    }

    .problem-item h4 i {
        margin-right: 10px;
    }

    .problem-details {
        padding-left: 15px;
    }

    .detail-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }

    .detail-item i {
        margin-right: 10px;
        color: #7f8c8d;
    }

    .dialogue-box {
        background: #f8f9fa;
        border-left: 4px solid #e74c3c;
        padding: 15px;
        border-radius: 0 5px 5px 0;
    }

    .present-intro {
        font-size: 1.1em;
        color: #2c3e50;
        margin-bottom: 25px;
        text-align: center;
    }

    .stats-container {
        display: flex;
        justify-content: space-around;
        margin: 30px 0;
    }

    .stat-item {
        text-align: center;
    }

    .stat-icon {
        font-size: 2em;
        color: #2ecc71;
        margin-bottom: 10px;
    }

    .stat-number {
        font-size: 1.8em;
        font-weight: bold;
        color: #2c3e50;
    }

    .stat-label {
        color: #7f8c8d;
    }

    .features-title {
        text-align: center;
        margin: 30px 0 20px;
        color: #2c3e50;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .feature-card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-5px);
    }

    .feature-card i {
        font-size: 1.8em;
        color: #3498db;
        margin-bottom: 10px;
    }

    .feature-card h5 {
        margin: 0 0 8px;
        color: #2c3e50;
    }

    .feature-card p {
        margin: 0;
        color: #7f8c8d;
        font-size: 0.9em;
    }

    @media (max-width: 992px) {
        .past-present-container {
            grid-template-columns: 1fr;
        }

        .features-grid {
            grid-template-columns: 1fr;
        }
    }

    .link-item {
        transition: transform 0.2s ease;
        padding: 15px 25px;
            border-radius: 8px;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .link-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .icon-wrapper {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(0,0,0,0.03);
        transition: background 0.2s ease;
    }

    .link-item:hover .icon-wrapper {
        background: rgba(0,0,0,0.05);
    }

    /* 过去的洛阳图书馆统计样式 */
    .city-library-stats {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .city-library-stats h4 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.2em;
        border-bottom: 2px solid #e74c3c;
        padding-bottom: 8px;
        display: inline-block;
    }

    .stats-grid {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }

    .stat-box {
        text-align: center;
        padding: 15px;
        min-width: 120px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin: 10px;
        transition: transform 0.3s ease;
    }

    .stat-box:hover {
        transform: translateY(-5px);
    }

    .stat-icon {
        font-size: 24px;
        color: #e74c3c;
        margin-bottom: 10px;
    }

    .stat-info .stat-number {
        display: block;
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
    }

    .stat-info .stat-label {
        display: block;
        font-size: 14px;
        color: #7f8c8d;
    }

    .library-challenges {
        background-color: #fff;
        border-left: 4px solid #e74c3c;
        padding: 15px;
        border-radius: 0 8px 8px 0;
    }

    .library-challenges p {
        margin-bottom: 10px;
        color: #34495e;
    }

    .library-challenges i {
        color: #e74c3c;
        margin-right: 8px;
    }

    .library-challenges strong {
        color: #2c3e50;
    }

    /* 服务问题样式 */
    .service-issues {
        margin-top: 15px;
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }

    .service-issues p {
        margin-bottom: 8px;
        color: #34495e;
        font-size: 0.95em;
    }

    .service-issues i {
        color: #e67e22;
        margin-right: 8px;
        width: 20px;
        text-align: center;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        .stats-grid {
            flex-direction: column;
        }

        .stat-box {
            width: 100%;
            margin: 5px 0;
        }
    }

    /* 添加开头部分的样式 */
    .intro-section {
        margin-bottom: 40px;
        text-align: center;
        padding: 30px 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .main-title {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 20px;
        font-weight: 700;
    }

    .intro-text {
        font-size: 16px;
        line-height: 1.8;
        color: #34495e;
        max-width: 900px;
        margin: 0 auto;
        text-align: justify;
    }

    /* 原有样式保持不变 */
    .charts-container {
        margin-bottom: 40px;
    }
      /* 添加背景轮播样式 */
      .city-libraries {
    margin: 50px 0;
    padding: 0 20px;
}

.section-title {
    text-align: center;
    font-size: 28px;
    color: #333;
    margin-bottom: 30px;
    font-weight: 500;
    position: relative;
}

.section-title:after {
    content: '';
    display: block;
    width: 60px;
    height: 3px;
    background-color: #0078d4;
    margin: 15px auto 0;
}

.library-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 25px;
    max-width: 1200px;
    margin: 0 auto;
}

.library-item {
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.library-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

.library-image {
    height: 220px;
    overflow: hidden;
}

.library-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.library-item:hover .library-image img {
    transform: scale(1.05);
}

.library-caption {
    padding: 15px;
    text-align: center;
    font-size: 16px;
    color: #333;
    font-weight: 500;
    background-color: #f5f8fc;
    border-top: 1px solid #eaeaea;
}
/* 响应式调整 */
@media (max-width: 768px) {
    .library-gallery {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 15px;
    }

    .library-image {
        height: 180px;
    }

    .section-title {
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .library-gallery {
        grid-template-columns: 1fr;
        max-width: 320px;
    }

    .library-image {
        height: 200px;
    }
}
.data-source {
    margin-top: 20px;
    text-align: right;
    padding-right: 20px;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.data-source p {
    font-size: 14px;
    color: #666;
    font-style: italic;
}

/* 在小屏幕上居中显示数据来源 */
@media (max-width: 768px) {
    .data-source {
        text-align: center;
        padding-right: 0;
    }
}
 /* 现有样式 */
 .intro-section {
            margin-bottom: 40px;
            text-align: center;
            padding: 30px 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .main-title {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 700;
        }

        /* 新增数字统计样式 */
        .key-stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #e67e22;
            line-height: 1.2;
        }

        .stat-unit {
            font-size: 18px;
            font-weight: 500;
        }

        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .intro-text {
            font-size: 16px;
            line-height: 1.8;
            color: #34495e;
            max-width: 900px;
            margin: 0 auto;
            text-align: justify;
        }

        /* 图表说明样式 */
        .charts-intro {
            text-align: center;
            margin-bottom: 30px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .charts-intro p {
            font-size: 16px;
            color: #555;
            line-height: 1.6;
        }

        .chart-description {
    margin-top: 15px;           /* 保持顶部外边距 */
    font-size: 1.05em;          /* 恢复之前的字体大小或设为需要的默认大小 */
    color: #000;                /* 字体颜色改为黑色 (#000 或 black) */
    line-height: 1.6;           /* 恢复之前的行高或设为需要的默认行高 */
    text-align: left;           /* 改为左对齐 */
    text-indent: 2em;           /* 添加首行缩进，2em 表示缩进两个字符宽度 */
    font-style: normal;         /* 将字体样式改回常规（非斜体） */
        .why-205-section {
            padding: 40px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
            font-size: 2em;
        }

        .past-present-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .timeline-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px;
            height: 100%;
        }

        .past-card {
            border-top: 5px solid #e74c3c;
        }

        .present-card {
            border-top: 5px solid #2ecc71;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .card-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.5em;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .past-card .timeline-icon {
            background-color: #e74c3c;
            color: white;
        }

        .present-card .timeline-icon {
            background-color: #2ecc71;
            color: white;
        }

        .problem-item {
            margin-bottom: 20px;
        }

        .problem-item h4 {
            display: flex;
            align-items: center;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .problem-item h4 i {
            margin-right: 10px;
        }

        .problem-details {
            padding-left: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .detail-item i {
            margin-right: 10px;
            color: #7f8c8d;
        }

        .dialogue-box {
            background: #f8f9fa;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            border-radius: 0 5px 5px 0;
        }

        .present-intro {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-icon {
            font-size: 2em;
            color: #2ecc71;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
        }

        .features-title {
            text-align: center;
            margin: 30px 0 20px;
            color: #2c3e50;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .feature-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 1.8em;
            color: #3498db;
            margin-bottom: 10px;
        }

        .feature-card h5 {
            margin: 0 0 8px;
            color: #2c3e50;
        }

        .feature-card p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        @media (max-width: 992px) {
            .past-present-container {
                grid-template-columns: 1fr;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }
  /* 现有样式保持不变 */

    /* 空间分布部分样式 */
    .spatial-distribution {
        max-width: 1200px;
        margin: 0 auto 50px;
        text-align: center;
        padding: 30px;
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        border-left: 5px solid #8e44ad;
    }

    .section-title {
        color: #2c3e50;
        font-size: 24px;
        margin-bottom: 15px;
    }

    .section-description {
        color: #555;
        line-height: 1.6;
        margin-bottom: 25px;
    }

    .map-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .map-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px 25px;
        background-color: #8e44ad;
        color: white;
        border-radius: 30px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        min-width: 200px;
    }

    .map-button:hover {
        background-color: #9b59b6;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .map-button .icon {
        font-size: 18px;
        margin-right: 8px;
    }

    .map-button.reading-circle {
        background-color: #8e44ad;
    }

    .map-button.population-heat {
        background-color: #9b59b6;
    }

    @media (max-width: 600px) {
        .map-buttons {
            flex-direction: column;
            align-items: center;
        }

        .map-button {
            width: 100%;
        }
    }
    .link-item {
    transition: transform 0.2s ease;
    padding: 15px 25px;
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.link-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.icon-wrapper {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(0,0,0,0.03);
    transition: background 0.2s ease;
}

.link-item:hover .icon-wrapper {
    background: rgba(0,0,0,0.05);
}
</style>

<style>
    /* --- Library Showcase Styles --- */
    .library-showcase {
        text-align: center;
    }

    .showcase-grid {
  display: flex;
  flex-wrap: nowrap;  /* 防止自动换行 */
  justify-content: space-between;
  gap: 20px;
  overflow-x: auto;  /* 在窄屏上允许水平滚动而不是换行 */
  padding-bottom: 10px;  /* 为可能的滚动条留出空间 */
}
.showcase-item {
  flex: 0 0 31%;  /* 三张图片时每张分配大约1/3的宽度（稍小点以留出间距） */
  min-width: 250px;  /* 设置最小宽度，确保内容可见 */
}

    .showcase-item.library-card {
        background-color: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer; /* Indicate clickable */
        display: flex; /* Use flex for better structure */
        flex-direction: column;
    }

    .showcase-item.library-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .library-card .library-image {
        height: 220px; /* Fixed height for images */
        overflow: hidden;
    }

    .library-card .library-image img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensure image covers the area */
        transition: transform 0.4s ease;
    }

    .library-card:hover .library-image img {
        transform: scale(1.05); /* Zoom effect on hover */
    }

    .library-card .library-caption {
        padding: 15px;
        text-align: center;
        background-color: #f8f9fa;
        border-top: 1px solid #eee;
        flex-grow: 1; /* Allow caption to take remaining space if needed */
    }

    .library-caption h5 {
        margin: 0 0 5px 0;
        font-size: 1.1em;
        color: #333;
    }

    .library-caption p {
        font-size: 0.9em;
        color: #666;
        margin: 0;
    }

    .library-showcase .data-source { /* Style the data source specifically */
        margin-top: 25px;
        text-align: center;
        font-size: 0.9em;
        color: #888;
        font-style: italic;
    }


    /* --- Modal Styles --- */
    .modal {
    display: none; /* 默认隐藏 */
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    background-color: rgba(0, 0, 0, 0.6);
    /* 删除冲突的display: flex，改为在显示时应用 */
    align-items: center;
    justify-content: center;
    padding: 20px;
    animation: fadeIn 0.3s ease-out;
}

.modal.show {
    display: flex; /* 当添加.show类时才显示为flex */
}

    .modal-content {
        background-color: #fefefe;
        margin: auto; /* Centered */
        padding: 25px 30px;
        border: 1px solid #ddd;
        width: 85%; /* Responsive width */
        max-width: 750px; /* Max width */
        border-radius: 10px;
        position: relative;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        animation: slideDown 0.4s ease-out; /* Slide in content */
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideDown {
        from { transform: translateY(-30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .close-button {
        color: #aaa;
        /* float: right; */ /* Use absolute positioning instead */
        font-size: 32px;
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 20px;
        cursor: pointer;
        line-height: 1;
        transition: color 0.2s ease;
    }

    .close-button:hover,
    .close-button:focus {
        color: #333;
        text-decoration: none;
    }

    .modal-content h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #2c3e50;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
        font-size: 1.6em;
    }

    .modal-body-grid {
        display: grid;
        grid-template-columns: 1fr 2fr; /* Image takes 1 part, details take 2 parts */
        gap: 25px;
        margin-top: 20px;
        align-items: start; /* Align items at the start */
    }

    .modal-image-container img {
        width: 100%;
        max-height: 280px; /* Limit image height */
        object-fit: contain; /* Fit image within container */
        border-radius: 5px;
        border: 1px solid #eee;
    }

    .modal-details h4,
    .modal-description h4 {
        font-size: 1.2em;
        color: #3498db; /* Use a consistent highlight color */
        margin-bottom: 10px;
        margin-top: 0;
        display: flex;
        align-items: center;
    }
    .modal-details h4 i,
    .modal-description h4 i {
        margin-right: 8px;
        font-size: 0.9em;
    }


    .modal-details p,
    .modal-description p {
        font-size: 1em;
        line-height: 1.7;
        color: #444;
        margin-top: 0;
    }

    .modal-details ul {
        list-style: none;
        padding-left: 0;
        font-size: 0.9em;
        color: #555;
        margin-top: 0;
    }

    .modal-details ul li {
        margin-bottom: 6px;
        display: flex;
        align-items: center;
    }
    .modal-details ul li i {
        color: #28a745; /* Green checkmark */
        margin-right: 8px;
        font-size: 0.85em;
    }

    .modal-description {
        margin-top: 25px;
        padding-top: 15px;
        border-top: 1px solid #f0f0f0;
    }

    /* Responsive adjustments for modal */
    @media (max-width: 768px) {
        .modal-content {
            width: 95%;
            padding: 20px;
        }
        .modal-body-grid {
            grid-template-columns: 1fr; /* Stack image and details */
        }
        .modal-image-container img {
            max-height: 200px; /* Adjust image height */
            margin-bottom: 15px;
        }
        .modal-content h3 { font-size: 1.4em; }
        .modal-details h4, .modal-description h4 { font-size: 1.1em; }
    }

    </style>
</head>
<body>
    <!-- 语言切换按钮 -->
    <div class="language-switch" role="group" aria-label="语言切换">
        <button class="active" data-lang="zh" aria-pressed="true">
            <span class="lang-text">中文</span>
        </button>
        <button data-lang="en" aria-pressed="false">
            <span class="lang-text">En</span>
        </button>
    </div>

    <!-- 简化的无障碍按钮 -->
    <div class="accessibility-buttons">
        <button id="contrast-toggle" aria-pressed="false">
            <i class="fas fa-adjust"></i>
        </button>
        <button id="font-size-toggle" aria-pressed="false">
            <i class="fas fa-text-height"></i>
        </button>
        <button id="line-height-toggle" aria-pressed="false">
            <i class="fas fa-text-width"></i>
        </button>
        <button id="read-aloud-toggle" aria-pressed="false">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- 内容区域 -->
    <div class="container">
        <!-- 数据驱动式开头 -->
        <div class="intro-section" id="main-content" style="background-image: url('static/picture/开头.png'); background-size: cover; background-position: center; padding: 60px 0; position: relative; margin: -40px -20px 40px -20px; min-height: 500px;">
            <!-- Remove the dark overlay to show original image -->

            <!-- Wrap content in a relative container to appear above overlay -->
            <div style="position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 0 20px;">
                <h1 class="main-title" style="font-size: 2.8em; margin-bottom: 40px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); color: #2c3e50;" data-i18n="main_title">河洛书苑生长笔记：百座书房画出十五分钟阅读圈</h1>

                <!-- 优化排版，将数字拎出来展示 -->
                <div class="key-stats" style="display: flex; justify-content: center; gap: 40px; margin-bottom: 40px;">
                    <div class="stat-item" style="text-align: center; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px;">
                        <div class="stat-number" style="font-size: 3em; font-weight: 700; color: #3498db;">800<span class="stat-unit" style="font-size: 0.5em;">万+</span></div>
                        <div class="stat-label" style="font-size: 1.2em; color: #2c3e50;" data-i18n="annual_visitors">年度接待读者规模</div>
                    </div>
                    <div class="stat-item" style="text-align: center; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px;">
                        <div class="stat-number" style="font-size: 3em; font-weight: 700; color: #3498db;">205<span class="stat-unit" style="font-size: 0.5em;">个</span></div>
                        <div class="stat-label" style="font-size: 1.2em; color: #2c3e50;" data-i18n="city_libraries">城市书房</div>
                    </div>
                    <div class="stat-item" style="text-align: center; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px;">
                        <div class="stat-number" style="font-size: 3em; font-weight: 700; color: #3498db;">1700<span class="stat-unit" style="font-size: 0.5em;">万+</span></div>
                        <div class="stat-label" style="font-size: 1.2em; color: #2c3e50;" data-i18n="total_loans">累计借阅总量</div>
                    </div>
                    <div class="stat-item" style="text-align: center; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px;">
                        <div class="stat-number" style="font-size: 3em; font-weight: 700; color: #3498db;">2<span class="stat-unit" style="font-size: 0.5em;">万+</span></div>
                        <div class="stat-label" style="font-size: 1.2em; color: #2c3e50;" data-i18n="daily_visitors">日均进馆人次</div>
                    </div>
                </div>

                <p class="intro-text" style="font-size: 1.3em; line-height: 1.8; max-width: 900px; margin: 0 auto; text-align: left; text-indent: 2em; color: #2c3e50; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px;" data-i18n="intro_text">
                    这是洛阳市全民阅读的生动写照。在这座十三朝古都，一座座城市书房如星辰般点亮城市的每个角落，构建起便捷的"15分钟阅读圈"。每天，众多市民走进这些阅读空间，日均借阅流通量超过1万册，自助设备借还率达60%以上。从市中心到城郊，683个流通服务点织就了一张覆盖全城的阅读网络，让阅读成为洛阳市民日常生活的一部分。
                </p>

                <div class="data-news-overview" style="margin: 20px auto 0; max-width: 900px; text-align: left; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.3em; line-height: 1.8; color: #2c3e50; text-indent: 2em; margin-bottom: 15px;" data-i18n="data_news_intro">
                        本数据新闻将从三个主线展开，全面呈现洛阳城市书房建设的成果与影响。首先，我们将探索城市书房的<strong>空间分布</strong>，揭示"15分钟阅读圈"如何覆盖城市各个角落，打造便捷的全民阅读网络。其次，通过<strong>发展时间轴</strong>，我们将追溯洛阳城市书房从无到有、从少到多的建设历程，见证阅读空间的蓬勃发展。最后，基于<strong>市民需求反馈</strong>，我们将展示城市书房如何满足市民多元阅读需求，以及这一文化工程为洛阳市民生活带来的深远影响。
                    </p>
                </div>
            </div>
        </div>
    <!--    直接展开些这个数据新闻讲了些什么 -->


    <!-- 空间分布部分 -->
    <div class="spatial-distribution">
        <h2 class="section-title">探索河洛书苑的空间分布</h2>
        <p class="section-description">
            通过交互式地图了解"十五分钟阅读圈"的覆盖范围和人口分布情况，直观感受洛阳全域阅读服务网络的密度与覆盖效果。
        </p>



               
        <div class="map-preview-container" style="margin: 30px auto; max-width: 1200px; background: rgba(255, 255, 255, 0.9); padding: 0; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative;">
            <iframe id="mapPreview" src="isochrone_map.html?preview=true" width="100%" height="800px" frameborder="0" style="border: none; display: block;" title="洛阳市十五分钟阅读圈分布地图预览" allowfullscreen></iframe>
        </div>

        <script>
        function toggleFullScreen(elementId) {
            const element = document.getElementById(elementId);

            if (!document.fullscreenElement &&
                !document.mozFullScreenElement &&
                !document.webkitFullscreenElement &&
                !document.msFullscreenElement) {
                // 进入全屏
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
            } else {
                // 退出全屏
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
            }
        }

        // 监听全屏变化事件来更新按钮图标
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('mozfullscreenchange', updateFullscreenButton);
        document.addEventListener('MSFullscreenChange', updateFullscreenButton);

        function updateFullscreenButton() {
            const button = document.querySelector('.fullscreen-btn i');
            if (button && (document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement)) {
                button.className = 'fas fa-compress';
            } else if (button) {
                button.className = 'fas fa-expand';
            }
        }
        </script>
    </div>

      <!-- 新增的分布状况分析段落 -->
      <div class="spatial-analysis-summary" style="max-width: 900px; margin: 30px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <p style="font-size: 1.1em; line-height: 1.8; color: #333; text-align: left; text-indent: 2em;">
           观察交互式地图展示的“十五分钟阅读圈”分布，可以清晰地看到“河洛书苑”的空间布局呈现出 明显的中心城区聚集特征。在洛阳市的主城区，特别是人口相对密集的区域，城市书房的分布较为 密集，其15分钟步行服务范围（等时圈）相互 重叠交织，初步形成了便捷可达的阅读服务网络，有效支撑了“十五分钟阅读文化圈”目标的实现。然而，相较于中心城区的稠密布局，书房在 城市边缘地带及下辖县域的分布则相对稀疏，覆盖密度有所降低。这一空间格局直观反映了当前洛阳城市书房网络建设的重点区域与初步成效，同时也为后续优化布局、提升服务均等性指明了方向。接下来，我们将进一步从书房的规模（面积）维度进行分析。
       </p>
   </div>
    <!-- 确保先加载ECharts库 -->



    <!-- 原有内容 -->
    <!-- 添加叙事开场部分 -->

    <!-- https://news.lyd.com.cn/system/2024/11/28/032473219_01.shtml --"书房开放两个月以来，日均接待读者和顾客超过300人，周边的回头客很多。"参与柳林街城市书房共建的唐集咖啡店负责人说，"书房咖啡"一经问市就俘获了一众"咖啡脑袋"的"芳心"，店里下午茶时间还提供甜品。
            {
          "id": 57,
          "district": "老城区",
          "name": "柳林街城市书房",
          "address": "老城区柳林街古都天玺5号楼107门面房",
          "area": 220.0,
          "seats": 100,
          "books": "6500",
          "magazine_types": "12",
          "opening_hours": "24小时",
          "coordinates": "112.487595,34.676277"
        },
        https://www.nationalreading.gov.cn/ydkj/ydyz/202411/t20241126_874837.html
        位于柳林街的这家城市书房，占地面积220余平方米，藏书量高达8000余册。其独特之处在于，除丰富的书籍资源外，还巧妙融入咖啡茶饮、非遗文创、青年驿站等多种业态，构建"阅读+"的新场景。在这里，读者可以一边品味香醇的咖啡，一边沉浸在书海中；同时，还能近距离接触非遗技艺，感受文创产品的独特魅力，体验老城洛阳的文化韵味。

洛阳，作为十三朝古都，文化底蕴深厚，历史遗迹遍布。近年来，为积极响应国家"全民阅读"号召，洛阳市致力于打造更加便捷、多元、高效的阅读空间，城市书房项目应运而生。此次开放的24小时城市书房，正是这一理念的实践。它不仅填补了洛阳夜间阅读空间的空白，更以其独特的运营模式和文化内涵，成为洛阳文化创新的一张闪亮名片。

老城区政府相关负责人表示，该城市书房的开放，不仅为市民提供了一个24小时不间断的优质阅读空间，更将成为推动全民阅读的重要阵地。未来，书房将定期举办讲座、非遗体验、读书沙龙等丰富多彩的阅读活动，旨在通过沉浸式的阅读体验，激发市民的阅读兴趣，提升文化素养，进一步营造"书香老城"的文化氛围。同时，作为文旅融合的新亮点，城市书房也将吸引更多游客前来打卡体验，感受洛阳的文化魅力，为老城区的文旅发展注入新的活力。




    <!-- 添加新的解释性章节 -->



    <div class="treemap-container" style="position: relative; overflow: hidden; margin-bottom: 20px;">
        <h2 class="section-title" data-i18n="section_title_bookstore_treemap">城市书房面积分布</h2>
        <div id="bookstoreTreemap" style="width: 100%; height: 500px; position: relative; overflow: hidden;"></div>
        <div class="treemap-legend" style="max-width: 900px; margin: 20px auto; padding: 10px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <p style="text-align: center; font-weight: bold; margin-bottom: 8px; color: #333; font-size: 14px;">书房类型面积划分标准</p>
            <div style="display: flex; justify-content: space-around;">
                <span style="color: #FF9F40;">小型书房（<100㎡）</span>
                <span style="color: #36A2EB;">中型书房（100-200㎡）</span>
                <span style="color: #4BC0C0;">大型书房（200-500㎡）</span>
                <span style="color: #9966FF;">特大型书房（>500㎡）</span>
            </div>
        </div>
    </div>

    <!-- 数据分析总结部分 -->
    <div class="data-analysis-summary" style="max-width: 900px; margin: 40px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2 style="text-align: center; color: #333; margin-bottom: 20px; font-size: 1.8em;">从书房面积透视文化服务</h2>

        <div class="summary-section" style="margin-bottom: 25px;">
            <h3 style="color: #2980b9; margin-bottom: 15px; font-size: 1.4em;">1. 书房分布与覆盖性</h3>
            <ul style="list-style-type: none; padding-left: 15px;">
                <li style="margin-bottom: 12px;">
                    <span style="color: #FF9F40; font-weight: bold;">小型书房</span>（面积小于100平方米）占总书房数的<b>38%</b>，主要服务于居民小区、商业区等人口密集区域。根据<b>"15分钟阅读文化圈"</b>的规划，小型书房的分布符合政策中对"人口集中区域"的要求，为市民提供便捷的阅读服务。小型书房的总面积约占14.11%，为居民区等提供了基础的阅读和休闲场所。
                </li>
                <li style="margin-bottom: 12px;">
                    <span style="color: #36A2EB; font-weight: bold;">中型书房</span>（面积100-200平方米）数量最多，约占总书房数的<b>45%</b>，是最常见的书房类型。它们的分布不仅符合交通便利的要求，还能容纳更多读者，提供更多的文化服务。中型书房总面积占<b>44.86%</b>，为大多数市民提供了广泛的文化服务和学习空间，充分体现了<b>"覆盖面广、受益群众多"</b>的规划目标。
                </li>
                <li style="margin-bottom: 12px;">
                    <span style="color: #4BC0C0; font-weight: bold;">大型书房</span>（面积200-500平方米）占<b>16%</b>，主要分布在文化中心、社区中心等功能较为集中的区域。这类书房的功能性强，能够提供更多的文化活动和互动空间，满足大规模人群的需求。它们的总面积占比约<b>33.81%</b>，表明这些书房通常是功能丰富、服务全面的文化场所。
                </li>
                <li style="margin-bottom: 12px;">
                    <span style="color: #9966FF; font-weight: bold;">特大型书房</span>（面积大于500平方米）数量较少，占比约<b>1%</b>，但其大面积的空间和多功能配置使它们成为文化地标，提供丰富的文化体验和公共资源。这类书房的面积占比为<b>7.22%</b>，显示出特大型书房在文化服务中的重要地位。
                </li>
            </ul>
        </div>

        <div class="summary-section" style="margin-bottom: 25px;">
            <h3 style="color: #2980b9; margin-bottom: 15px; font-size: 1.4em;">2. 选址与规划符合政策要求</h3>
            <p style="line-height: 1.6; margin-bottom: 12px;">洛阳市的城市书房选址符合<b>建设管理办法第七条</b>中关于<b>"15分钟阅读文化圈"</b>的要求，确保了大部分书房可以在市民15分钟步行范围内达到。尤其是小型和中型书房的布局，使得居民可以方便快捷地访问阅读空间。</p>
            <p style="line-height: 1.6; margin-bottom: 12px;">根据<b>第八条</b>的选址要求，洛阳市的书房选址位于<b>人口集中、交通便利的区域</b>，例如居民小区、商业中心、文化中心等地。大多数书房选择在<b>一楼临街</b>的位置，且利用现有建筑进行改建，符合节约政府投入的要求。这使得书房能够更好地融入城市环境，并为市民提供便捷的服务。</p>
            <p style="line-height: 1.6;">面积要求方面，<b>小型书房</b>的面积普遍小于80平方米，符合玻璃书房的面积标准；<b>中型书房</b>的面积普遍在100-200平方米之间，符合政策中对实体建筑面积的要求；而<b>大型书房</b>通常超过200平方米，适应了更大规模的文化活动需求。</p>
        </div>

        <div class="summary-section">
            <h3 style="color: #2980b9; margin-bottom: 15px; font-size: 1.4em;">3. 整体布局与资源优化</h3>
            <p style="line-height: 1.6; margin-bottom: 12px;">洛阳市的城市书房布局呈现<b>合理、优化</b>的特点。政策要求强调通过合理规划和分布，确保全民能够平等享有文化服务。通过对不同规模书房的合理配置，洛阳能够满足不同地区和不同人群的文化需求。</p>
            <p style="line-height: 1.6; margin-bottom: 12px;">小型和中型书房的高占比、特别是中型书房的数量最多，表明洛阳市在提升文化服务覆盖面方面采取了灵活且经济的策略，确保了文化资源的广泛覆盖和高效利用。</p>
            <p style="line-height: 1.6;"><b>特大型书房</b>虽然数量较少，但其提供的文化资源和服务不容忽视。它们不仅是城市文化设施的重要组成部分，也是文化推广和市民精神文化生活的重要载体。</p>
        </div>

        <div class="summary-conclusion" style="margin-top: 25px; padding: 15px; background-color: #e9f7fe; border-radius: 6px;">
            <h3 style="color: #3498db; margin-bottom: 10px; font-size: 1.3em;">总结</h3>
            <p style="line-height: 1.6;">洛阳市的城市书房在面积分布、选址布局以及政策要求的贯彻上表现出较高的协调性和有效性。书房的布局充分考虑了<b>人口分布、交通便利性</b>和<b>公共资源的高效利用</b>，确保了市民能够便捷享受阅读服务。总体来看，洛阳在城市书房的规划和建设上，既符合政策要求，又充分考虑了实际需求，推动了城市文化服务的普及和全民阅读的实现。</p>
        </div>
    </div>

 <!-- 行政区书房分布可视化 -->
<!-- 行政区书房分布可视化 -->
<div class="district-distribution" style="max-width: 900px; margin: 40px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="text-align: center; color: #333; margin-bottom: 20px; font-size: 1.8em;">各行政区书房分布对比</h2>
    <div id="districtChart" style="width: 100%; height: 500px;"></div>
    <div class="chart-description" style="margin-top: 20px; padding: 15px; background-color: #f0f8ff; border-radius: 6px;">
        <h3 style="color: #2980b9; margin-bottom: 10px; font-size: 1.3em;">区域分布特点</h3>
        <p style="font-size: 1.3em; line-height: 1.6; margin-bottom: 12px; text-indent: 2em; text-align: left; font-weight: normal; font-style: normal;">从上图可见，洛龙区拥有最多的城市书房（49座），总面积达7502.9平方米，这与该区作为洛阳市重点发展的新城区，人口密度大、经济活力强的特点相符。</p>
        <p style="font-size: 1.3em; line-height: 1.6; margin-bottom: 12px; text-indent: 2em; text-align: left; font-weight: normal; font-style: normal;">涧西区以32座书房位居第二，总面积7337平方米，该区作为洛阳市传统的城市主城区和商业中心，公共文化设施建设较为完善。</p>
        <p style="font-size: 1.3em; line-height: 1.6; margin-bottom: 12px; text-indent: 2em; text-align: left; font-weight: normal; font-style: normal;">孟津区虽然为新合并区域，但拥有30座城市书房，总面积达3586平方米，显示出该区对公共文化服务的重视。</p>
        <p style="font-size: 1.3em; line-height: 1.6; text-indent: 2em; text-align: left; font-weight: normal; font-style: normal;">县域地区如洛宁县、嵩县和栾川县的书房数量相对较少（均为7-8座），但考虑到这些地区人口相对分散，现有书房布局仍能基本满足当地居民的文化需求。</p>
    </div>
</div>

<!-- 书房与人口面积关系分析 -->
<div class="population-area-analysis" style="max-width: 900px; margin: 40px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">


    <!-- 人口与书房关系图表 -->
    <div class="chart-container" style="margin-bottom: 90px;">
        <h3 style="color: #2980b9; margin-bottom: 15px; font-size: 1.4em; text-align: center;">人口与书房分布关系</h3>
        <div id="populationChart" style="width: 100%; height: 400px;"></div>
    </div>


    <!-- 人均书房资源分析图表 -->
        <!-- 人均书房资源分析图表 -->
        <div class="chart-container" style="margin-top: 90px;">
            <h3 style="color: #2980b9; margin-bottom: 15px; font-size: 1.4em; text-align: center;">人均书房资源分析</h3>
            <div id="perCapitaChart" style="width: 100%; height: 400px;"></div>
        </div>

        <p style="text-align: center; font-size: 0.9em; color: #666; margin-top: 100px; padding: 10px; background-color: #f8f9fa; border-radius: 4px;">注：人口数据来源于第七次全国人口普查数据。</p>

    <div class="chart-analysis" style="margin-top: 25px; padding: 15px; background-color: #e9f7fe; border-radius: 6px;">
        <h3 style="color: #3498db; margin-bottom: 10px; font-size: 1.3em;">分析结论</h3>
        <p style="line-height: 1.6; margin-bottom: 12px; text-indent: 2em; text-align: left;">从人口与书房分布关系看，人口较多的行政区（如洛龙区、涧西区）通常拥有更多的书房设施，这符合公共文化资源应当向人口密集区倾斜的原则。值得注意的是，伊川县虽然人口数量较大（约79万），但书房数量相对较少（9座），这可能与该区域的发展阶段和居民分布特点有关。</p>
        <p style="line-height: 1.6; margin-bottom: 12px; text-indent: 2em; text-align: left;">从行政区面积与书房布局关系看，洛阳市的书房分布更多地考虑了人口因素而非地域面积。城区（如涧西区、老城区）面积虽小但书房密度高，而县域地区（如嵩县、洛宁县）面积虽大但书房总面积相对较小。</p>
        <p style="line-height: 1.6; text-indent: 2em; text-align: left;">人均书房资源分析显示，市区（洛龙区、涧西区等）的人均书房面积普遍高于县域地区，但部分县区（如孟津区）人均资源较好，这表明洛阳市在推进城乡文化均衡发展方面取得了一定成效，但仍存在提升空间。未来可考虑进一步增加伊川县等人口较多但书房资源相对不足区域的文化设施投入。</p>
    </div>
</div>



<div class="spatial-distribution">
    <h2 class="section-title">探索城市书房分布与人口密度的关系</h2>
    <p class="section-description">
        通过城市书房分布与人口分布情况，直观感受洛阳全域阅读服务网络的密度与覆盖效果。
    </p>



    </div>
    <div class="map-preview-container" style="margin: 30px auto; max-width: 1200px; background: rgba(255, 255, 255, 0.9); padding: 0; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative;">
        <iframe id="populationMapPreview" src="population_map.html?preview=true" width="100%" height="500px" frameborder="0" style="border: none; display: block;" title="洛阳市人口热力分布地图预览" allowfullscreen></iframe>
        <a href="population_map.html" class="fullscreen-button" style="position: absolute; top: 10px; right: 10px; background: rgba(255, 255, 255, 0.9); padding: 8px 12px; border-radius: 4px; text-decoration: none; color: #333; font-size: 14px; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1000;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" fill="currentColor"/>
            </svg>
            <span>全屏查看</span>
        </a>
    </div>


</div>


    </div>

        <!-- 人口分布数据分析 -->
        <div class="analysis-section population-density-analysis" style="margin: 30px auto; max-width: 1200px; padding: 25px; background: #f8f9fa; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.06);">
            <h3 style="color: #2c3e50; font-size: 1.6em; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #e9ecef; text-align: center;">
                <i class="fas fa-map-marker-alt" style="color:#e74c3c; margin-right:8px;"></i>人口分布与书房覆盖分析 <span style="font-size: 0.7em; color: #666; font-weight: normal;">(基于热力图)</span>
            </h3>

            <!-- Use Flexbox for side-by-side layout -->
            <div class="analysis-content" style="display: flex; flex-wrap: wrap; gap: 25px; justify-content: space-around;">

                <!-- 覆盖范围分析 -->
                <div class="analysis-card coverage-analysis" style="flex: 1; min-width: 300px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid #3498db;">
                    <h4 style="color: #2980b9; font-size: 1.2em; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-bullseye"></i>
                        覆盖范围分析
                    </h4>
                    <!-- Removed inner grid for compactness -->
                    <div>
                        <h5 style="color: #333; font-size: 1.05em; margin-bottom: 8px;"> <i class="fas fa-check" style="color: green; font-size:0.9em;"></i> 已覆盖区域</h5>
                        <p style="color: #555; line-height: 1.7; margin-left: 20px;">
                            热力图显示，城市书房网络已有效覆盖市中心及各区县人口稠密的核心地带，与经济、文化、交通节点基本吻合。
                        </p>
                    </div>
                     <div style="margin-top: 15px;">
                        <h5 style="color: #333; font-size: 1.05em; margin-bottom: 8px;"><i class="fas fa-exclamation-triangle" style="color: orange; font-size:0.9em;"></i> 服务待提升区域</h5>
                        <p style="color: #555; line-height: 1.7; margin-left: 20px;">
                            城市边缘、部分县域（如地图所示的栾川、洛宁、汝阳外围）及人口相对稀疏地带，书房密度较低，存在服务覆盖的提升空间。
                        </p>
                    </div>
                </div>

                <!-- 改进建议 -->
                <div class="analysis-card improvement-suggestions" style="flex: 1; min-width: 300px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid #2ecc71;">
                     <h4 style="color: #27ae60; font-size: 1.2em; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                         <i class="fas fa-lightbulb"></i>
                         优化建议
                    </h4>
                     <!-- Removed inner grid for compactness -->
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #333; font-size: 1.05em; margin-bottom: 8px;"><i class="fas fa-compass" style="color: #27ae60; font-size:0.9em;"></i> 关注服务薄弱区</h5>
                        <p style="color: #555; line-height: 1.7; margin-left: 20px;">
                             未来规划可重点关注人口较多但书房相对不足的区域（如伊川县部分地区）及城市边界、远郊县的人口聚集点，提升服务的均衡性。
                        </p>
                    </div>
                     <div>
                        <h5 style="color: #333; font-size: 1.05em; margin-bottom: 8px;"><i class="fas fa-network-wired" style="color: #27ae60; font-size:0.9em;"></i> 多元网络协同</h5>
                        <p style="color: #555; line-height: 1.7; margin-left: 20px;">
                             结合农家书屋、流动服务点等现有资源，构建多层次、差异化的公共阅读服务网络，用更灵活的方式填补固定书房难以完全覆盖的区域。
                        </p>
                    </div>
                </div>
            </div> <!-- End of analysis-content flex container -->
        </div> <!-- End of analysis-section -->

    <div class="why-205-section">








    <div class="why-205-section">
        <h2 class="section-title" data-i18n="section_title_reading_transition">洛阳阅读空间的变迁</h2>
        <div class="past-present-container">
            <!-- 过去的洛阳 -->
            <div class="timeline-card past-card">
                <div class="card-header">
                    <h3 data-i18n="past_title">过去的洛阳</h3>
                    <div class="timeline-icon"><i class="fas fa-history"></i></div>
                </div>
                <p class="past-intro" data-i18n="past_intro">2017年前洛阳市仅有1家市级公共图书馆（洛阳市图书馆），大部分县(市)区已建立图书馆并与市图书馆形成"总分馆"服务体系，但覆盖范围仍有限。</p>

                <div class="city-library-stats">
                    <h4><i class="fas fa-book"></i> <span data-i18n="library_status_title">2017年前洛阳市图书馆资源状况</span></h4>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon"><i class="fas fa-building"></i></div>
                            <div class="stat-info">
                                <span class="stat-number">1</span>
                                <span class="stat-label" data-i18n="city_library_label">市级公共图书馆</span>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon"><i class="fas fa-sitemap"></i></div>
                            <div class="stat-info">
                                <span class="stat-number">14</span>
                                <span class="stat-label" data-i18n="district_library_label">县区级图书馆</span>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                            <div class="stat-info">
                                <span class="stat-number">32册</span>
                                <span class="stat-label" data-i18n="per_capita_borrowing">人均借阅量</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="problems-container">
                    <div class="problem-item">
                        <h4 data-i18n="problem_title"><i class="fas fa-exclamation-triangle"></i> 公共阅读空间不足</h4>
                        <div class="problem-details">
                            <div class="detail-item" data-i18n="problem_detail_1"><i class="fas fa-building"></i> 社区级公共图书馆或阅览室数量较少</div>
                            <div class="detail-item" data-i18n="problem_detail_2"><i class="fas fa-map-marker-alt"></i> 居民区周边缺乏便捷、安静的公益性阅读空间</div>
                        </div>
                    </div>

                    <div class="problem-item">
                        <h4 data-i18n="service_problem_title"><i class="fas fa-balance-scale"></i> 服务能力与市民需求矛盾</h4>
                        <div class="dialogue-box">
                            <p data-i18n="service_problem_desc">市级图书馆在节假日人流量高峰时段常需排队，人均可借阅资源紧张。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 今天的洛阳 -->
            <div class="timeline-card present-card">
                <div class="card-header">
                    <h3 data-i18n="present_title">今天的洛阳</h3>
                    <div class="timeline-icon"><i class="fas fa-star"></i></div>
                </div>

                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-icon" style="color: #2ecc71;"><i class="fas fa-book"></i></div>
                        <div class="stat-number" style="color: #2c3e50;" data-i18n="book_total">110万+</div>
                        <div class="stat-label" style="color: #7f8c8d;" data-i18n="book_total_label">馆藏图书</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon" style="color: #2ecc71;"><i class="fas fa-home"></i></div>
                        <div class="stat-number" style="color: #2c3e50;" data-i18n="library_total">205座</div>
                        <div class="stat-label" style="color: #7f8c8d;" data-i18n="library_total_label">城市书房</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon" style="color: #2ecc71;"><i class="fas fa-walking"></i></div>
                        <div class="stat-number" style="color: #2c3e50;" data-i18n="reading_circle_time">15分钟</div>
                        <div class="stat-label" style="color: #7f8c8d;" data-i18n="reading_circle_label">阅读文化圈</div>
                    </div>
                </div>

                <h4 class="features-title" data-i18n="modern_service">现代化服务</h4>
                <div class="features-grid">
                    <div class="feature-card">
                        <i class="fas fa-door-open"></i>
                        <h5 data-i18n="smart_convenient">智能便捷</h5>
                        <p data-i18n="smart_convenient_desc">刷码、刷卡或"刷脸"即可进入，全市通借通还</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-book-reader"></i>
                        <h5 data-i18n="rich_collection">丰富馆藏</h5>
                        <p data-i18n="rich_collection_desc">每个书房配备不少于5000册图书及多种报纸期刊</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-coffee"></i>
                        <h5 data-i18n="comfort_env">舒适环境</h5>
                        <p data-i18n="comfort_env_desc">配备冷暖空调、饮水机，部分书房引入咖啡轻食服务</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-calendar-alt"></i>
                        <h5 data-i18n="rich_resources">丰富资源</h5>
                        <p data-i18n="resources_desc">定期举办专题讲座、读书交流、非遗体验等活动</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-heart"></i>
                        <h5 data-i18n="thoughtful_service">贴心服务</h5>
                        <p data-i18n="service_desc">提供老花镜、雨伞等便民设施，免费WiFi覆盖</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-clock"></i>
                        <h5 data-i18n="flexible_time">灵活时间</h5>
                        <p data-i18n="time_desc">每天开放不少于12小时，部分实现24小时免费开放</p>
                    </div>

                </div>

            <div class="problem-item">
                <h4 data-i18n="service_problem_title" style="color: #2ecc71;"><i class="fas fa-book-reader"></i> 服务能力大幅提升</h4>
                <div class="dialogue-box" style="border-left: 4px solid #2ecc71;">
                    <p data-i18n="service_problem_desc" style="color: #27ae60;">605个阅读空间（含205个城市书房）构建起洛阳现代公共文化服务体系</p>
                </div>
            </div>
            </div>
        </div>
    </div>

    <style>

    </style>

    <!-- 添加过渡段落 -->
    <div class="data-transition" style="max-width: 900px; margin: 60px auto 40px; text-align: center; padding: 0 20px;">
        <h2 style="color: #2c3e50; margin-bottom: 25px; font-size: 1.8em;">从历史到数据：解读河洛书苑的成长密码</h2>
        <p style="color: #34495e; line-height: 1.8; font-size: 1.1em; margin-bottom: 30px;">
            河洛书苑从2017年的萌芽到如今的205座城市书房，走过了怎样的建设历程？
        </p>
        <div style="width: 60px; height: 4px; background: linear-gradient(to right, #2ecc71, #27ae60); margin: 0 auto;"></div>
    </div>

    <h1 data-i18n="main_title">河洛书苑生长笔记</h1>
    <div class="subtitle">记录一座城市的阅读梦想，从萌芽到茁壮成长的历程</div>

    <div class="timeline">
        <div class="timeline-item left">
            <div class="content">
                <h2>萌芽初始 (2017年)</h2>
                <div class="growth-stage">播撒书香种子，扎根城市土壤</div>
                <ul>
                    <li>7月26日：首家城市书房在瀍河区试营业 <a href="https://lyrb.lyd.com.cn/html2/2017-07/26/content_124355.htm?luicode=10000011&lfid=1076032197019337&u=http%3A%2F%2Flyrb.lyd.com.cn%2Fhtml2%2F2017-07%2F26%2Fcontent_124355.htm" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li>8月31日：提出构建"四位一体"全民阅读设施服务体系，要求各城市区至少建成1个面积不低于200平方米的24小时城市书房 <a href="https://news.lyd.com.cn/system/2017/08/31/030320113.shtml" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <!--我市将构筑以各级公共图书馆为基础，城市书房和线上图书馆(掌上图书馆)、流动图书馆、24小时自助图书馆为补充的"四位一体"全民阅读设施服务体系。今年年底，全市图书馆总分馆制建设初见成效，各城市区至少建成1个面积不低于200平方米、能够24小时提供开放服务的城市书房。2018年在试点书房建设的基础上，进一步扩大城市书房建设规模，加大设施设备配备建设力度。-->
                    <li class="policy">9月27日：发布《"书香洛阳"建设提升方案》</li>
                    <li>12月：西工区首个城市书房建成</li>
                    <li>12月底前首批5个城市书房建成</li>
                </ul>
            </div>
        </div>
        <div class="timeline-item right">
            <div class="content">
                <h2>茁壮生长 (2018年)</h2>
                <div class="growth-stage">破土而出，迅速发展</div>
                <ul>
                    <li>1月：洛龙区、嵩县、新安县多个书房投用</li>
                    <li>3月：计划年底前建成30个城市书房，完善全市通借通还服务体系</li>
                    <li>8月：市区已建成投用28座城市书房</li>
                    <li>12月：全市建成开放106座城市书房，藏书61万册</li>

                </ul>
            </div>
        </div>
        <div class="timeline-item left">
            <div class="content">
                <h2>枝繁叶茂 (2019-2020年)</h2>
                <div class="growth-stage">根深叶茂，制度完善</div>
                <ul>
                    <li>2019年2月：全市已建成投用城市书房110座，"15分钟阅读文化圈"基本形成 <a href="https://news.gmw.cn/2019-02/26/content_32561705.htm" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li class="policy">2019年8月12日：市文广局印发《洛阳市"河洛书苑"城市书房达标创优实施办法（试行）》<a href="https://www.wzlib.cn/uploads/content/file/20211031/1635645934194427050437724.pdf" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📄</a></li>
                    <li>2019年9月4日：全市已建成投用161座城市书房，藏书86.6万余册 <a href="https://news.lyd.com.cn/system/2019/09/04/031439943.shtml" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li class="policy">2020年6月16日：河南省文化和旅游厅出台政策支持洛阳"河洛书苑"建设 <a href="https://hct.henan.gov.cn/2020/06-19/1556268.html" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li>2020年7月：增至183座 <a href="https://www.henan.gov.cn/2020/07-23/1744486.html" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li>2020年8月：获央视《走遍中国》专题报道 <a href="https://tv.cctv.com/2019/08/09/VIDEDPvfbRA3ZeksuIgw39Hx190809.shtml" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📺</a></li>
                    <li>2020年9月：达202座，藏书106万册 <a href="https://news.lyd.com.cn/system/2020/09/30/031824104.shtml" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li class="policy">2020年12月31日：市政府印发《洛阳市"河洛书苑"城市书房建设管理办法》<a href="https://www.ly.gov.cn/2021/02-20/31631.html" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📄</a></li>
                </ul>
            </div>
        </div>
        <div class="timeline-item right">
            <div class="content">
                <h2>硕果累累 (2021-2024年)</h2>
                <div class="growth-stage">开花结果，文化传承</div>
                <ul>
                    <li>2022年8月：全市共建成河洛书苑205座（城市区141座、县区64座），总建筑面积3.2万平方米，藏书107万余册 <a href="https://hct.henan.gov.cn/2022/08-17/2562859.html" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li>2023年9月：形成"15分钟阅读圈"，打造城市书房建设新示范 <a href="https://www.dingxinwen.cn/detail/4991843" target="_blank" style="color: #2980b9; text-decoration: none; margin-left: 5px; font-size: 0.9em;">📰</a></li>
                    <li class="policy">2024年6月18日：市政府发布《关于推进河洛文化生态保护实验区建设的实施意见》，推动非遗元素融入城市书房</li>
                </ul>
            </div>
        </div>
    </div>


    <!-- 数据分析过渡部分 -->
    <div class="data-analysis-transition" style="max-width: 900px; margin: 40px auto; padding: 20px; background: rgba(46, 204, 113, 0.05); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
        <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.5em;"></h3>
        <p style="color: #34495e; line-height: 1.8; font-size: 1.1em; text-align: center; margin-bottom: 15px;">
            从2017年的5座到如今的205座，河洛书苑已经成为洛阳市民文化生活中不可或缺的一部分。
        </p>
        <p style="color: #34495e; line-height: 1.8; font-size: 1.1em; text-align: center; margin-bottom: 15px;">
            这些书房如何分布？建设和运营成本是多少？市民对此又有哪些反馈？
        </p>
        <p style="color: #34495e; line-height: 1.8; font-size: 1.1em; text-align: center; font-weight: 500;">
            让我们通过数据来解读这个"十五分钟阅读圈"背后的故事。
        </p>
        <div style="width: 80px; height: 4px; background: linear-gradient(to right, #2ecc71, #27ae60); margin: 25px auto 0;"></div>
    </div>
        <!-- 阅读场景图片展示 -->


        <!-- 图表说明 -->
        <div class="charts-intro">
            <p style="text-align: left; font-style: normal; font-size: 1.15em; text-indent: 2em; line-height: 1.7; margin: 18px 0; color: #000;">
                以下图表展示了洛阳城市书房的客流量分布和借阅情况，通过数据可视化直观呈现阅读空间的使用情况和市民阅读偏好。数据分析揭示了城市书房在不同时段、不同日期的使用规律，以及市民对各类书籍的借阅倾向，全面反映了"河洛书苑"项目的实际运营效果和社会价值。
            </p>
        </div>
        <!-- 图表展示区域 -->
        <div class="charts-container">
            <div class="charts-grid">
                <div class="chart-box">
                    <h3>分时段客流量情况</h3>
                    <div id="hourlyChart" style="width: 100%; height: 400px;"></div>
                    <p class="chart-description" style="text-align: left; font-size: 1.05em; text-indent: 2em; line-height: 1.6; color: #000;">
                        图表展示了一天中不同时段的平均客流量分布，数据显示城市书房呈现明显的"双峰"特征：上午9-11点和下午14-18点是两个主要客流高峰。其中下午14点达到全天最高值2083人次，比传统图书馆的早高峰模式更偏向于下午时段。这一分布特点反映了市民在午后休闲时间的阅读偏好，也表明城市书房已成为市民工作日午休及放学后的重要文化空间。
                    </p>
                    <div class="chart-box">
                        <h3>每日客流量情况</h3>
                        <div id="dailyChart" style="width: 100%; height: 400px;"></div>
                        <p class="chart-description" style="text-align: left; font-size: 1.05em; text-indent: 2em; line-height: 1.6; color: #000;">
                            图表展示了三周的客流量变化趋势，数据显示工作日平均客流量约为17000人次，而周末客流量明显高于工作日，周六高峰可达38476人次（2025-03-22），是平日的2.2倍。值得注意的是，法定节假日（2025-04-04）也呈现出较高客流量，达到30890人次，表明城市书房已成为市民节假日文化休闲的重要去处。周末、节假日与工作日明显的客流差异，反映了城市书房的功能已从传统图书借阅扩展为综合性文化休闲空间。
                        </p>
                    </div>
                    <div class="chart-box">
                        <h3>借阅书籍分类</h3>
                        <div id="subjectChart" style="width: 100%; height: 500px;"></div>
                        <p class="chart-description" style="text-align: left; font-size: 1.05em; text-indent: 2em; line-height: 1.6; color: #000;">
                            环形图反映了城市书房读者的借阅偏好分布，数据显示文学类图书以61.14%（10,442,367册）的绝对优势占据首位，远超其他类别。艺术类（7.23%）、历史地理类（5.84%）和文化教育类（5.56%）位居二至四位，共占比18.63%。社科类图书（包括政治法律、经济等）累计借阅占比约15%，而自然科学类图书总借阅比例不足10%。这一分布特点既体现了城市书房作为公共文化服务空间的大众化特征，也反映了市民阅读偏好以人文社科为主，休闲性阅读需求显著高于专业学习需求。
                        </p>
                    </div>
            </div>
        </div>

<!-- 建设成本分析 -->
<!-- 建设成本分析 -->
<div class="analysis-section">
    <h3>城市书房建设成本构成（万元）</h3>
    <div class="chart-container">
        <div id="costStructurePieChart" style="width: 100%; height: 300px;"></div>
    </div>
    <div class="cost-breakdown">
        <h4>城市书房建设成本分析结果 (基于已分析合同总额 ≈ 6059.2 万元):</h4>
        注：上图展示了对约 6059 万元可清晰分类的采购合同金额进行的构成分析，反映了这部分资金的主要流向。
        <div class="cost-items">
            <div class="cost-item">
                <span class="cost-label">房体建设成本</span>
                <span class="cost-value">1027.0万元</span>
                <span class="cost-percent">16.9%</span>
            </div>
            <div class="cost-item">
                <span class="cost-label">基础设施</span>
                <span class="cost-value">1223.0万元</span>
                <span class="cost-percent">20.2%</span>
            </div>
            <div class="cost-item">
                <span class="cost-label">智慧系统</span>
                <span class="cost-value">2617.0万元</span>
                <span class="cost-percent">43.2%</span>
            </div>
            <div class="cost-item">
                <span class="cost-label">图书资源</span>
                <span class="cost-value">1191.0万元</span>
                <span class="cost-percent">19.7%</span>
            </div>
        </div>
        <div class="cost-details">
            <h4>主要发现:</h4>
            <ul>
                <li><strong>智慧系统投入显著:</strong> 在公开采购的合同中，用于实现智能化、自助化服务的智慧系统投入占比最高 (约 43.2%)。这表明洛阳在提升用户体验和运营效率方面投入巨大。</li>
                <li><strong>基建与图书并重:</strong> 基础设施/装修 (20.2%) 和图书资源 (19.7%) 也是主要的资金流向，保障了阅读环境和核心内容。</li>
                <li><strong>房体建设:</strong> 房体建设成本占比约 16.9%，这部分成本可能因利用现有建筑改造或新建不同结构（如玻璃房）而有较大差异。</li>
            </ul>
            <p style="margin-top:10px; color: #34495e;">需要指出的是，根据对所有相关已成交合同的年度汇总，项目涉及的总合同金额远高于此分析样本（总计约 20074 万元），差额部分可能主要来自难以精确拆分到单一类别的大型总包合同或未纳入此次分类分析的其他采购。</p>
        </div>
            <div class="data-source" style="margin-top: 15px; font-size: 0.9em; color: #666; font-style: italic;">
                数据来源: 洛阳政府采购网，基于324份城市书房建设招投标公告分析整理
            </div>
        </div>
    </div>
</div>


<!-- 中型城市书房建设成本分析 -->
<div class="analysis-section">
    <h3>中型城市书房 (100-200㎡) 成本构成与金额区间估算</h3>
    <div class="chart-container">
        <div id="midSizeLibraryCostChart" style="width: 100%; height: 500px;"></div>
    </div>
    <div class="cost-breakdown">
        <h4>典型智慧型中型城市书房成本估算 (总投入约130-245万元)</h4>
        <div class="cost-items">
                <div class="cost-items"> <!-- Assuming this container uses flex or grid -->
        <div class="cost-item">
            <span class="cost-label">房体建设成本</span><br> <!-- Added break -->
            <span class="cost-value">40-75万元</span><br>   <!-- Added break -->
            <span class="cost-percent">(30-35%)</span>      <!-- Added parentheses for clarity -->
        </div>
        <div class="cost-item">
            <span class="cost-label">基础设施/装修/配套</span><br>
            <span class="cost-value">35-65万元</span><br> <!-- Corrected value -->
            <span class="cost-percent">(25-28%)</span>
        </div>
        <div class="cost-item">
            <span class="cost-label">智慧系统</span><br>
            <span class="cost-value">35-60万元</span><br> <!-- Corrected value -->
            <span class="cost-percent">(25-30%)</span>
        </div>
        <div class="cost-item">
            <span class="cost-label">图书资源 (初始)</span><br>
            <span class="cost-value">15-30万元</span><br>
            <span class="cost-percent">(10-15%)</span>
        </div>

    </div>
        </div>
        <div class="mid-size-analysis" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #3498db;">
            <h3 style="color: #2c3e50; margin-bottom: 15px; text-align: center; font-size: 1.5em;">典型中型智慧书房 (100-200㎡) 建设成本构成估算</h3>

            <p style="text-align: center; margin-bottom: 20px; font-size: 1.1em; color: #34495e;">
                根据对洛阳市政府采购数据及相关建设标准的分析，建设一个典型的、具备智能化服务能力的中型城市书房（面积介于100至200平方米），其总投入预计在 <strong>130 万元至 245 万元</strong> 之间。主要成本构成细分如下：
            </p>

            <ul style="list-style: none; padding-left: 0;">
                <li style="margin-bottom: 15px; padding-left: 25px; position: relative;">
                    <i class="fas fa-hard-hat" style="position: absolute; left: 0; top: 5px; color: #e74c3c;"></i>
                    <strong>1. 房体建设成本 (占比约 30%-35%，金额约 40-75 万元):</strong>
                    <p style="margin-top: 5px; color: #555; line-height: 1.6;">此部分成本覆盖从基础到主体的建设。采用标准化、预制化结构（如常见的独立玻璃房体），因其模块化和规模化生产优势，可能使成本接近区间下限（约40万元）；而融入复杂建筑设计、采用特殊材料或对现有结构进行大规模定制化改造的项目，则可能因其独特性和更高的施工要求使成本达到或超过区间上限（约75万元）。</p>
                </li>
                <li style="margin-bottom: 15px; padding-left: 25px; position: relative;">
                    <i class="fas fa-couch" style="position: absolute; left: 0; top: 5px; color: #f39c12;"></i>
                    <strong>2. 基础设施/装修/配套 (占比约 25%-28%，金额约 35-65 万元):</strong>
                    <p style="margin-top: 5px; color: #555; line-height: 1.6;">涵盖内部空间的装修装饰（地面、墙面、吊顶）、水电暖通改造或安装、照明系统以及基础家具（书架、阅览桌椅、服务台等）。中型书房需容纳更多读者，通常涉及更精细的空间规划、更多的家具配置和更高的环境舒适度要求（如空调选择）。</p>
                </li>
                <li style="margin-bottom: 15px; padding-left: 25px; position: relative;">
                     <i class="fas fa-robot" style="position: absolute; left: 0; top: 5px; color: #3498db;"></i>
                    <strong>3. 智慧系统 (占比约 25%-30%，金额约 35-60 万元):</strong>
                    <p style="margin-top: 5px; color: #555; line-height: 1.6;">这是实现智能化服务的核心投入，包括自助借还设备、自助办证设备、安全门禁系统（RFID或人脸识别）、全覆盖的视频监控系统、图书管理软件平台以及必要的网络设备（Wi-Fi、内部网络）。虽然核心自助设备数量不一定随面积严格等比增加，但覆盖更大区域所需的监控点位、网络布线复杂度及设备数量会相应提升。</p>
                </li>
                <li style="margin-bottom: 15px; padding-left: 25px; position: relative;">
                    <i class="fas fa-book-open" style="position: absolute; left: 0; top: 5px; color: #2ecc71;"></i>
                    <strong>4. 图书资源 (初始配置，占比约 10%-15%，金额约 15-30 万元):</strong>
                    <p style="margin-top: 5px; color: #555; line-height: 1.6;">指开馆时首次配备的纸质图书和可能的电子书资源。根据《洛阳市"河洛书苑"城市书房建设管理办法》等标准，城市书房通常要求配置不少于5000册图书。为达到10%-15%的成本占比（约15-30万元），并满足中型书房的服务需求，实际配置量可能会在此基础上有所增加，以保证足够的阅读选择和流转基础。</p>
                </li>
                 <li style="margin-bottom: 15px; padding-left: 25px; position: relative;">
                    <i class="fas fa-pencil-ruler" style="position: absolute; left: 0; top: 5px; color: #95a5a6;"></i>
                    <strong>5. 其他费用 (估算占比约 2%-5%，金额约 5-15 万元):</strong>
                    <p style="margin-top: 5px; color: #555; line-height: 1.6;">包括项目前期的规划设计费、可行性研究（如需）、工程监理费以及一定比例的不可预见费（预备金）。这部分费用在公开的设备或施工采购合同中较少单独列出，但属于项目整体投入的一部分。</p>
                </li>
            </ul>

            <p class="note" style="margin-top: 20px; font-size: 0.95em; color: #7f8c8d; line-height: 1.6;">
                <strong>请注意：</strong> 上述成本构成和金额区间为基于现有数据和普遍建设标准的估算。单个书房的实际总成本会因具体选址条件（例如是利用现有建筑改造还是完全新建）、设计方案的复杂程度、建筑和装修材料的选择、设备品牌和配置等级、采购时期的市场价格以及是否包含土地成本（通常公共项目土地为划拨）等多种因素而产生显著差异。
            </p>

<div class="data-source" style="margin-top: 15px; font-size: 0.9em; color: #666; font-style: italic; text-align: left;">
    数据来源: 估算结果结合了对洛阳市相关政府采购合同数据的分析，并参考了《洛阳市"河洛书苑"城市书房建设管理办法》等公开信息对中型书房规模进行的推算。
</div>
        </div>
    </div>


<!-- 建设成本趋势 -->
<div class="analysis-section">
    <h3>建设成本变化趋势探讨 (2017-2024)</h3>
    <div class="chart-container">
        <!-- 替换canvas为div容器 -->
        <div id="costTrendEChart" style="width: 100%; height: 400px;"></div>
    </div>
    <div class="trend-description">
        <p>上图展示了根据已成交的政府采购合同数据汇总的洛阳城市书房相关项目年度总金额变化情况（2017-2024年，2023年数据缺失）。该图表反映了项目在不同年份的公开采购投入规模。</p>
        <p>主要趋势观察如下：</p>
        <ul>
            <li><strong>显著的建设高峰期:</strong> 2018年（合同总额约 8824 万元）和 2019年（约 6601 万元）显示出项目投入的绝对峰值。这清晰地表明这两个年份是洛阳市大规模推进城市书房建设、进行集中设备采购和工程实施的核心阶段。</li>
            <li><strong>投入逐步放缓:</strong> 从 2020 年（约 3614 万元）开始，记录在案的年度合同总额呈现明显的逐级下降趋势，至 2024 年（约 120 万元）已大幅减少。这符合大型公共文化设施建设的一般规律：在完成主体建设布局后，投入重点逐渐转向运营维护、资源更新（如图书持续采购）、技术升级或针对性的补充建设。</li>
            <li><strong>成本优化潜力探讨:</strong> 虽然此图表衡量的是年度总投入而非单体成本，但项目从试点到大规模建设再到常态化运营的演进过程，通常伴随着标准化流程的建立、集中采购带来的规模效益以及建设管理经验的提升。这些因素为后续类似项目或现有书房的升级改造提供了成本优化的可能性。</li>
        </ul>
        <p class="policy-note" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-left: 4px solid #2980b9;">
            📋 《洛阳市"河洛书苑"城市书房建设管理办法》中关于统一规划、集中招标采购的要求，为项目成本的有效控制和效率提升奠定了政策基础。
        </p>
        <div class="data-source" style="margin-top: 15px; font-size: 0.9em; color: #666; font-style: italic; text-align: left; text-indent: 2em;">
            图表数据源自对公开采购合同记录的年度汇总，反映年度投入规模变化。2023年数据缺失。
        </div>
    </div>
</div>



    <!--解释一下洛阳为什么建设这么快的情况下仍然保持书房整体品质-->
    <!-- 书房面积分布 -->



    </div>
        <!-- 挑战与解决方案：洛阳模式的探索与价值 -->
        <div class="analysis-section" style="margin-top: 40px; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #eef9f0 0%, #f8fdfa 100%); border-radius: 15px; box-shadow: 0 8px 25px rgba(46, 204, 113, 0.1);">

            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 25px; font-size: 2em; font-weight: 600;">
                <i class="fas fa-seedling" style="color: #27ae60; margin-right: 10px;"></i>破解投入难题：洛阳“共建共享”模式的探索之路
            </h2>

            <!-- 引入挑战 -->
            <div class="challenge-box" style="background: rgba(255, 255, 255, 0.8); border-left: 5px solid #e74c3c; border-radius: 8px; padding: 20px; margin-bottom: 30px; box-shadow: 0 3px 8px rgba(0,0,0,0.05);">
                <h4 style="color: #c0392b; margin-bottom: 15px; display: flex; align-items: center; font-size: 1.4em;">
                    <i class="fas fa-exclamation-circle" style="margin-right: 10px; font-size: 1.2em;"></i> 高速扩张背后的“成本之问”
                </h4>
                <p style="line-height: 1.8; color: #34495e; text-indent: 2em;">
                    正如我们之前的成本分析所揭示的，建设一座现代化的中型智慧城市书房，初期投入往往达到百万元级别（估算约130-245万元）。要在短时间内建成遍布全城的205座“河洛书苑”，这对任何城市的财政来说都是一个巨大的挑战。不仅如此，建成后的长期运营维护——包括人员、水电、网络、设备折旧、图书更新等，每年也需要持续投入（估算约十几万元/座），这无疑给城市书房的可持续发展带来了严峻考验。
                </p>
            </div>

            <!-- 提出解决方案：洛阳模式 -->
            <div class="solution-highlight" style="margin-bottom: 30px;">
                <h3 style="color: #27ae60; margin-bottom: 15px; font-size: 1.8em;">洛阳的答案："多元共建，协同共享"</h3>
                <p style="font-size: 1.2em; color: #34495e; line-height: 1.7; text-indent: 2em; width: 100%;">
                    面对资金压力和可持续运营的难题，洛阳没有仅仅依赖政府财政"大包大揽"，而是创新性地探索出了一条"政府主导、社会参与、专业运营、共建共享"的发展新路径。这不仅是解决资金问题的务实之举，更是激发城市活力、实现文化惠民长效化的智慧探索。
                </p>
           </div>

<!-- 具体措施 -->
<div style="margin-bottom: 30px;">
    <!-- 政府"搭台"部分 -->
    <div style="background: #ffffff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); margin-bottom: 20px;">
        <h4 style="color: #3498db; margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
            <i class="fas fa-landmark" style="margin-right: 10px;"></i> 政府"搭台"：明确分工与标准
        </h4>

        <!-- 横向排列的小标题 -->
        <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
            <div style="flex: 1; min-width: 300px;">
                <div style="display: flex; align-items: start;">
                    <i class="fas fa-check-circle" style="color: #3498db; margin-right: 8px; margin-top: 4px;"></i>
                    <div>
                        <strong>分级保障:</strong> 市级财政聚焦核心投入（如智能设备、基础图书），区县财政承担场地建设和日常运营，明确责任，减轻单一层级压力。
                    </div>
                </div>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div style="display: flex; align-items: start;">
                    <i class="fas fa-check-circle" style="color: #3498db; margin-right: 8px; margin-top: 4px;"></i>
                    <div>
                        <strong>标准引领:</strong> 出台《建设管理办法》、《达标创优办法》，统一建设规范和服务标准，确保品质，也为社会力量参与提供了清晰指引。
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 社会"唱戏"部分 -->
    <div style="background: #ffffff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06);">
        <h4 style="color: #2ecc71; margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
            <i class="fas fa-users" style="margin-right: 10px;"></i> 社会"唱戏"：引入多元力量
        </h4>

        <!-- 横向排列的小标题 -->
        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            <div style="flex: 1; min-width: 300px;">
                <div style="display: flex; align-items: start;">
                    <i class="fas fa-handshake" style="color: #2ecc71; margin-right: 8px; margin-top: 4px;"></i>
                    <div>
                        <strong>企业合作:</strong> 鼓励企业通过冠名、捐建、提供场地（如商业综合体、园区）等多种形式参与，实现品牌价值与社会责任双赢。
                    </div>
                </div>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div style="display: flex; align-items: start;">
                    <i class="fas fa-recycle" style="color: #2ecc71; margin-right: 8px; margin-top: 4px;"></i>
                    <div>
                        <strong>空间盘活:</strong> 充分利用公园、社区中心、闲置厂房、学校临街空间等存量资源进行改造，节约土地和新建成本。
                    </div>
                </div>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div style="display: flex; align-items: start;">
                    <i class="fas fa-cogs" style="color: #2ecc71; margin-right: 8px; margin-top: 4px;"></i>
                    <div>
                        <strong>专业运营:</strong> 引入图书馆、文化机构或第三方专业团队参与部分书房的管理运营，提升服务效率和专业水平。
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 价值与意义 -->
<div class="win-win" style="background: rgba(255, 255, 255, 0.9); border: 1px solid #e0e0e0; border-radius: 10px; padding: 25px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.07);">
    <h3 style="color: #2980b9; margin-bottom: 20px; text-align: center; font-size: 1.5em;">
        <i class="fas fa-lightbulb" style="margin-right: 10px;"></i>"洛阳模式"的价值与启示
    </h3>

    <!-- 使用flex布局实现横向排列 -->
    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 15px; margin-bottom: 20px;">
        <div class="value-item" style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center;">
            <i class="fas fa-book-reader fa-2x" style="color: #2980b9; margin-bottom: 10px;"></i>
            <h5 style="color: #2c3e50; margin-bottom: 5px;">服务效能提升</h5>
            <p style="font-size: 0.95em; color: #555; line-height: 1.6;">快速形成覆盖广泛、便捷可及的"15分钟阅读圈"，显著提升了公共文化服务水平。</p>
        </div>
        <div class="value-item" style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center;">
            <i class="fas fa-building fa-2x" style="color: #2980b9; margin-bottom: 10px;"></i>
            <h5 style="color: #2c3e50; margin-bottom: 5px;">企业价值彰显</h5>
            <p style="font-size: 0.95em; color: #555; line-height: 1.6;">参与共建的企业提升了社会形象和品牌美誉度，实现了社会效益与经济效益的结合。</p>
        </div>
        <div class="value-item" style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center;">
            <i class="fas fa-city fa-2x" style="color: #2980b9; margin-bottom: 10px;"></i>
            <h5 style="color: #2c3e50; margin-bottom: 5px;">城市活力激发</h5>
            <p style="font-size: 0.95em; color: #555; line-height: 1.6;">书房成为新的文化地标和社交空间，吸引人流，带动周边区域发展，提升城市文化魅力。</p>
        </div>
    </div>

    <!-- 单独一行居中显示"可持续发展探索" -->
    <div style="display: flex; justify-content: center; margin-bottom: 20px;">
        <div class="value-item" style="width: 300px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center;">
            <i class="fas fa-recycle fa-2x" style="color: #2980b9; margin-bottom: 10px;"></i>
            <h5 style="color: #2c3e50; margin-bottom: 5px;">可持续发展探索</h5>
            <p style="font-size: 0.95em; color: #555; line-height: 1.6;">通过多元投入分担财政压力，结合适度经营探索（如书房+咖啡/文创），为长期运营提供了更强的韧性。</p>
        </div>
    </div>

    <p style="margin-top: 15px; text-align: center; font-size: 1.1em; color: #2c3e50; font-weight: 500; line-height: 1.7;">
        这种政府引导、市场运作、社会参与的协同机制，不仅有效破解了大规模公共文化设施建设的资金瓶颈，更为全国其他城市建设城市书房、推进全民阅读提供了宝贵的、可借鉴的"洛阳经验"。
    </p>
</div>



<!-- 市民反馈分析: 问题类型与部门分布 -->
<div class="analysis-section feedback-analysis" style="background-color: #fdfefe; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.07); margin-bottom: 40px;">

    <h2 class="section-title" style="font-size: 1.8em; margin-bottom: 20px;">
        <i class="fas fa-comments" style="color: #3498db; margin-right: 10px;"></i>市民反馈热点分析：问题类型与主要反馈部门
    </h2>

    <!-- 热力图容器 -->
    <div id="heatmap_container" style="width: 100%; height: 450px; margin-bottom: 15px;">
        <!-- Plotly 图表将在此渲染 -->
    </div>

    <!-- 数据说明 -->
    <div class="data-description" style="font-size: 0.9em; color: #6c757d; line-height: 1.6; padding: 12px 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef; margin-bottom: 30px;">
        <p style="margin: 0;">
            <i class="fas fa-info-circle" style="margin-right: 5px; color: #17a2b8;"></i>
            <strong>数据说明:</strong> 本热力图基于洛阳网“百姓呼声”栏目公开数据中筛选出的 1439 条与“河洛书苑”或城市书房相关的有效反馈。为聚焦核心议题，图表仅展示反馈量排名前 10 的部门与两大主要问题类别（设施环境、运营服务）的交叉分布情况，已剔除少量未公开及占比极低的“其他问题”类别数据。
        </p>
    </div>

    <!-- 分析解读 -->
    <div class="analysis-interpretation" style="line-height: 1.7;">

        <h4 style="font-size: 1.4em; margin-bottom: 15px; color: #2c3e50; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
            <i class="fas fa-chart-bar" style="color: #28a745; margin-right: 8px;"></i>核心洞察解读
        </h4>

        <p style="margin-bottom: 15px; color: #34495e;">
            热力图直观地展示了市民反馈的集中点。综合来看：
        </p>
        <ul style="list-style: none; padding-left: 0; margin-bottom: 25px;">
            <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <i class="fas fa-cogs" style="color: #fd7e14; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>运营服务问题成为关注焦点:</strong> 在反馈量最大的前 10 个部门中，“运营服务问题”的总反馈量 (853条) 显著高于“设施环境问题”(729条)。这清晰地表明，随着城市书房网络基本建成，市民的关注重心已从基础硬件转向日常的管理水平、服务质量、开放规则的合理性以及人员互动体验等方面。</div>
            </li>
             <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                 <i class="fas fa-map-marker-alt" style="color: #dc3545; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>反馈高度集中于主城区:</strong> 涧西区 (总计 314 条相关反馈) 和 洛龙区 (总计 293 条) 是反馈的主要来源地，这与区域内书房数量多、人口密度大、市民使用频率高密切相关，也意味着这些区域的服务和管理面临更大的挑战和更高的市民期望。</div>
            </li>
             <li style="display: flex; align-items: flex-start;">
                <i class="fas fa-landmark" style="color: #6f42c1; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>主管部门是政策反馈关键节点:</strong> 市文广旅局 作为行业主管部门，接收了大量关于运营服务（如政策、管理规定）的反馈，凸显了其在顶层设计、标准制定和监督管理中的核心作用。</div>
            </li>
        </ul>

        <h4 style="font-size: 1.4em; margin: 25px 0 15px; color: #2c50; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
            <i class="fas fa-map-pin" style="color: #ffc107; margin-right: 8px;"></i>区域问题特征细分 (结合数据与区域特点分析) <!-- 更新标题以反映内容 -->
        </h4>

        <ul style="list-style: none; padding-left: 0;">
             <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                 <i class="fas fa-cogs" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                 <div><strong>涧西区 (运营服务类反馈相对集中):</strong> 作为成熟的中心城区，该区域书房使用频率较高，市民对日常管理规范、服务细节（如开放时间、人员态度、活动组织等）的关注度和期望值也可能相对更高。数据显示其运营服务反馈量(176条)显著多于设施环境类(138条)，印证了当硬件设施基本满足后，运营层面的问题更容易成为反馈焦点。</div> <!-- 结合推测和数据 -->
            </li>
             <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                 <i class="fas fa-building" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>洛龙区 (设施环境类反馈相对突出):</strong> 作为洛阳市重点发展的新城区，人口增长快，公共设施使用强度大。数据显示其设施环境反馈量(161条)居于首位，且多于运营服务类(132条)。尽管书房建设时间不长，但高密度、高频率的使用可能更快地暴露或放大了硬件设施、空间布局、座位配置、环境维护（如空调、卫生）等方面存在的问题或压力点。</div> <!-- 结合推测和数据 -->
            </li>
             <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <i class="fas fa-balance-scale" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>其他主城区 (瀍河、老城、西工):</strong> 数据反映这些区域在设施环境和运营服务两类问题上的反馈数量较为接近或互有侧重（如西工区运营服务类63条略多于设施环境类52条）。这表明市民对这些区域书房的关注点分布相对均衡，涉及硬件维护和软件服务的双重需求。</div> <!-- 基于数据的描述 -->
            </li>
            <li style="display: flex; align-items: flex-start;">
                 <i class="fas fa-chart-line" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>新兴/县区/周边区域 (伊滨、孟津、偃师、伊川等):</strong> 尽管总反馈量相对较低，但数据显示其中部分区域（如孟津区运营服务类35条，远超设施环境类18条；伊川县运营服务类21条，多于设施环境类10条）运营服务类反馈数量明显超过设施环境类。这可能暗示随着书房网络向外围扩展，确保服务规范和管理到位是这些区域面临的重要课题。</div> <!-- 基于数据的描述和谨慎推测 -->
            </li>
        </ul>
        <!-- 总结与政策回应 -->
        <div class="summary-conclusion" style="margin-top: 30px; padding: 20px; background-color: rgba(46, 204, 113, 0.05); border-radius: 8px; border-left: 5px solid #2ecc71;">
             <h4 style="font-size: 1.4em; margin-bottom: 15px; color: #27ae60;">
                 <i class="fas fa-check-circle" style="margin-right: 8px;"></i>总结：从"建好"到"管好用好"的深化
             </h4>
             <p style="font-size: 1.05em; color: #34495e; line-height: 1.8; text-indent: 2em; margin-bottom: 15px;">
                市民反馈数据清晰地指向一个核心趋势：随着"河洛书苑"网络化布局的基本完成，运营管理和服务效能已成为影响市民体验、决定书房口碑的关键因素。正如一句常被引用的话所指出的，<a href="https://nepaper.ccdy.cn/html/2019-09/10/content_270329.htm" target="_blank" style="color: #007bff;">"城市书房三分靠建、七分靠管"</a>，后续的精细化管理至关重要。
            </p>
        </div>
            <p style="font-size: 1.05em; color: #34495e; line-height: 1.8; text-indent: 2em;">
                面对市民在开放时间、人员服务、空间规划、噪音控制等方面提出的具体问题和建议，洛阳市展现了持续优化的决心。通过因地制宜地探索管理模式，并先后印发《洛阳市“河洛书苑”城市书房达标创优实施办法》和《洛阳市“河洛书苑”城市书房建设管理办法》等关键性政策文件，建立了从建设标准到运营规范、再到服务评估的完整体系。定期的运行效果评估机制更是将市民的反馈和实际使用情况纳入持续改进的闭环中。这种从“建好”向“管好、用好”的深化，不仅是对市民呼声的积极回应，更是保障城市书房这一文化惠民工程能够长期发挥效能、真正融入市民生活的关键所在。
            </p>
        </div>
    </div>





<!-- 市民反馈时间趋势分析 -->
<!-- 市民反馈时间趋势分析 -->
<div class="analysis-section feedback-time-trend" style="margin-bottom: 40px;"> <!-- Added class -->
    <h3 class="section-title" style="font-size: 1.6em; margin-bottom: 10px;">
        <i class="fas fa-chart-line" style="color: #6f42c1; margin-right: 8px;"></i>市民反馈强度时间趋势 (按月)
    </h3>
    <p style="text-align: center; color: #6c757d; margin-top: -5px; margin-bottom: 20px; font-size: 0.95em;">
        下图展示了2017年底至2025年初市民反馈数量的月度变化。点击图例可切换查看咨询、建议、投诉的单项趋势或总反馈量趋势。
    </p>

    <!-- 图表容器 -->
    <div id="feedbackMonthlyTrendChart" style="width: 100%; height: 450px; margin-bottom: 15px;">
        <!-- ECharts 图表将在此渲染 -->
    </div>

    <!-- 数据说明 -->
    <div class="data-description" style="font-size: 0.9em; color: #6c757d; line-height: 1.6; padding: 12px 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef; margin-bottom: 25px;">
        <p style="margin: 0;">
            <i class="fas fa-info-circle" style="margin-right: 5px; color: #17a2b8;"></i>
            <strong>数据说明:</strong> 数据来源于洛阳网“百姓呼声”平台与“河洛书苑”相关的1439条公开反馈记录，按月份统计。可通过图例交互查看不同强度类型反馈的变化。
        </p>
    </div>

    <!-- 分析解读 -->
    <div class="analysis-interpretation trend-analysis-text" style="line-height: 1.7; color: #34495e;">
        <h4 style="font-size: 1.4em; margin-bottom: 15px; color: #2c3e50; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
             <i class="fas fa-wave-square" style="color: #fd7e14; margin-right: 8px;"></i>趋势解读：波动中的常态与特殊峰值
        </h4>

        <p style="margin-bottom: 15px; text-indent: 2em;">
            整体来看，市民对城市书房的反馈呈现出持续性和周期性波动的特点。自2019年书房网络大规模建成以来，每月均有一定数量的反馈产生，表明市民对这一公共文化设施的关注度和使用度长期保持活跃。
        </p>

        <ul style="list-style: none; padding-left: 0; margin-bottom: 20px;">
            <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <i class="fas fa-calendar-alt" style="color: #28a745; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>季节性波动:</strong> 反馈数量在夏季（尤其是6月、7月） 往往出现年度高峰。这可能与暑期学生群体集中使用书房自习，导致座位紧张、噪音管理难度加大等问题更易凸显有关。</div>
            </li>
            <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                 <i class="fas fa-exclamation-triangle" style="color: #dc3545; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>特殊事件驱动的峰值 - 以 2022 年 7 月为例:</strong> 该月反馈量（71条）达到历史高点，且通过对当月反馈内容的深入分析（如前所示），发现投诉类反馈占比极高。这主要归因于当时疫情防控政策调整导致的部分书房关闭、开放时间缩短或采取限流措施，引发了大量市民的不满与咨询。同时，暑期高峰需求进一步加剧了座位、噪音等管理矛盾。这个峰值清晰地揭示了城市书房在应对外部突发事件和满足高峰期需求时所面临的压力与挑战。</div>
            </li>
             <li style="display: flex; align-items: flex-start;">
                <i class="fas fa-chart-area" style="color: #ffc107; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>投诉反馈的持续性:</strong> 从分项趋势（可通过点击图例查看）来看，投诉类反馈在大部分时间段内都占据了相当比例，甚至常常是数量最多的反馈类型。这再次印证了前面分析得出的结论：在硬件设施逐步完善后，提升运营管理水平、解决服务过程中的具体问题，是城市书房持续面临并需要不断改进的核心任务。</div>
            </li>
        </ul>
        <p style="font-size: 1.05em;">
            通过时间趋势分析不仅展示了反馈量的起伏，更重要的是揭示了影响这些变化的潜在因素（季节性、特殊事件），并突出了运营管理和服务优化对于提升市民满意度的长期重要性。
        </p>
    </div>
</div>
<!-- 市民反馈分析 -->
<!-- 市民反馈分析 -->
<!-- 反馈强度月度热力图分析 -->
<div class="analysis-section feedback-heatmap-analysis" style="margin-bottom: 40px;"> <!-- Added class -->
    <h3 class="section-title" style="font-size: 1.6em; margin-bottom: 10px;">
        <i class="fas fa-calendar-alt" style="color: #e83e8c; margin-right: 8px;"></i>反馈强度月度热力图
    </h3>

    <!-- 图表控制与容器 -->
    <div class="chart-controls" style="text-align: center; margin-bottom: 15px;">
        <label for="feedback-type-selector" style="margin-right: 10px; font-weight: 500; color: #495057;">选择反馈类型:</label>
        <select id="feedback-type-selector" class="form-control" style="display: inline-block; width: auto; padding: 5px 10px; border-radius: 4px; border: 1px solid #ced4da;">
            <option value="all" selected>全部反馈</option>
            <option value="咨询">咨询</option>
            <option value="建议">建议</option>
            <option value="投诉">投诉</option>
        </select>
    </div>
    <div id="feedback-heatmap" style="width: 100%; height: 500px; margin-bottom: 15px;">
        <!-- Plotly 热力图将在此渲染 -->
    </div>

    <!-- 数据说明 -->
    <div class="data-description" style="font-size: 0.9em; color: #6c757d; line-height: 1.6; padding: 12px 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef; margin-bottom: 25px;">
        <p style="margin: 0;">
            <i class="fas fa-info-circle" style="margin-right: 5px; color: #17a2b8;"></i>
            <strong>数据说明:</strong> 本热力图展示了 2017 年底至 2025 年初，不同年份各月份的反馈数量分布。颜色从浅黄（少）到深红（多），直观反映反馈热度。可通过下拉菜单筛选查看特定反馈强度（咨询、建议、投诉）或全部反馈的月度分布模式。
        </p>
    </div>

    <!-- 分析解读 -->
    <div class="analysis-interpretation heatmap-analysis-text" style="line-height: 1.7; color: #34495e;">
        <h4 style="font-size: 1.4em; margin-bottom: 15px; color: #2c3e50; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0;">
             <i class="fas fa-fire-alt" style="color: #dc3545; margin-right: 8px;"></i>热力图解读：洞察反馈模式
        </h4>

        <p style="margin-bottom: 15px; text-indent: 2em;">
            通过交互式热力图，我们可以更细致地观察市民反馈在时间和强度上的分布规律，印证并补充之前的趋势分析结论：
        </p>

        <ul style="list-style: none; padding-left: 0; margin-bottom: 20px;">
            <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <i class="fas fa-thermometer-half" style="color: #ffc107; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>季节性热点清晰可见:</strong> 无论是在“全部反馈”视图下，还是切换到“投诉”或“建议”视图，夏季（尤其是6月、7月） 的色块普遍偏深，再次确认了夏季是反馈的高峰期。这与学生暑假集中使用、天气炎热（空调问题易发）等因素高度相关。</div>
            </li>
            <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                 <i class="fas fa-exclamation-circle" style="color: #dc3545; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>聚焦 2022 年 7 月的异常高热:</strong> 在“全部反馈”和“投诉”视图下，2022 年 7 月的色块呈现出最深的颜色（对应 71 条总反馈和 43 条投诉），视觉上极度突出。这直观地印证了该月份由疫情影响和暑期压力叠加造成的反馈激增，特别是投诉反馈在该时期的集中爆发。</div>
            </li>
             <li style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <i class="fas fa-balance-scale" style="color: #6f42c1; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>投诉反馈的普遍性:</strong> 切换到“投诉”视图，可以看到深色（代表较高投诉量）的色块广泛分布在不同年份和月份中，尤其是在 2020 年下半年之后。相比之下，“咨询”和“建议”视图的色块整体偏浅。这再次从时间和强度分布的角度证明了投诉是市民反馈的主要形式之一，反映出服务提升的持续需求。</div>
            </li>
             <li style="display: flex; align-items: flex-start;">
                <i class="fas fa-search" style="color: #007bff; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div><strong>咨询与建议的相对平稳:</strong> “咨询”和“建议”视图的颜色分布相对更均匀，没有出现像投诉那样极端的峰值，但也存在一定的季节性波动（例如咨询在某些年初或年末可能略高）。</div>
            </li>
        </ul>

    </div>
</div>


<!-- 具体问题分类分析 -->
<div class="analysis-section specific-feedback-analysis" style="margin-bottom: 40px;">
    <h3 class="section-title" style="font-size: 1.6em; margin-bottom: 20px;">
        <i class="fas fa-tags" style="color: #17a2b8; margin-right: 8px;"></i>市民反馈具体问题分类解析
    </h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; align-items: flex-start;">
        <!-- 一级分类占比图 -->
        <div class="chart-container-pie">
             <h4 style="text-align: center; font-size: 1.2em; margin-bottom: 10px; color: #495057;">主要反馈领域分布</h4>
            <canvas id="level1FeedbackChart" style="max-height: 350px;"></canvas>
             <div class="analysis-text" style="margin-top: 15px; font-size: 1em; color: #34495e; line-height: 1.6;">
                 <p><i class="fas fa-info-circle" style="color: #007bff; margin-right: 5px;"></i>如图所示，超过半数 (约55%) 的市民反馈集中于<strong>运营服务</strong>层面，如开放时间、人员管理等。<strong>设施环境</strong>问题也占据了显著比例 (约41%)。</p>
             </div>
        </div>

        <!-- Top 10 二级分类条形图 -->
        <div class="chart-container-bar">
             <h4 style="text-align: center; font-size: 1.2em; margin-bottom: 10px; color: #495057;">Top 10 具体反馈问题</h4>
            <canvas id="level2FeedbackChart" style="max-height: 400px;"></canvas>
             <div class="analysis-text" style="margin-top: 15px; font-size: 1em; color: #34495e; line-height: 1.6;">
                 <p><i class="fas fa-info-circle" style="color: #007bff; margin-right: 5px;"></i>在具体问题上，<strong>开放时间调整、人员服务问题、空间规划与选址</strong>是市民反馈最集中的三大核心议题。噪音、空调、卫生、座位等也是影响体验的关键因素。</p>
             </div>
        </div>
    </div>

    <!-- 整合管理办法的总结分析 -->
    <div class="policy-response-summary" style="margin-top: 30px; padding: 25px; background-color: #f0f8ff; border-radius: 8px; border-left: 5px solid #007bff;">
        <h4 style="font-size: 1.4em; margin-bottom: 15px; color: #0056b3;">
            <i class="fas fa-balance-scale" style="margin-right: 8px;"></i> 制度保障与服务优化：回应市民关切
        </h4>
        <p style="line-height: 1.8; color: #34495e; text-indent: 2em; margin-bottom: 15px;">
            市民反馈数据清晰地揭示了“运营服务”和“设施环境”是公众关注的核心。针对这些高频问题，洛阳市并非被动应对，而是通过顶层设计和制度建设进行了系统性的规范与引导。
        </p>
        <p style="line-height: 1.8; color: #34495e; text-indent: 2em; margin-bottom: 15px;">
            《洛阳市“河洛书苑”城市书房建设管理办法》的出台，正是对这些问题的直接回应和长效管理机制的建立。例如：
        </p>
        <ul style="list-style: none; padding-left: 10px; margin-bottom: 15px;">
            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                <i class="fas fa-map-marked-alt" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div>针对 “空间规划与选址” (Top 3 问题)，《办法》第七、八条明确要求各区县统筹规划，按“15分钟阅读文化圈”合理布局，选址需考虑人口集中、交通便利，并鼓励利用现有建筑，体现了对便捷性和经济性的双重考量。</div>
            </li>
             <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                 <i class="fas fa-tools" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div>针对 设施环境问题 (如空调、卫生、照明、饮水、物理损坏)，《办法》第九、十条对装饰设计（环境优雅、功能分区）、消防安全、无障碍通道以及便民设施（空调、饮水机、急救箱等）、安防监控等都提出了明确的配置要求和标准。</div>
            </li>
            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                 <i class="fas fa-clock" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div>针对 “开放时间调整” (Top 1 问题)，《办法》第十六条原则上要求每天开放不少于12小时，并鼓励24小时开放，同时规定了临时关闭或更改时间的提前公告制度，力求保障服务的稳定性与可预期性。</div>
            </li>
             <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                <i class="fas fa-users-cog" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                <div>针对 “人员服务问题” (Top 2 问题) 和 “噪音控制” 等管理问题，《办法》在第三章“运行管理”中明确了市图书馆、区县文旅部门及书房管理人员的职责，包括维护秩序、处理投诉、管理志愿者、开展培训等，并建立了群众投诉意见收集反馈机制（第二十三条），旨在提升管理水平和服务质量。</div>
            </li>
             <li style="display: flex; align-items: flex-start;">
                 <i class="fas fa-check-double" style="color: #17a2b8; margin-right: 10px; margin-top: 5px; width: 20px; text-align: center;"></i>
                 <div><strong>持续改进机制:</strong> 《办法》第五章设立了考评及扶持补助机制（第二十五条），通过对开放情况、管理秩序、群众满意度等进行量化考评，并对优秀者给予补助，激励各书房不断提升服务效能，形成了发现问题 -> 制度规范 -> 持续评估 -> 激励优化的管理闭环。</div>
            </li>
        </ul>
         <p style="line-height: 1.8; color: #34495e; text-indent: 2em; font-weight: 500;">
            针对市民反映出的问题，洛阳市通过出台详细的《建设管理办法》等制度文件，从规划选址、设施配置到运行管理、服务提供、监督考评等多个环节进行了全面的规范和部署，力求系统性地解决问题，保障“河洛书苑”的高质量、可持续发展。
        </p>
    </div>

     <div class="data-description" style="margin-top: 25px; font-size: 0.9em; color: #6c757d; line-height: 1.6; padding: 12px 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;">
        <p style="margin: 0;">
            <i class="fas fa-database" style="margin-right: 5px; color: #6f42c1;"></i>
            <strong>数据说明:</strong> 图表基于 1439 条与城市书房相关的有效反馈统计。左图展示一级分类占比，右图展示反馈数量排名前十的二级分类问题。分析结合了《洛阳市“河洛书苑”城市书房建设管理办法》相关条款。
        </p>
    </div>
</div>


<!-- 城市书房特色展示 -->
<div class="analysis-section library-showcase" style="margin-top: 40px; margin-bottom: 40px;">
    <h2 class="section-title" style="font-size: 1.8em; margin-bottom: 30px;" data-i18n="section_title_library_showcase_diverse">
        <i class="fas fa-landmark" style="color: #8e44ad; margin-right: 10px;"></i> 一房一景：河洛书苑的多样风貌
    </h2>
    <p style="text-align: center; max-width: 800px; margin: 0 auto 35px; color: #34495e; line-height: 1.7;">
        “河洛书苑”并非简单的复制粘贴，而是因地制宜，与环境融合，展现出丰富的形态与内涵。点击下方图片，探索三个典型书房的独特故事：
    </p>

    <div class="showcase-grid">
        <!-- 案例一: 历史文脉融合型 -->
        <div class="showcase-item library-card" data-library-id="shangyang">
            <div class="library-image">
                <img src="static/picture/shangyang-library.jpg" alt="上阳宫城市书房" loading="lazy">
            </div>
            <div class="library-caption">
                <h5 data-i18n="shangyang_library_type">历史文脉型: 上阳宫城市书房</h5>
                <p data-i18n="shangyang_library_tagline">融于景，承文脉</p>
            </div>
        </div>

        <!-- 案例二: 空间改造共建型 -->
        <div class="showcase-item library-card" data-library-id="yirenfang">
            <div class="library-image">
                <img src="static/picture/yiren-library.jpg" alt="宜人坊城市书房" loading="lazy">
            </div>
             <div class="library-caption">
                <h5 data-i18n="yirenfang_library_type">空间改造共建型: 宜人坊书房</h5>
                 <p data-i18n="yirenfang_library_tagline">旧址新生，合作典范</p>
            </div>
        </div>

        <!-- 案例三: 社区嵌入小微型 (示例：西山植物园) -->
        <div class="showcase-item library-card" data-library-id="community_park">
            <div class="library-image">
                <img src="static/picture/yichuan-library.jpg" alt="伊川县西山植物园城市书房" loading="lazy">
            </div>
             <div class="library-caption">
                <h5 data-i18n="community_library_type">社区嵌入型: 西山植物园书房</h5>
                 <p data-i18n="community_library_tagline">小而美，邻里共享</p>
            </div>
        </div>
    </div>

     <!-- 数据来源说明 -->
     <div class="data-source" style="margin-top: 25px;">
        <p data-i18n="image_data_source">图片来源：洛阳市文旅公益图库</p>
    </div>
</div>

<!-- Modal 结构 (初始隐藏) -->
<div id="libraryModal" class="modal">
    <div class="modal-content">
        <span class="close-button">×</span>
        <h3 id="modal-library-name">图书馆名称</h3>
        <div class="modal-body-grid">
             <div class="modal-image-container">
                 <img id="modal-library-image" src="" alt="图书馆图片">
            </div>
            <div class="modal-details">
                <h4><i class="fas fa-star"></i> <span data-i18n="modal_highlights">核心亮点</span></h4>
                <p id="modal-library-features"></p>
                <h4><i class="fas fa-info-circle"></i> <span data-i18n="modal_basic_info">基本信息</span></h4>
                <ul id="modal-library-stats">
                    <!-- Stats will be populated by JS -->
                </ul>
            </div>
        </div>
        <div class="modal-description">
             <h4><i class="fas fa-align-left"></i> <span data-i18n="modal_intro">书房简介</span></h4>
            <p id="modal-library-description"></p>
        </div>
    </div>
</div>

<!-- 总结与展望：洛阳实践与全国启示 -->
<div class="final-conclusion-section" style="max-width: 1200px; margin: 60px auto; padding: 40px 20px; background-color: #f9f9f9; border-radius: 15px; box-shadow: 0 6px 20px rgba(0,0,0,0.08);">

    <h2 class="section-title" style="font-size: 2em; color: #2c3e50; margin-bottom: 35px;">
       <i class="fas fa-lightbulb" style="color: #e67e22; margin-right: 10px;"></i> 河洛书苑：古都新韵，文化惠民的洛阳实践与全国启示
    </h2>

    <!-- Part 1: National Context -->
    <div class="national-context" style="margin-bottom: 40px;">
         <h3 style="text-align: center; color: #2980b9; font-size: 1.5em; margin-bottom: 20px;">全国城市书房建设浪潮中的洛阳坐标</h3>
         <div style="max-width: 900px; margin: 0 auto 30px; text-align: center;">
            <p style="font-size: 1.1em; color: #34495e; line-height: 1.8;">
                自2014年首家城市书房诞生以来，这种新型公共阅读空间已在全国形成燎原之势，成为城市文化服务的重要载体。在众多积极探索的城市中，洛阳凭借其“河洛书苑”项目脱颖而出。
            </p>
        </div>
        <!-- National Distribution Chart & Observations (Keep as they were) -->
        <div class="observations" style="max-width: 900px; margin: 30px auto 0; background-color: #fff; padding: 20px; border-radius: 8px; border-left: 4px solid #2ecc71; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
             <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2em;"><i class="fas fa-binoculars" style="margin-right: 8px; color: #2ecc71;"></i>全国主要观察点：</h4>
             <ul style="list-style: none; padding-left: 10px; color: #555;">
                <li style="margin-bottom: 10px; display: flex; align-items: start;"><i class="fas fa-star" style="color: #f1c40f; margin-right: 10px; margin-top: 4px;"></i><strong>数量领先：</strong>浙江省整体优势明显。</li>
                <li style="margin-bottom: 10px; display: flex; align-items: start;"><i class="fas fa-medal" style="color: #e67e22; margin-right: 10px; margin-top: 4px;"></i><strong>河南亮眼：</strong>河南省位居前列，其中洛阳“河洛书苑”是全国范围内单一城市品牌中数量最多的代表之一。</li>
                <li style="margin-bottom: 10px; display: flex; align-items: start;"><i class="fas fa-chart-bar" style="color: #3498db; margin-right: 10px; margin-top: 4px;"></i><strong>区域集中：</strong>东部沿海省份建设更为集中。</li>
                 <li style="display: flex; align-items: start;"><i class="fas fa-seedling" style="color: #9b59b6; margin-right: 10px; margin-top: 4px;"></i><strong>发展不均：</strong>中西部及县域地区仍有较大发展潜力。</li>
            </ul>
        </div>
        <div class="chart-container" style="height: 500px; margin: 30px auto; position: relative; max-width: 900px;">
            <!-- <h3 style="text-align: center; color: #2c3e50; margin-bottom: 10px; font-size: 1.3em;">全国主要省份城市书房数量分布</h3> -->
            <div id="nationalDistributionChart" style="width: 100%; height: 100%;"></div>
            <p class="chart-description" style="margin-top: 10px; font-size: 0.85em; color: #777; text-align: center; font-style: italic;">
                数据来源：温州市图书馆 全国城市书房合作共享机制网站（截至2023年底）
            </p>
        </div>
    </div>

     <!-- Part 2 & 3: Luoyang's Success and Factors -->
     <div class="luoyang-summary" style="max-width: 950px; margin: 40px auto; padding: 30px; background-color: #ffffff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.07);">
          <h3 style="text-align: center; color: #2980b9; font-size: 1.5em; margin-bottom: 25px;">洛阳经验：高效建设与深度惠民</h3>
          <p style="font-size: 1.1em; color: #34495e; line-height: 1.8; text-indent: 2em; margin-bottom: 20px;">
               在全国城市书房建设的版图中，洛阳“河洛书苑”以其惊人的建设速度（短时间内建成超200座）、广泛的空间覆盖（实现“15分钟阅读圈”） 以及 庞大的服务人次（年接待超800万，累计借阅超1700万），成为了一个现象级的文化工程。这不仅是数字上的成就，更是古都洛阳焕发新活力、提升城市品质与温度的生动体现。
          </p>
          <p style="font-size: 1.1em; color: #34495e; line-height: 1.8; text-indent: 2em; margin-bottom: 25px;">
              “河洛书苑”的成功并非偶然，其背后凝聚了多个关键要素：
          </p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px;">
              <div style="text-align: center; padding: 15px;">
                <i class="fas fa-bullhorn fa-2x" style="color: #3498db; margin-bottom: 10px;"></i>
                <h5 style="color: #2c3e50; margin-bottom: 8px;">政府前瞻与强力推动</h5>
                <p style="font-size: 0.95em; color: #555;">将城市书房建设纳入顶层设计，明确政策法规（如《建设管理办法》）提供保障。</p>
            </div>
             <div style="text-align: center; padding: 15px;">
                 <i class="fas fa-handshake fa-2x" style="color: #2ecc71; margin-bottom: 10px;"></i>
                <h5 style="color: #2c3e50; margin-bottom: 8px;">“多元共建共享”模式创新</h5>
                <p style="font-size: 0.95em; color: #555;">有效整合社会资源，分担财政压力，实现了快速布局与可持续发展的平衡。</p>
            </div>
            <div style="text-align: center; padding: 15px;">
                 <i class="fas fa-map-signs fa-2x" style="color: #f39c12; margin-bottom: 10px;"></i>
                 <h5 style="color: #2c3e50; margin-bottom: 8px;">标准化与特色化并行</h5>
                 <p style="font-size: 0.95em; color: #555;">在统一标识、通借通还的基础上，鼓励“一馆一特色”，使书房融入不同环境与文脉。</p>
            </div>
        </div>
         <p style="font-size: 1.1em; color: #34495e; line-height: 1.8; text-indent: 2em; margin-top: 25px;">
              这些散布在公园、社区、商场、景区旁的“河洛书苑”，不仅为市民（包括大学生、上班族等各类人群）提供了便捷、免费、高质量的阅读学习空间，更成为了传递城市文化、促进邻里交流、激发城市活力的重要节点。
          </p>
   </div>

   <!-- Part 4: Reference Value & National Goals (Revised to include Demonstration Zone info) -->
   <div class="reference-value" style="max-width: 900px; margin: 40px auto 0; text-align: left;">
      <h3 style="color: #16a085; font-size: 1.6em; margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-flag" style="margin-right: 10px;"></i> 启示与展望：助力全民阅读与学习型社会建设的“洛阳样本”
      </h3>
      <p style="font-size: 1.1em; color: #34495e; line-height: 1.8; margin-bottom: 20px; text-indent: 2em;">
          洛阳“河洛书苑”的蓬勃发展，不仅是地方文化惠民工程的成功实践，更是洛阳市作为国家公共文化服务体系示范区建设的重要成果体现。在国家大力倡导全民阅读、加快学习型社会建设的背景下，“河洛书苑”的经验为推动全国公共文化服务高质量发展提供了鲜活的地方样本和重要的启示意义。
      </p>
       <ul style="list-style: none; padding-left: 0; margin-bottom: 20px;">
           <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
               <i class="fas fa-book-reader" style="color: #16a085; margin-right: 12px; margin-top: 6px; width: 20px; text-align: center;"></i>
               <div><strong>深化全民阅读的有效载体:</strong> “河洛书苑”通过构建便捷可及的“15分钟阅读圈”，极大地降低了市民参与阅读的门槛，将阅读融入日常生活，有效扩大了阅读人口，提升了城市整体的阅读氛围，是推动全民阅读走向深入、落到实处的重要基础设施。</div>
           </li>
           <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
               <i class="fas fa-users" style="color: #16a085; margin-right: 12px; margin-top: 6px; width: 20px; text-align: center;"></i>
               <div><strong>构建学习型社会的基层单元:</strong> 城市书房不仅提供图书借阅，更承载了知识传播、技能学习、信息交流的功能。无论是学生的课后自习、职场人士的自我提升，还是社区居民的终身学习，“河洛书苑”都提供了一个开放、共享的学习平台，成为构建学习型社会不可或缺的微观基础。</div>
           </li>
           <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
              <i class="fas fa-lightbulb" style="color: #16a085; margin-right: 12px; margin-top: 6px; width: 20px; text-align: center;"></i>
               <div><strong>模式创新的可借鉴经验:</strong> 其在政府主导与社会力量参与相结合的“多元共建共享”模式、标准化建设与“一馆一特色”的文化融合、以及从重建设转向重运营管理和效能提升等方面的探索，为其他城市如何高效利用资源、激发社会活力、保障公共文化服务可持续发展提供了宝贵的实践经验。</div>
           </li>
       </ul>
      <p style="font-size: 1.15em; color: #2c3e50; line-height: 1.8; font-weight: 500; text-align: left; margin-top: 25px;">
           <i class="fas fa-paper-plane" style="margin-right: 8px;"></i> 让书香浸润城市，让学习成为风尚。“洛阳模式”的探索仍在继续，其服务于国家文化战略目标的实践价值，值得更广泛的关注、研究与借鉴，共同推动书香中国和学习型社会的建设迈向新台阶。
       </p>
  </div>
</div>

<!-- 底部信息 -->
<div class="footer-info">
  <div class="credits">
      <div>
          <h3>指导老师</h3>
          <p>万鹏</p>
      </div>
      <div>
          <h3>网页制作</h3>
          <p>李心愿</p>
      </div>
  </div>
</div>

      <!-- 数据说明与方法论 -->
      <div class="data-methodology-section" style="max-width: 900px; margin: 40px auto; padding: 25px; background: #f8f9fa; border-radius: 12px; text-align: left; box-shadow: 0 3px 15px rgba(0,0,0,0.06);">
          <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.5em; border-bottom: 2px solid #eee; padding-bottom: 12px;">
              <i class="fas fa-database" style="margin-right: 10px; color: #17a2b8;"></i>数据来源与分析方法
          </h3>

          <!-- 关键指标说明 -->
          <div style="margin-bottom: 25px; padding: 15px; background-color: #e9ecef; border-radius: 6px;">
              <h4 style="color: #007bff; font-size: 1.2em; margin-bottom: 10px;">关键指标说明</h4>
              <p style="color: #495057; line-height: 1.6; margin:0;">
                  本报告开头展示的“年接待读者规模：超 800 万人次”是基于对近年运营数据的综合评估（参考 2019 年实际数据 904 万+，及 2024 年暑期高峰日均超 3 万人次的新闻报道推算），旨在展示“河洛书苑”年度服务体量的大致量级，并非精确的年度统计数据。其他核心数据（如书房总数、累计借阅量等）主要来源于官方发布或最新统计。
              </p>
          </div>

          <!-- 数据来源列表 -->
          <div style="margin-bottom: 25px;">
              <h4 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 15px;">主要数据来源</h4>
              <ul style="list-style-type: none; padding-left: 0;">
                  <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
                      <i class="fas fa-book-reader" style="color: #2ecc71; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>洛阳市图书馆官方数据/系统:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                              <li>205 座城市书房基础信息（位置、面积、藏书量、开放状态等，截至 2025 年初）。</li>
                              <li>访客统计系统提供的 样本数据 (2025年3月13日-4月4日): 用于分析分时段客流、日客流特征及图书借阅分类偏好。（注：此为短期样本，结论需谨慎外推）</li>
                          </ul>
                      </div>
                  </li>
                  <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
                      <i class="fas fa-comments" style="color: #3498db; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>洛阳网“百姓呼声”平台:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                              <li>时间范围：2017年1月 - 2025年4月。</li>
                              <li>内容：筛选出 1439 条与“河洛书苑”或城市书房相关的市民反馈、建议与投诉原文及元数据。</li>
                          </ul>
                      </div>
                  </li>
                   <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
                      <i class="fas fa-file-invoice-dollar" style="color: #e74c3c; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>洛阳市政府采购网:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                              <li>时间范围：2017年 - 2025年初。</li>
                              <li>内容：与城市书房相关的招标文件、中标公告、合同公告等，用于分析建设成本构成（合同资金流向）和趋势（基于已成交合同）。</li>
                          </ul>
                      </div>
                  </li>

                   <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
                      <i class="fas fa-map-marked-alt" style="color: #f39c12; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                       <div><strong>人口与地理数据:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                               <li>LandScan™ Global 2023 (美国橡树岭国家实验室): 提供高分辨率全球人口密度数据，用于生成洛阳区域人口热力图。</li>
                               <li>第七次全国人口普查数据: 用于各行政区人均资源分析。</li>
                                <li>高德地图/Mapbox API: 用于计算等时圈（15分钟步行范围）和地图底图。</li>
                          </ul>
                      </div>
                  </li>
                   <li style="margin-bottom: 15px; display: flex; align-items: flex-start;">
                      <i class="fas fa-globe-asia" style="color: #27ae60; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>全国对比数据:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                               <li>全国城市书房合作共享机制官网: 提供截至 2023 年底的全国各省市城市书房数量统计数据。</li>
                          </ul>
                      </div>
                   </li>
                   <li style="display: flex; align-items: flex-start;">
                       <i class="fas fa-newspaper" style="color: #95a5a6; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>新闻报道与政策文件:</strong>
                          <ul style="margin-top: 5px; padding-left: 20px; color: #555; list-style-type: disc;">
                               <li>洛阳日报、洛阳网、河南省政府网等官方媒体关于“河洛书苑”建设、运营、活动及获奖情况的报道。</li>
                               <li>《洛阳市“河洛书苑”城市书房建设管理办法》等相关政策文件。</li>
                          </ul>
                      </div>
                  </li>
              </ul>
          </div>

          <!-- 数据处理与分析方法 -->
          <div style="margin-bottom: 25px;">
              <h4 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 15px;">数据处理与分析方法</h4>
              <ul style="list-style-type: none; padding-left: 0;">
                   <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                       <i class="fas fa-cogs" style="color: #16a085; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>数据清洗与整合:</strong> 对来自多源的数据进行标准化处理、去重、合并，确保数据一致性。对地理位置信息进行坐标转换与校准。</div>
                  </li>
                   <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                      <i class="fas fa-calculator" style="color: #16a085; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>统计分析:</strong> 使用 Python (Pandas, Numpy) 对各项指标进行描述性统计（总量、均值、占比、频率分布等），分析其时间趋势、空间分布和分类特征。</div>
                  </li>
                  <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                      <i class="fas fa-brain" style="color: #16a085; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>文本分析 (NLP):</strong> 应用自然语言处理技术对市民反馈文本进行自动分类（问题类型、强度）、情感倾向分析和关键词提取（用于词云图）。</div>
                  </li>
                  <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                       <i class="fas fa-map-marked-alt" style="color: #16a085; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>空间分析 (GIS):</strong> 利用地理信息系统 (GIS) 技术和工具 (如 QGIS, Python GeoPandas, Mapbox API) 处理地理坐标数据，生成等时圈（基于步行网络），叠加人口密度数据，制作交互式地图。</div>
                   </li>
                   <li style="display: flex; align-items: flex-start;">
                       <i class="fas fa-chart-pie" style="color: #16a085; margin-right: 12px; margin-top: 4px; width: 20px; text-align: center;"></i>
                      <div><strong>数据可视化:</strong> 采用 ECharts, Chart.js, Plotly 等库生成交互式图表（如折线图、柱状图、饼图、热力图、矩形树图、地图等）以直观呈现分析结果。</div>
                  </li>
              </ul>
          </div>

          <!-- 交互地图说明 -->
          <div style="margin-bottom: 25px;">
              <h4 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 10px;">交互地图说明</h4>
              <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">本项目提供了两种主要的交互式地图视图，旨在直观展示城市书房的空间布局及其服务潜力：</p>
              <ul style="padding-left: 20px; color: #555; list-style-type: decimal;">
                  <li style="margin-bottom: 5px;"><strong>十五分钟阅读圈分布图:</strong> 通过计算每个书房出发的15分钟步行可达范围（等时圈），展示了“河洛书苑”网络对城市区域的理论覆盖情况。用户可以切换地图底图，并在地图上点击任意位置生成该点的等时圈，探索特定区域的服务可及性。</li>
                  <li style="margin-bottom: 5px;"><strong>人口热力分布图:</strong> 将高分辨率的人口密度数据（LandScan™）与城市书房位置进行叠加，通过颜色深浅直观显示人口聚集区域及书房的分布关系。用户可以按行政区筛选，观察不同区域的人口分布与书房布局是否匹配。</li>
              </ul>
          </div>

          <!-- 致谢 -->
          <div style="margin-bottom: 20px;">
              <h4 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 10px;">致谢</h4>
              <p style="color: #495057; line-height: 1.6;">衷心感谢洛阳市图书馆、洛阳市文化广电和旅游局为本项目研究提供的数据支持与帮助。同时感谢相关公开数据平台提供的数据资源。</p>
          </div>

          <!-- 免责与开源声明 -->
          <div style="font-style: italic; color: #7f8c8d; font-size: 0.9em; text-align: left; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
              <p><strong>注：</strong>本项目严格遵守数据使用规范和隐私保护原则，所有涉及个人的信息均已进行脱敏处理。部分数据基于公开信息整理、估算或进行了必要的调整，仅为分析和展示目的。</p>
              <p>本项目研究成果仅用于学术交流与教育目的。完整代码及所使用的公开数据集将在项目完成后于 <a href="https://github.com/xinyuanblue" target="_blank" rel="noopener noreferrer" style="color: #007bff;">github.com/xinyuanblue</a> 开源共享。</p>
          </div>
      </div>

<footer class="footer mt-5 py-4 bg-light">
  <div class="container">
      <div class="row justify-content-center">
          <div class="col-12 text-center">
              <h5 class="mb-4 text-secondary">友情链接</h5>
              <div class="d-flex justify-content-center flex-wrap gap-3">
                  <a href="https://github.com/xinyuanblue" target="_blank"
                     class="btn btn-light border shadow-sm px-4 py-2 mx-2 text-decoration-none">
                     GitHub主页
                  </a>
                  <a href="http://www.lyslib.cn/" target="_blank"
                     class="btn btn-light border shadow-sm px-4 py-2 mx-2 text-decoration-none">
                     洛阳市图书馆
                  </a>
                  <a href="https://www.wzlib.cn/gxjz/" target="_blank"
                     class="btn btn-light border shadow-sm px-4 py-2 mx-2 text-decoration-none">
                     全国城市书房合作共享机制
                  </a>
                  <a href="http://111.7.82.66:8090/#/" target="_blank"
                     class="btn btn-light border shadow-sm px-4 py-2 mx-2 text-decoration-none">
                     洛阳市文旅公益图库
                  </a>
              </div>
          </div>
      </div>
  </div>
</footer>

<!-- 确保先加载ECharts库 -->
<script src="static/js/echarts.min.js"></script>
<!-- 引入Chart.js库 -->
<script src="static/vendor/chartjs/chart.min.js"></script>

<script>
  // 无障碍功能
  document.addEventListener('DOMContentLoaded', function() {
      // 高对比度切换
      const contrastToggle = document.getElementById('contrast-toggle');
      contrastToggle.addEventListener('click', function() {
          document.documentElement.classList.toggle('high-contrast');
          const isHighContrast = document.documentElement.classList.contains('high-contrast');
          this.setAttribute('aria-pressed', isHighContrast);
          saveAccessibilitySettings();
      });

      // 字体大小切换
      const fontSizeToggle = document.getElementById('font-size-toggle');
      fontSizeToggle.addEventListener('click', function() {
          const currentSize = document.documentElement.getAttribute('data-font-size');
          let newSize;
          if (!currentSize) newSize = 'large';
          else if (currentSize === 'large') newSize = 'x-large';
          else newSize = '';

          document.documentElement.setAttribute('data-font-size', newSize);
          this.setAttribute('aria-pressed', !!newSize);
          saveAccessibilitySettings();
      });

      // 行高切换
      const lineHeightToggle = document.getElementById('line-height-toggle');
      lineHeightToggle.addEventListener('click', function() {
          const isIncreased = document.documentElement.getAttribute('data-line-height') === 'increased';
          document.documentElement.setAttribute('data-line-height', isIncreased ? '' : 'increased');
          this.setAttribute('aria-pressed', !isIncreased);
          saveAccessibilitySettings();
      });

      // 朗读功能
      const readAloudToggle = document.getElementById('read-aloud-toggle');
      let isReading = false;
      let utterance = null;
      readAloudToggle.addEventListener('click', function() {
          if ('speechSynthesis' in window) {
              if (isReading) {
                  window.speechSynthesis.cancel();
                  isReading = false;
                  this.setAttribute('aria-pressed', 'false');
              } else {
                  const mainContent = document.getElementById('main-content');
                  let textToRead = '';

                  if (mainContent) {
                      textToRead = mainContent.textContent.trim();
                  } else {
                      // 如果找不到main-content元素，则使用整个body的内容，或定义另一个备选区域
                      const contentContainer = document.querySelector('.container');
                      textToRead = contentContainer ? contentContainer.textContent.trim() : document.body.textContent.trim();
                      console.warn('main-content元素未找到，将使用备选内容朗读');
                  }

                  if (textToRead) {
                      utterance = new SpeechSynthesisUtterance(textToRead);
                      utterance.lang = document.documentElement.lang === 'en' ? 'en-US' : 'zh-CN';
                      utterance.rate = 0.9;

                      utterance.onend = function() {
                          isReading = false;
                          readAloudToggle.setAttribute('aria-pressed', 'false');
                      };

                      window.speechSynthesis.speak(utterance);
                      isReading = true;
                      this.setAttribute('aria-pressed', 'true');
                  } else {
                      alert('未找到可朗读的内容');
                  }
              }
          } else {
              alert('抱歉，您的浏览器不支持语音合成功能');
          }
      });

      // 保存设置到本地存储
      function saveAccessibilitySettings() {
          const settings = {
              highContrast: document.documentElement.classList.contains('high-contrast'),
              fontSize: document.documentElement.getAttribute('data-font-size'),
              lineHeight: document.documentElement.getAttribute('data-line-height')
          };
          localStorage.setItem('accessibilitySettings', JSON.stringify(settings));
      }

      // 加载设置
      function loadAccessibilitySettings() {
          const savedSettings = localStorage.getItem('accessibilitySettings');
          if (savedSettings) {
              const settings = JSON.parse(savedSettings);

              if (settings.highContrast) {
                  document.documentElement.classList.add('high-contrast');
                  contrastToggle.setAttribute('aria-pressed', 'true');
              }

              if (settings.fontSize) {
                  document.documentElement.setAttribute('data-font-size', settings.fontSize);
                  fontSizeToggle.setAttribute('aria-pressed', 'true');
              }

              if (settings.lineHeight) {
                  document.documentElement.setAttribute('data-line-height', settings.lineHeight);
                  lineHeightToggle.setAttribute('aria-pressed', 'true');
              }
          }
      }

      // 初始化加载设置
      loadAccessibilitySettings();
  });

  document.addEventListener('DOMContentLoaded', function() {
      // 初始化语言设置
      const savedLang = localStorage.getItem('selectedLanguage') || 'zh';
      document.documentElement.lang = savedLang;

      // 更新语言按钮状态
      const languageBtns = document.querySelectorAll('.language-switch button');
      languageBtns.forEach(btn => {
          if (btn.dataset.lang === savedLang) {
              btn.classList.add('active');
              btn.setAttribute('aria-pressed', 'true');
          } else {
              btn.classList.remove('active');
              btn.setAttribute('aria-pressed', 'false');
          }

          // 添加点击事件监听
          btn.addEventListener('click', function() {
              const lang = this.dataset.lang;
              document.documentElement.lang = lang;
              localStorage.setItem('selectedLanguage', lang);

              // 更新按钮状态
              languageBtns.forEach(b => {
                  b.classList.remove('active');
                  b.setAttribute('aria-pressed', 'false');
              });
              this.classList.add('active');
              this.setAttribute('aria-pressed', 'true');

              // 触发翻译事件
              document.dispatchEvent(new CustomEvent('languageChange', { detail: { lang } }));

              // 确保翻译生效
              setTimeout(() => {
                  translatePage(lang);
              }, 100);
          });
      });

      // 初始化时触发一次翻译
      document.dispatchEvent(new CustomEvent('languageChange', { detail: { lang: savedLang } }));

      // 确保翻译函数可用
      if (typeof translatePage === 'function') {
          translatePage(savedLang);
      } else {
          console.error('translatePage function not found');
      }
  });
</script>

<script>
  // 矩形树图逻辑
  document.addEventListener('DOMContentLoaded', function() {
      // 初始化城市书房类型矩形树图
      const bookstoreTreemap = echarts.init(document.getElementById('bookstoreTreemap'), null, {
          renderer: 'canvas'  // 使用canvas渲染器提高稳定性
      });

      // 加载面积数据 - 使用相对路径
      fetch('static/js/面积.json')
          .then(response => response.json())
          .then(data => {
              // 按书房类型分组数据
              const groupedData = {
                  '小型书房': [],
                  '中型书房': [],
                  '大型书房': [],
                  '特大型书房': []
              };

              // 分组并计算总面积
              data.forEach(item => {
                  groupedData[item.书房类型].push(item);
              });

              // 计算每种类型的总面积
              const totalAreas = {};
              Object.keys(groupedData).forEach(type => {
                  totalAreas[type] = groupedData[type].reduce((sum, item) => sum + item.面积, 0);
              });

              // 准备树图数据 - 初始只显示四个主分类
              const treemapData = [
                  {
                      name: `小型书房 (${groupedData['小型书房'].length}座)`,
                      value: totalAreas['小型书房'],
                      itemStyle: { color: '#FF9F40' },
                      id: '小型书房'
                  },
                  {
                      name: `中型书房 (${groupedData['中型书房'].length}座)`,
                      value: totalAreas['中型书房'],
                      itemStyle: { color: '#36A2EB' },
                      id: '中型书房'
                  },
                  {
                      name: `大型书房 (${groupedData['大型书房'].length}座)`,
                      value: totalAreas['大型书房'],
                      itemStyle: { color: '#4BC0C0' },
                      id: '大型书房'
                  },
                  {
                      name: `特大型书房 (${groupedData['特大型书房'].length}座)`,
                      value: totalAreas['特大型书房'],
                      itemStyle: { color: '#9966FF' },
                      id: '特大型书房'
                  }
              ];

              // 创建完整数据集，包含子矩形
              const completeDataSet = {
                  '小型书房': {
                      name: `小型书房 (${groupedData['小型书房'].length}座)`,
                      value: totalAreas['小型书房'],
                      itemStyle: { color: '#FF9F40' },
                      children: groupedData['小型书房'].map(item => ({
                          name: item.名称,
                          value: item.面积,
                          district: item.辖区,
                          itemStyle: { color: '#FF9F40' }
                      }))
                  },
                  '中型书房': {
                      name: `中型书房 (${groupedData['中型书房'].length}座)`,
                      value: totalAreas['中型书房'],
                      itemStyle: { color: '#36A2EB' },
                      children: groupedData['中型书房'].map(item => ({
                          name: item.名称,
                          value: item.面积,
                          district: item.辖区,
                          itemStyle: { color: '#36A2EB' }
                      }))
                  },
                  '大型书房': {
                      name: `大型书房 (${groupedData['大型书房'].length}座)`,
                      value: totalAreas['大型书房'],
                      itemStyle: { color: '#4BC0C0' },
                      children: groupedData['大型书房'].map(item => ({
                          name: item.名称,
                          value: item.面积,
                          district: item.辖区,
                          itemStyle: { color: '#4BC0C0' }
                      }))
                  },
                  '特大型书房': {
                      name: `特大型书房 (${groupedData['特大型书房'].length}座)`,
                      value: totalAreas['特大型书房'],
                      itemStyle: { color: '#9966FF' },
                      children: groupedData['特大型书房'].map(item => ({
                          name: item.名称,
                          value: item.面积,
                          district: item.辖区,
                          itemStyle: { color: '#9966FF' }
                      }))
                  }
              };

              // 记录当前查看的分类
              let currentCategory = null;

              // 配置矩形树图选项
              const getTreemapOption = (data) => {
                  return {
                      tooltip: {
                          formatter: function(params) {
                              const data = params.data;
                              if (data.name.includes('座')) {
                                  return `${data.name}<br/>总面积: ${data.value.toFixed(1)}㎡`;
                              } else {
                                  return `${data.name}<br/>面积: ${data.value.toFixed(1)}㎡<br/>辖区: ${data.district || ''}`;
                              }
                          }
                      },
                      series: [{
                          type: 'treemap',
                          data: data,
                          roam: false,  // 禁用缩放和平移
                          width: '100%',
                          height: '100%',
                          left: 0,      // 固定位置
                          top: 0,
                          right: 0,
                          bottom: 0,
                          itemStyle: {
                              borderWidth: 1,
                              gapWidth: 1,
                              borderColor: '#fff'
                          },
                          label: {
                              show: true,
                              formatter: function(params) {
                                  if (params.data.name.includes('座')) {
                                      return params.data.name;
                                  } else if (params.treePathInfo && params.treePathInfo.length > 1) {
                                      return params.data.name;
                                  }
                                  return '';
                              },
                              fontSize: 14,
                              overflow: 'break'  // 文字过长时换行
                          },
                          breadcrumb: {
                              show: false,  // 禁用导航面包屑
                              height: 30,
                              top: 'top',
                              itemStyle: {
                                  color: '#f6f6f6',
                                  borderColor: '#ddd',
                                  textStyle: { color: '#333' }
                              }
                          },
                          nodeClick: currentCategory ? false : 'link',  // 在详情视图中禁用点击
                          emphasis: {
                              itemStyle: {
                                  shadowBlur: 10,
                                  shadowOffsetX: 0,
                                  shadowOffsetY: 0,
                                  shadowColor: 'rgba(0,0,0,0.5)'
                              }
                          },
                          layoutAnimation: true,
                          animationDurationUpdate: 600
                      }]
                  };
              };

              // 设置初始选项并渲染图表
              bookstoreTreemap.setOption(getTreemapOption(treemapData));

              // 添加返回按钮
              const backButton = document.createElement('button');
              backButton.textContent = '返回书房类型总览';
              backButton.style.position = 'absolute';
              backButton.style.top = '60px';
              backButton.style.right = '20px';
              backButton.style.zIndex = '100';
              backButton.style.padding = '8px 15px';
              backButton.style.backgroundColor = '#4CAF50';
              backButton.style.color = 'white';
              backButton.style.border = 'none';
              backButton.style.borderRadius = '4px';
              backButton.style.cursor = 'pointer';
              backButton.style.display = 'none';
              document.querySelector('.treemap-container').appendChild(backButton);

              // 返回按钮点击事件
              backButton.addEventListener('click', function() {
                  currentCategory = null;
                  bookstoreTreemap.setOption(getTreemapOption(treemapData), true);
                  this.style.display = 'none';
              });

              // 添加鼠标点击事件
              bookstoreTreemap.on('click', function(params) {
                  const data = params.data;

                  // 如果已经在查看详情，不执行任何操作
                  if (currentCategory) return;

                  // 只处理主类别点击
                  if (data.id && completeDataSet[data.id]) {
                      currentCategory = data.id;
                      // 显示该类型的详细数据
                      bookstoreTreemap.setOption(getTreemapOption([completeDataSet[data.id]]), true);
                      backButton.style.display = 'block';
                  }
              });
          })
          .catch(error => {
              console.error('加载数据失败:', error);
              // 显示错误信息
              document.getElementById('bookstoreTreemap').innerHTML =
                  '<div style="text-align:center;color:red;padding:20px;">加载数据失败，请刷新页面重试</div>';
          });

      // 响应窗口大小变化，重新调整图表大小
      window.addEventListener('resize', function() {
          bookstoreTreemap.resize();
      });

      // 防止图表随鼠标漂移
      document.querySelector('.treemap-container').style.position = 'relative';
      document.querySelector('.treemap-container').style.overflow = 'hidden';
      document.getElementById('bookstoreTreemap').style.position = 'relative';
  });
</script>

<script>
  // 行政区分布图逻辑
  document.addEventListener('DOMContentLoaded', function() {
      fetch('static/js/行政区面积数量.json') // 使用相对路径
          .then(response => response.json())
          .then(data => {
              // 准备图表数据
              const districts = data.map(item => item.辖区);
              const bookroomCounts = data.map(item => item.bookroom_count);
              const totalAreas = data.map(item => item.total_area);

              // 计算人均面积
              const avgAreas = totalAreas.map((area, index) =>
                  (area / bookroomCounts[index]).toFixed(2));

              // 排序数据（按书房数量降序）
              const sortedIndices = bookroomCounts.map((count, index) => index)
                  .sort((a, b) => bookroomCounts[b] - bookroomCounts[a]);

              const sortedDistricts = sortedIndices.map(i => districts[i]);
              const sortedCounts = sortedIndices.map(i => bookroomCounts[i]);
              const sortedAreas = sortedIndices.map(i => totalAreas[i]);
              const sortedAvgAreas = sortedIndices.map(i => avgAreas[i]);

              // 创建堆叠柱状图
              const districtChart = echarts.init(document.getElementById('districtChart'));

              const option = {
                  tooltip: {
                      trigger: 'axis',
                      axisPointer: {
                          type: 'shadow'
                      },
                      formatter: function(params) {
                          const districtIndex = sortedDistricts.indexOf(params[0].name);
                          return `${params[0].name}<br/>
                                 书房数量: ${sortedCounts[districtIndex]}座<br/>
                                 总面积: ${sortedAreas[districtIndex]}平方米<br/>
                                 平均面积: ${sortedAvgAreas[districtIndex]}平方米/座`;
                      }
                  },
                  legend: {
                      data: ['书房数量（座）', '总面积(平方米)'], // Updated legend label
                      top: 'top'
                  },
                  grid: {
                      left: '3%',
                      right: '4%',
                      bottom: '3%',
                      containLabel: true
                  },
                  xAxis: {
                      type: 'value',
                      axisLabel: {
                          formatter: '{value}'
                      }
                  },
                  yAxis: {
                      type: 'category',
                      data: sortedDistricts,
                      axisLabel: {
                          interval: 0,
                          rotate: 0
                      }
                  },
                  series: [
                      {
                          name: '书房数量（座）', // Match legend label
                          type: 'bar',
                          stack: '总量',
                          color: '#36A2EB',
                          label: {
                              show: true,
                              position: 'insideRight',
                              formatter: '{c}座' // Add unit
                          },
                          data: sortedCounts
                      },
                      {
                          name: '总面积(平方米)', // Match legend label
                          type: 'bar',
                          color: '#FF9F40',
                          data: sortedAreas.map(area => area / 100), // 缩小面积显示比例
                          label: {
                              show: true,
                              position: 'right',
                              formatter: function(params) {
                                  const index = params.dataIndex;
                                  return sortedAreas[index] + 'm²';
                              }
                          }
                      }
                  ]
              };

              districtChart.setOption(option);

              // 响应窗口大小变化
              window.addEventListener('resize', function() {
                  districtChart.resize();
              });
          })
          .catch(error => console.error('加载行政区数据失败:', error));
  });
</script>

<script>
  // 人口与书房关系图逻辑
  document.addEventListener('DOMContentLoaded', function() {
      // 加载行政区书房数据和人口面积数据 - 使用相对路径
      Promise.all([
          fetch('static/js/行政区面积数量.json').then(response => response.json()),
          fetch('static/js/人口面积.json').then(response => response.json())
      ])
      .then(([bookroomData, populationAreaData]) => {
          // 处理数据，合并两个数据集
          const combinedData = bookroomData.map(item => {
              // 匹配相应的人口和行政区面积数据
              // 特殊处理瀍河区（在人口数据中是瀍河回族区）
              let areaName = item.辖区;
              if (areaName === "瀍河区") areaName = "瀍河回族区";

              const popData = populationAreaData[areaName];
              if (!popData) {
                  console.warn(`未找到${item.辖区}的人口面积数据`);
                  return {
                      ...item,
                      人口: 0,
                      行政区面积: 0
                  };
              }

              return {
                  ...item,
                  人口: popData.常住人口,
                  行政区面积: popData.面积
              };
          }).filter(item => item.人口 > 0); // 过滤掉没有匹配到人口数据的项目

          // 按人口排序
          combinedData.sort((a, b) => b.人口 - a.人口);

          // 1. 初始化人口与书房关系图表
          const populationChart = echarts.init(document.getElementById('populationChart'));
          const populationOption = {
              tooltip: {
                  trigger: 'axis',
                  axisPointer: {
                      type: 'shadow'
                  },
                  formatter: function(params) {
                      const data = params[0].data;
                      return `${data.name}<br/>人口: ${(data.人口/10000).toFixed(2)}万人<br/>书房数量: ${data.bookroom_count}座<br/>书房总面积: ${data.total_area}㎡`;
                  }
              },
              grid: {
                  left: '3%',
                  right: '4%',
                  bottom: '3%',
                  containLabel: true
              },
              xAxis: {
                  type: 'category',
                  data: combinedData.map(item => item.辖区),
                  axisLabel: {
                      rotate: 45,
                      interval: 0
                  }
              },
              yAxis: [
                  {
                      type: 'value',
                      name: '人口（万人）',
                      position: 'left',
                      axisLine: {
                          show: true,
                          lineStyle: {
                              color: '#5470C6'
                          }
                      },
                      axisLabel: {
                          formatter: function(value) {
                              return (value / 10000).toFixed(1);
                          }
                      }
                  },
                  {
                      type: 'value',
                      name: '书房数量（座）',
                      position: 'right',
                      axisLine: {
                          show: true,
                          lineStyle: {
                              color: '#91CC75'
                          }
                      }
                  }
              ],
              series: [
                  {
                      name: '人口',
                      type: 'bar',
                      barWidth: 20,
                      itemStyle: {
                          color: '#5470C6'
                      },
                      data: combinedData.map(item => ({
                          name: item.辖区,
                          value: item.人口,
                          ...item
                      }))
                  },
                  {
                      name: '书房数量',
                      type: 'line',
                      yAxisIndex: 1,
                      itemStyle: {
                          color: '#91CC75'
                      },
                      data: combinedData.map(item => item.bookroom_count)
                  }
              ]
          };
          populationChart.setOption(populationOption);

          // 3. 初始化人均书房资源分析图表
          const perCapitaChart = echarts.init(document.getElementById('perCapitaChart'));

          // 计算每万人拥有的书房数量和人均书房面积
          const perCapitaData = combinedData.map(item => {
              const perTenThousandCount = (item.bookroom_count / item.人口) * 10000;
              const perCapitaArea = (item.total_area / item.人口) * 10000;
              return {
                  name: item.辖区,
                  perTenThousandCount,
                  perCapitaArea
              };
          });

          // 按人均书房面积排序
          perCapitaData.sort((a, b) => b.perCapitaArea - a.perCapitaArea);

          const perCapitaOption = {
              tooltip: {
                  trigger: 'axis',
                  axisPointer: {
                      type: 'shadow'
                  },
                  formatter: function(params) {
                      return `${params[0].name}<br/>每万人书房数: ${params[0].value.toFixed(2)}座<br/>每万人书房面积: ${params[1].value.toFixed(2)}㎡`;
                  }
              },
              legend: {
                  data: ['每万人书房数', '每万人书房面积']
              },
              grid: {
                  left: '3%',
                  right: '4%',
                  bottom: '3%',
                  containLabel: true
              },
              xAxis: {
                  type: 'category',
                  data: perCapitaData.map(item => item.name),
                  axisLabel: {
                      rotate: 45,
                      interval: 0
                  }
              },
              yAxis: [
                  {
                      type: 'value',
                      name: '每万人书房数（座）',
                      position: 'left',
                      axisLine: {
                          show: true,
                          lineStyle: {
                              color: '#FC8452'
                          }
                      }
                  },
                  {
                      type: 'value',
                      name: '每万人书房面积（㎡）',
                      position: 'right',
                      axisLine: {
                          show: true,
                          lineStyle: {
                              color: '#9A60B4'
                          }
                      }
                  }
              ],
              series: [
                  {
                      name: '每万人书房数',
                      type: 'bar',
                      barWidth: 20,
                      itemStyle: {
                          color: '#FC8452'
                      },
                      data: perCapitaData.map(item => item.perTenThousandCount)
                  },
                  {
                      name: '每万人书房面积',
                      type: 'line',
                      yAxisIndex: 1,
                      symbol: 'circle',
                      symbolSize: 8,
                      itemStyle: {
                          color: '#9A60B4'
                      },
                      data: perCapitaData.map(item => item.perCapitaArea)
                  }
              ]
          };
          perCapitaChart.setOption(perCapitaOption);

          // 窗口大小变化时重新调整图表大小
          window.addEventListener('resize', function() {
              populationChart.resize();
              perCapitaChart.resize();
          });
      })
      .catch(error => {
          console.error('加载数据失败:', error);
          document.querySelectorAll('.chart-container').forEach(container => {
              container.innerHTML = '<div style="text-align:center;color:red;padding:20px;">加载数据失败，请刷新页面重试</div>';
          });
      });
  });
</script>

<script>
  // 客流量和借阅图表逻辑
  document.addEventListener('DOMContentLoaded', function() {
      // 使用真实的hourly_trend_data.json数据
      const hourlyTrendData = [
            { "hour": 0, "average_visitors": 38 },
            { "hour": 1, "average_visitors": 0 },
            { "hour": 2, "average_visitors": 0 },
            { "hour": 3, "average_visitors": 0 },
            { "hour": 4, "average_visitors": 6 },
            { "hour": 5, "average_visitors": 3 },
            { "hour": 6, "average_visitors": 17 },
            { "hour": 7, "average_visitors": 65 },
            { "hour": 8, "average_visitors": 1409 },
            { "hour": 9, "average_visitors": 1764 },
            { "hour": 10, "average_visitors": 1662 },
            { "hour": 11, "average_visitors": 1723 },
            { "hour": 12, "average_visitors": 1478 },
            { "hour": 13, "average_visitors": 1574 },
            { "hour": 14, "average_visitors": 2083 },
            { "hour": 15, "average_visitors": 1994 },
            { "hour": 16, "average_visitors": 1946 },
            { "hour": 17, "average_visitors": 1984 },
            { "hour": 18, "average_visitors": 1787 },
            { "hour": 19, "average_visitors": 1238 },
            { "hour": 20, "average_visitors": 670 },
            { "hour": 21, "average_visitors": 77 },
            { "hour": 22, "average_visitors": 18 },
            { "hour": 23, "average_visitors": 30 }
          ];

      // 使用带有日期类型的time_series_data.json数据
      const timeSeriesData = [
          {date: '2025-03-13', visitors: 20989, dateType: "workday"},
          {date: '2025-03-14', visitors: 21235, dateType: "workday"},
          {date: '2025-03-15', visitors: 37727, dateType: "weekend"},
          {date: '2025-03-16', visitors: 24645, dateType: "weekend"},
          {date: '2025-03-17', visitors: 17373, dateType: "workday"},
          {date: '2025-03-18', visitors: 16698, dateType: "workday"},
          {date: '2025-03-19', visitors: 17561, dateType: "workday"},
          {date: '2025-03-20', visitors: 17336, dateType: "workday"},
          {date: '2025-03-21', visitors: 19477, dateType: "workday"},
          {date: '2025-03-22', visitors: 38476, dateType: "weekend"},
          {date: '2025-03-23', visitors: 24073, dateType: "weekend"},
          {date: '2025-03-24', visitors: 16677, dateType: "workday"},
          {date: '2025-03-25', visitors: 17549, dateType: "workday"},
          {date: '2025-03-26', visitors: 16878, dateType: "workday"},
          {date: '2025-03-27', visitors: 15368, dateType: "workday"},
          {date: '2025-03-28', visitors: 17994, dateType: "workday"},
          {date: '2025-03-29', visitors: 35560, dateType: "weekend"},
          {date: '2025-03-30', visitors: 22333, dateType: "weekend"},
          {date: '2025-03-31', visitors: 15628, dateType: "workday"},
          {date: '2025-04-01', visitors: 16180, dateType: "workday"},
          {date: '2025-04-02', visitors: 15581, dateType: "workday"},
          {date: '2025-04-03', visitors: 16356, dateType: "workday"},
          {date: '2025-04-04', visitors: 30890, dateType: "holiday"}

      ];
      // 使用真实的subject_data.json数据
      const subjectData = [
          { "name": "文学", "borrowing_count": 10442367, "percentage": 61.13 },
          { "name": "艺术", "borrowing_count": 1234651, "percentage": 7.23 },
          { "name": "历史、地理", "borrowing_count": 996970, "percentage": 5.84 },
          { "name": "文化、科学、教育、体育", "borrowing_count": 949105, "percentage": 5.56 },
          { "name": "政治、法律", "borrowing_count": 876543, "percentage": 5.13 },
          { "name": "经济", "borrowing_count": 745678, "percentage": 4.36 },
          { "name": "语言、文字", "borrowing_count": 681075, "percentage": 3.99 },
          { "name": "哲学、宗教", "borrowing_count": 615892, "percentage": 3.61 },
          { "name": "医药、卫生", "borrowing_count": 543210, "percentage": 3.18 },
          { "name": "农业科学", "borrowing_count": 432109, "percentage": 2.53 },
          { "name": "工业技术", "borrowing_count": 321098, "percentage": 1.88 },
          { "name": "数理科学和化学", "borrowing_count": 210987, "percentage": 1.24 },
          { "name": "自然科学总论", "borrowing_count": 176543, "percentage": 1.03 },
          { "name": "天文学、地球科学", "borrowing_count": 154321, "percentage": 0.90 },
          { "name": "生物科学", "borrowing_count": 132109, "percentage": 0.77 },
          { "name": "马克思主义、列宁主义、毛泽东思想", "borrowing_count": 98765, "percentage": 0.58 },
          { "name": "综合性图书", "borrowing_count": 76543, "percentage": 0.45 },
          { "name": "交通运输", "borrowing_count": 65432, "percentage": 0.38 },
          { "name": "航空、航天", "borrowing_count": 54321, "percentage": 0.32 },
          { "name": "环境科学、安全科学", "borrowing_count": 43210, "percentage": 0.25 },
          { "name": "军事", "borrowing_count": 32109, "percentage": 0.19 }
      ];

      // 初始化分时段客流量图表
      const hourlyChart = echarts.init(document.getElementById('hourlyChart'));
      const hourlyOption = {
          tooltip: {
              trigger: 'axis',
              formatter: function(params) {
                  // 获取小时值
                  const hour = params[0].axisValue;
                  // 返回格式化的提示内容
                  return `${hour}:00 - ${hour}:59<br/>平均客流量: ${params[0].value}人次`;
              }
          },
          grid: {
              left: '3%',
              right: '4%',
              bottom: '3%',
              containLabel: true
          },
          xAxis: {
              type: 'category',
              data: hourlyTrendData.map(item => item.hour),
              name: '小时',
              axisLabel: {
                  formatter: '{value}:00'
              }
          },
          yAxis: {
              type: 'value',
              name: '平均客流量（人次）'
          },
          series: [{
              name: '平均客流量',
              type: 'line',
              smooth: true,
              data: hourlyTrendData.map(item => item.average_visitors),
              itemStyle: {
                  color: '#4CAF50'
              },
              areaStyle: {
                  color: {
                      type: 'linear',
                      x: 0,
                      y: 0,
                      x2: 0,
                      y2: 1,
                      colorStops: [{
                          offset: 0,
                          color: 'rgba(76, 175, 80, 0.6)'
                      }, {
                          offset: 1,
                          color: 'rgba(76, 175, 80, 0.1)'
                      }]
                  }
              }
          }]
      };
      hourlyChart.setOption(hourlyOption);

      // 初始化每日客流量图表
      const dailyChart = echarts.init(document.getElementById('dailyChart'));

      // 定义日期类型对应的颜色
      const dateTypeColors = {
          "workday": "#2196F3",  // 工作日蓝色
          "weekend": "#FF9800",  // 周末橙色
          "holiday": "#E91E63"   // 节假日粉红色
      };

      const dailyOption = {
          tooltip: {
              trigger: 'axis',
              formatter: function(params) {
                  const item = timeSeriesData.find(item => item.date === params[0].name);
                  let dateTypeText = '';

                  // 根据日期类型添加不同的文本和颜色
                  if (item && item.dateType === "weekend") { // Check if item exists
                      dateTypeText = '<br/><span style="color:#FF9800">周末</span>';
                  } else if (item && item.dateType === "holiday") { // Check if item exists
                      dateTypeText = '<br/><span style="color:#E91E63">节假日</span>';
                  }

                  return '日期: ' + params[0].name +
                         '<br/>客流量: ' + params[0].value + '人次' + dateTypeText;
              }
          },
          grid: {
              left: '3%',
              right: '4%',
              bottom: '10%', // Increased bottom margin for legend
              containLabel: true
          },
          xAxis: {
              type: 'category',
              data: timeSeriesData.map(item => item.date),
              name: '日期',
              axisLabel: {
                  rotate: 45,
                  interval: 0
              }
          },
          yAxis: {
              type: 'value',
              name: '客流量（人次）'
          },
          series: [{
              name: '客流量',
              type: 'bar',
              data: timeSeriesData.map(item => ({
                  value: item.visitors,
                  itemStyle: {
                      color: dateTypeColors[item.dateType] || '#cccccc' // Default color if type is undefined
                  }
              })),
              emphasis: {
                  itemStyle: {
                      shadowBlur: 10,
                      shadowOffsetX: 0,
                      shadowColor: 'rgba(0, 0, 0, 0.5)'
                  }
              }
          }],
          legend: { // Added legend configuration
              data: [
                  {name: '工作日', itemStyle: {color: dateTypeColors.workday}},
                  {name: '周末', itemStyle: {color: dateTypeColors.weekend}},
                  {name: '节假日', itemStyle: {color: dateTypeColors.holiday}}
              ],
              bottom: 0, // Position legend at the bottom
              itemWidth: 15,
              itemHeight: 10,
              textStyle: {
                  fontSize: 12
              }
          }
      };


      dailyChart.setOption(dailyOption);

      // 初始化借阅书籍分类图表
      const subjectChart = echarts.init(document.getElementById('subjectChart'));
      // 只显示前10个分类，其他归为"其他"
      const topSubjects = subjectData.slice(0, 10);
      const otherSubjects = subjectData.slice(10);
      let otherPercentage = 0;
      let otherCount = 0;
      otherSubjects.forEach(item => {
          otherPercentage += item.percentage;
          otherCount += item.borrowing_count;
      });

      const pieData = topSubjects.map(item => ({
          name: item.name,
          value: item.percentage,
          borrowing_count: item.borrowing_count
      }));

      if (otherPercentage > 0) {
          pieData.push({
              name: '其他',
              value: Number(otherPercentage.toFixed(2)),
              borrowing_count: otherCount
          });
      }

      const subjectOption = {
          tooltip: {
              trigger: 'item',
              formatter: function(params) {
                  // 格式化数字，添加千位分隔符
                  const formattedCount = params.data.borrowing_count.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                  return `${params.seriesName}<br/>${params.name}: ${formattedCount} 本<br/>占比: ${params.value.toFixed(2)}%`;
              }
          },
          legend: {
              orient: 'vertical',
              right: 10,
              top: 'center',
              data: pieData.map(item => item.name)
          },
          series: [{
              name: '借阅分类',
              type: 'pie',
              radius: ['40%', '70%'],
              avoidLabelOverlap: false,
              label: {
                  show: true,
                  formatter: '{b}: {c}%',
                  position: 'outside'
              },
              emphasis: {
                  label: {
                      show: true,
                      fontSize: '18',
                      fontWeight: 'bold',
                      formatter: '{b}: {c}%'
                  }
              },
              labelLine: {
                  show: true
              },
              data: pieData
          }]
      };
      subjectChart.setOption(subjectOption);

      // 响应窗口大小变化，重新调整图表大小
      window.addEventListener('resize', function() {
          hourlyChart.resize();
          dailyChart.resize();
          subjectChart.resize();
      });
  });
</script>

<!-- 成本图表逻辑 -->
<script>
// 确保DOM加载完成
document.addEventListener('DOMContentLoaded', function() {
  // 确保ECharts已加载
  if (typeof echarts === 'undefined') {
      console.error('ECharts库未加载');
      return;
  }

  // 初始化成本构成饼图
  var costChartDom = document.getElementById('costStructurePieChart');
  if (costChartDom) {
      var costChart = echarts.init(costChartDom);
      var costOption = {
          tooltip: {
              trigger: 'item',
              formatter: function(params) {
                  return params.name + ': ' + params.value + '% (' +
                         [1027, 1223, 2617, 1191][params.dataIndex] + '万元)';
              },
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              borderRadius: 8,
              padding: [10, 15],
              textStyle: {
                  fontSize: 14,
                  color: '#fff'
              }
          },
          legend: {
              show: true,
              orient: 'horizontal',
              top: 'top',
              itemWidth: 14,
              itemHeight: 14,
              data: ['房体建设成本', '基础设施', '智慧系统', '图书资源']
          },
          series: [
              {
                  name: '成本构成',
                  type: 'pie',
                  radius: ['0%', '85%'],
                  center: ['50%', '55%'], // Adjusted center
                  avoidLabelOverlap: true,
                  data: [
                      {value: 16.9, name: '房体建设成本'},
                      {value: 20.2, name: '基础设施'},
                      {value: 43.2, name: '智慧系统'},
                      {value: 19.7, name: '图书资源'}
                  ],
                  label: { show: false },
                  labelLine: { show: false },
                  emphasis: {
                      scale: true,
                      scaleSize: 10,
                      itemStyle: {
                          shadowBlur: 10,
                          shadowOffsetX: 0,
                          shadowColor: 'rgba(0, 0, 0, 0.5)'
                      }
                  },
                  itemStyle: {
                      borderWidth: 2,
                      borderColor: '#fff',
                      color: function(params) {
                          var colorList = [
                              'rgba(255, 99, 132, 0.7)',
                              'rgba(54, 162, 235, 0.7)',
                              'rgba(255, 206, 86, 0.7)',
                              'rgba(75, 192, 192, 0.7)'
                          ];
                          return colorList[params.dataIndex];
                      }
                  }
              }
          ]
      };
      costChart.setOption(costOption);
      // 响应窗口大小变化
      window.addEventListener('resize', function() {
          costChart.resize();
      });
       // 确保图表尺寸正确
      setTimeout(function() { costChart.resize(); }, 100);
  } else { console.error("成本构成图表容器未找到"); }


  // 初始化中型书房成本图表
  var midSizeCostChartDom = document.getElementById('midSizeLibraryCostChart');
  if (midSizeCostChartDom) {
      var midSizeCostChart = echarts.init(midSizeCostChartDom);
      var categories = ['房体建设成本', '基础设施/装修/配套', '智慧系统', '图书资源', '其他费用'];
      var avgPercentages = [32.5, 26.5, 27.5, 12.5, 3.5];
      var minAmounts = [40, 35, 35, 15, 5];
      var maxAmounts = [75, 62, 68, 30, 15]; // Corrected values

      var midSizeOption = {
          tooltip: {
              trigger: 'item',
              formatter: function(params) {
                  var index = params.dataIndex;
                  return params.name + '<br>' +
                         '占比: ' + params.value + '% <br>' +
                         '金额区间: ' + minAmounts[index] + '-' + maxAmounts[index] + '万元';
              },
              backgroundColor: 'rgba(50, 50, 50, 0.9)',
              borderRadius: 4,
              padding: [8, 12],
              textStyle: {
                  color: '#fff',
                  fontSize: 14
              }
          },
          series: [
              {
                  name: '成本构成',
                  type: 'pie',
                  radius: ['30%', '55%'],
                  center: ['50%', '40%'],
                  avoidLabelOverlap: true,
                  itemStyle: {
                      borderRadius: 4,
                      borderColor: '#fff',
                      borderWidth: 2
                  },
                  label: {
                      show: true,
                      position: 'outside',
                      formatter: '{b}: {c}%',
                      color: '#333',
                      fontSize: 12,
                      fontWeight: 'bold'
                  },
                  labelLine: {
                      show: true,
                      length: 15,
                      length2: 10,
                      smooth: true
                  },
                  data: avgPercentages.map(function(value, index) {
                      return {
                          value: value,
                          name: categories[index]
                      };
                  }),
                  emphasis: {
                      itemStyle: {
                          shadowBlur: 10,
                          shadowOffsetX: 0,
                          shadowColor: 'rgba(0, 0, 0, 0.5)'
                      },
                      label: {
                          show: true,
                          fontSize: 14,
                          fontWeight: 'bold'
                      }
                  }
              }
          ]
      };
      midSizeCostChart.setOption(midSizeOption);
      // 响应窗口大小变化
      window.addEventListener('resize', function() {
          midSizeCostChart.resize();
      });
       // 确保图表尺寸正确
      setTimeout(function() { midSizeCostChart.resize(); }, 100);
  } else { console.error("中型书房成本图表容器未找到"); }

  // 初始化成本趋势图表
  const costTrendChartDom = document.getElementById('costTrendEChart');
  if (costTrendChartDom) {
      const costTrendChart = echarts.init(costTrendChartDom);
      const years = ['2017', '2018', '2019', '2020', '2021', '2022', '2024'];
      const totalAmounts = [198.13, 8823.60, 6601.05, 3614.06, 499.12, 208.20, 120.00];

      const costTrendOption = {
          color: ['#4a7bff'],
          grid: { top: '8%', left: '5%', right: '5%', bottom: '10%', containLabel: true },
          tooltip: {
              trigger: 'axis',
              backgroundColor: 'rgba(50, 50, 50, 0.9)',
              borderRadius: 4,
              padding: [8, 12],
              formatter: function(params) {
                  const data = params[0];
                  return `<div style="font-size:14px;color:#fff;font-weight:bold;margin-bottom:8px">${data.name}年</div><div style="font-size:13px;color:#fff">合同总金额：${data.value.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} 万元</div>`;
              },
              axisPointer: { type: 'line', lineStyle: { color: '#4a7bff', type: 'dashed', width: 1 } }
          },
          xAxis: {
              type: 'category', data: years, axisTick: { alignWithLabel: true },
              axisLine: { lineStyle: { color: '#999' } },
              axisLabel: { color: '#333', fontSize: 12, formatter: '{value}年' }
          },
          yAxis: {
              type: 'value', name: '合同总金额（万元）', nameTextStyle: { color: '#666', padding: [0, 0, 0, 40] },
              axisLine: { show: false }, axisTick: { show: false },
              splitLine: { lineStyle: { type: 'dashed', color: '#ddd' } },
              axisLabel: {
                  color: '#666',
                  formatter: function(value) {
                      if (value >= 10000) return (value / 10000).toFixed(1) + '万';
                      if (value >= 1000) return (value / 1000).toFixed(1) + 'k';
                      return value;
                  }
              }
          },
          series: [{
              name: '年度合同总金额', type: 'line', smooth: true, symbol: 'circle', symbolSize: 8, data: totalAmounts, z: 3,
              lineStyle: { width: 3, color: '#4a7bff', cap: 'round' },
              itemStyle: { color: '#4a7bff', borderWidth: 2, borderColor: '#ffffff' },
              areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: 'rgba(74, 123, 255, 0.3)' }, { offset: 0.8, color: 'rgba(74, 123, 255, 0.05)' }]) },
              emphasis: { itemStyle: { borderWidth: 3, borderColor: '#ffffff' } },
              markLine: { silent: true, lineStyle: { color: '#999', type: 'dashed', width: 1 }, data: [{ type: 'average', name: '平均值', label: { position: 'middle', formatter: '平均值: {c}', color: '#666' } }] },
              label: {
                  show: true, position: 'top', distance: 5,
                  formatter: function(params) {
                      if (params.value > 1000) return (params.value / 1000).toFixed(1) + 'k';
                      return params.value.toFixed(2); // Show decimals for smaller values
                  },
                  textStyle: { color: '#555', fontSize: 12, fontWeight: 'bold' }
              }
          }]
      };
      costTrendChart.setOption(costTrendOption);
      // 响应窗口大小变化
      window.addEventListener('resize', function() { costTrendChart.resize(); });
       // 确保图表尺寸正确
      setTimeout(function() { costTrendChart.resize(); }, 100);
  } else { console.error("成本趋势图表容器未找到"); }

});
</script>

<script>
  // 反馈图表逻辑 (Plotly + Chart.js)
  document.addEventListener('DOMContentLoaded', function() {
      // --- Plotly Heatmap ---
      function createHeatmap() {
          const level1Categories = ['设施环境问题', '运营服务问题'];
          const departments = ['涧西区', '洛龙区', '瀍河区', '老城区', '西工区', '伊滨区', '孟津区', '文化广电和旅游局', '偃师区', '伊川县'];
          const zValues = [
              [138, 161, 66, 40, 52, 23, 18, 6, 15, 10],
              [176, 132, 54, 45, 63, 32, 35, 78, 17, 21]
          ];
          const customColorScale = [
              [0, 'rgb(255, 255, 220)'], [0.2, 'rgb(217, 240, 211)'], [0.4, 'rgb(173, 221, 208)'],
              [0.6, 'rgb(120, 198, 224)'], [0.8, 'rgb(49, 133, 189)'], [1, 'rgb(8, 29, 88)']
          ];

          var data = [{
              z: zValues, x: departments, y: level1Categories, type: 'heatmap',
              colorscale: customColorScale, showscale: true, hovertemplate: '%{y}-%{x}: %{z}<extra></extra>',
              text: zValues.map(row => row.map(String)), texttemplate: '%{text}',
              textfont: { color: 'black', size: 14, family: 'Arial, sans-serif' }
          }];

          var layout = {
              title: '一级分类与前10个部门关系热力图',
              margin: { l: 120, r: 60, b: 100, t: 50, pad: 4 },
              xaxis: { title: '', tickangle: -45, tickfont: { size: 12 } },
              yaxis: { title: '', tickfont: { size: 12 } },
              annotations: []
          };

          for (let i = 0; i < level1Categories.length; i++) {
              for (let j = 0; j < departments.length; j++) {
                  const value = zValues[i][j];
                  const textColor = value > 100 ? 'white' : 'black';
                  layout.annotations.push({
                      x: departments[j], y: level1Categories[i], text: value.toString(),
                      font: { color: textColor, size: 14 }, showarrow: false
                  });
              }
          }

          var config = { responsive: true, displayModeBar: false };
          Plotly.newPlot('heatmap_container', data, layout, config);
      }

      if (typeof Plotly !== 'undefined') {
          createHeatmap();
      } else {
          console.log('Plotly未加载，尝试动态加载本地版本...');
          var script = document.createElement('script');
          script.src = "static/vendor/plotly/plotly-2.27.1.min.js"; // Use local path
          script.onload = function() { console.log('本地Plotly加载成功'); createHeatmap(); };
          script.onerror = function() { console.error('本地Plotly文件加载失败!'); };
          document.head.appendChild(script);
      }
      window.addEventListener('resize', function() { Plotly.relayout('heatmap_container', { width: document.getElementById('heatmap_container').offsetWidth }); });

      // --- Feedback Trend Chart (ECharts) ---
      const chartDom = document.getElementById('feedbackMonthlyTrendChart');
      if (!chartDom) { console.error("Chart container 'feedbackMonthlyTrendChart' not found."); return; }
      const feedbackChart = echarts.init(chartDom);

      const feedbackTrendData = {
            'all': { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [0, 0, 0, 1, 0, 2, 0, 0, 1, 0, 1, 21], [19, 6, 21, 12, 15, 26, 23, 21, 19, 10, 13, 9], [13, 4, 7, 11, 18, 22, 28, 27, 5, 6, 12, 10], [20, 13, 10, 11, 14, 22, 38, 16, 15, 14, 17, 14], [24, 23, 15, 29, 18, 49, 71, 27, 20, 6, 16, 22], [17, 19, 14, 10, 19, 18, 39, 25, 11, 23, 9, 15], [22, 21, 18, 17, 18, 28, 36, 30, 17, 16, 11, 19], [19, 15, 23, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '咨询': { years: [2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10], [6, 6, 9, 3, 5, 9, 4, 9, 4, 2, 2, 4], [6, 2, 5, 6, 12, 10, 4, 7, 2, 5, 4, 5], [4, 3, 5, 5, 4, 4, 5, 13, 4, 4, 6, 4], [14, 11, 3, 14, 5, 12, 10, 2, 4, 4, 9, 14], [8, 11, 0, 3, 5, 3, 11, 6, 6, 9, 3, 5], [5, 5, 3, 1, 2, 10, 6, 6, 5, 3, 4, 2], [5, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '建议': { years: [2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 1, 0, 2, 0, 0, 1, 0, 1, 9], [7, 0, 5, 3, 7, 4, 12, 9, 8, 5, 7, 4], [4, 1, 2, 4, 3, 6, 8, 6, 0, 0, 4, 3], [5, 4, 3, 1, 0, 9, 12, 1, 1, 3, 1, 5], [7, 2, 8, 8, 6, 17, 18, 10, 6, 0, 3, 1], [1, 1, 5, 1, 2, 3, 11, 5, 0, 3, 1, 5], [8, 4, 5, 2, 3, 3, 7, 4, 2, 6, 1, 3], [4, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '投诉': { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2], [6, 0, 7, 6, 3, 13, 7, 3, 7, 3, 4, 1], [3, 1, 0, 1, 3, 6, 16, 14, 3, 1, 4, 2], [11, 6, 2, 5, 10, 9, 21, 2, 10, 7, 10, 5], [3, 10, 4, 7, 7, 20, 43, 15, 10, 2, 4, 7], [8, 7, 9, 6, 12, 12, 17, 14, 5, 11, 5, 5], [9, 12, 10, 14, 13, 15, 23, 20, 10, 7, 6, 14], [10, 12, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] }
        };

        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = 'text-align: center; margin-bottom: 12px; display: flex; justify-content: center; gap: 10px;';
        chartDom.parentNode.insertBefore(buttonContainer, chartDom);

        const timeScales = ['月度', '季度', '年度'];
        let currentScale = '月度';

        timeScales.forEach(scale => {
            const button = document.createElement('button');
            button.textContent = scale + '趋势';
            button.style.cssText = 'padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; background-color: #f0f0f0; border: 1px solid #ddd;';
            if (scale === currentScale) {
                button.style.backgroundColor = '#1890ff';
                button.style.color = 'white';
                button.style.borderColor = '#1890ff';
            }

            button.addEventListener('click', () => {
                if (scale !== currentScale) {
                    currentScale = scale;
                    updateButtons();
                    updateChart();
                }
            });

            buttonContainer.appendChild(button);
        });

        function updateButtons() {
            const buttons = buttonContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                if (btn.textContent.startsWith(currentScale)) {
                    btn.style.backgroundColor = '#1890ff';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#1890ff';
                } else {
                    btn.style.backgroundColor = '#f0f0f0';
                    btn.style.color = 'black';
                    btn.style.borderColor = '#ddd';
                }
            });
        }

        function flattenMonthlyData(dataObj) { /* ... (Keep the function as before) ... */
            const seriesData = [];
            const xAxisLabels = [];
            const allYears = feedbackTrendData['all'].years;
            const allMonths = feedbackTrendData['all'].months;

            for (let i = 0; i < allYears.length; i++) {
                const year = allYears[i];
                const yearIndexInData = dataObj.years.indexOf(year);

                for (let j = 0; j < allMonths.length; j++) {
                    if (year === 2025 && j >= 3) { // Stop after March 2025
                        break;
                    }
                    const monthLabel = `${year}-${(j + 1).toString().padStart(2, '0')}`;
                    xAxisLabels.push(monthLabel);

                    let value = 0;
                    if (yearIndexInData !== -1 && dataObj.values[yearIndexInData] && dataObj.values[yearIndexInData][j] !== undefined) {
                        value = dataObj.values[yearIndexInData][j];
                    }
                    seriesData.push(value);
                }
            }
            // Ensure labels are unique and sorted if needed, though pushing sequentially should maintain order
            const uniqueXAxisLabels = [...new Set(xAxisLabels)];
            return { data: seriesData, labels: uniqueXAxisLabels };
        }

        function flattenQuarterlyData(dataObj) { /* ... (Keep the function as before) ... */
            const seriesData = [];
            const xAxisLabels = [];
            const allYears = feedbackTrendData['all'].years;

            for (let i = 0; i < allYears.length; i++) {
                const year = allYears[i];
                const yearIndexInData = dataObj.years.indexOf(year);

                for (let q = 0; q < 4; q++) {
                    const startMonth = q * 3;
                    const endMonth = startMonth + 2;

                     // Stop after Q1 2025
                    if (year === 2025 && q > 0) {
                        break;
                    }

                    let quarterTotal = 0;
                    let hasDataInQuarter = false; // Check if any data exists for the quarter

                    if (yearIndexInData !== -1) {
                        for (let m = startMonth; m <= endMonth; m++) {
                            // For 2025 Q1, only include Jan, Feb, Mar
                            if (year === 2025 && m >= 3) {
                                break;
                            }
                            if (dataObj.values[yearIndexInData] && dataObj.values[yearIndexInData][m] !== undefined) {
                                quarterTotal += dataObj.values[yearIndexInData][m];
                                hasDataInQuarter = true;
                            }
                        }
                    }
                    // Only add the quarter if it has data or if it's before the stop point
                    if (hasDataInQuarter || (year < 2025) || (year === 2025 && q === 0)) {
                         xAxisLabels.push(`${year}-Q${q+1}`);
                         seriesData.push(quarterTotal);
                    }
                }
            }
            return { data: seriesData, labels: xAxisLabels };
        }

        function flattenYearlyData(dataObj) { /* ... (Keep the function as before) ... */
            const seriesData = [];
            const xAxisLabels = [];
            const allYears = feedbackTrendData['all'].years;

            for (let i = 0; i < allYears.length; i++) {
                const year = allYears[i];
                const yearIndexInData = dataObj.years.indexOf(year);

                let yearTotal = 0;
                let hasDataInYear = false; // Check if any data exists for the year

                if (yearIndexInData !== -1) {
                    const monthsToSum = (year === 2025) ? 3 : 12; // Only sum first 3 months for 2025
                    for (let m = 0; m < monthsToSum; m++) {
                        if (dataObj.values[yearIndexInData] && dataObj.values[yearIndexInData][m] !== undefined) {
                            yearTotal += dataObj.values[yearIndexInData][m];
                            hasDataInYear = true;
                        }
                    }
                }
                 // Only add the year if it has data
                if (hasDataInYear) {
                    xAxisLabels.push(`${year}`);
                    seriesData.push(yearTotal);
                }
            }
            return { data: seriesData, labels: xAxisLabels };
        }

        function updateChart() { /* ... (Keep the function as before, ensure data processing functions are called correctly) ... */
             let allProcessed, consultationProcessed, suggestionProcessed, complaintProcessed;
            let axisLabelFormatter;

            if (currentScale === '月度') {
                allProcessed = flattenMonthlyData(feedbackTrendData['all']);
                consultationProcessed = flattenMonthlyData(feedbackTrendData['咨询']);
                suggestionProcessed = flattenMonthlyData(feedbackTrendData['建议']);
                complaintProcessed = flattenMonthlyData(feedbackTrendData['投诉']);

                axisLabelFormatter = function (value) {
                    const parts = value.split('-');
                    if (parts[1] === '01') {
                        return parts[0]; // Show year at Jan
                    } else if (['04', '07', '10'].includes(parts[1])) {
                         return `Q${Math.ceil(parseInt(parts[1])/3)}`; // Show Quarter marker
                    }
                    return ''; // Hide other month labels for clarity
                };
            } else if (currentScale === '季度') {
                allProcessed = flattenQuarterlyData(feedbackTrendData['all']);
                consultationProcessed = flattenQuarterlyData(feedbackTrendData['咨询']);
                suggestionProcessed = flattenQuarterlyData(feedbackTrendData['建议']);
                complaintProcessed = flattenQuarterlyData(feedbackTrendData['投诉']);

                axisLabelFormatter = function (value) {
                    return value; // Show "YYYY-QX"
                };
            } else { // 年度
                allProcessed = flattenYearlyData(feedbackTrendData['all']);
                consultationProcessed = flattenYearlyData(feedbackTrendData['咨询']);
                suggestionProcessed = flattenYearlyData(feedbackTrendData['建议']);
                complaintProcessed = flattenYearlyData(feedbackTrendData['投诉']);

                axisLabelFormatter = function (value) {
                    return value; // Show "YYYY"
                };
            }

            const option = {
                tooltip: { trigger: 'axis', axisPointer: { type: 'cross' } },
                legend: {
                    data: ['咨询', '建议', '投诉', '总量'],
                    selected: { '咨询': true, '建议': true, '投诉': true, '总量': false },
                    top: 'bottom',
                    inactiveColor: '#ccc'
                },
                grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true }, // Adjusted bottom margin
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: allProcessed.labels,
                    axisLabel: {
                        rotate: 30,
                        interval: 'auto',
                        formatter: axisLabelFormatter
                    },
                    axisTick: { alignWithLabel: true }
                },
                yAxis: { type: 'value', name: '反馈数量', min: 0, axisLabel: { formatter: '{value}' } },
                dataZoom: [
                    { type: 'inside', start: 0, end: 100 },
                    {
                        start: 0, end: 100, height: 25, bottom: '5%',
                        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                        handleSize: '80%',
                        handleStyle: { color: '#fff', shadowBlur: 3, shadowColor: 'rgba(0, 0, 0, 0.6)', shadowOffsetX: 2, shadowOffsetY: 2 },
                    }
                ],
                series: [
                    { name: '咨询', type: 'line', smooth: true, data: consultationProcessed.data, itemStyle: { color: '#5470C6' }, lineStyle: { width: 2 }, emphasis: { focus: 'series' } },
                    { name: '建议', type: 'line', smooth: true, data: suggestionProcessed.data, itemStyle: { color: '#91CC75' }, lineStyle: { width: 2 }, emphasis: { focus: 'series' } },
                    { name: '投诉', type: 'line', smooth: true, data: complaintProcessed.data, itemStyle: { color: '#EE6666' }, lineStyle: { width: 2 }, emphasis: { focus: 'series' } },
                    { name: '总量', type: 'line', smooth: true, data: allProcessed.data, itemStyle: { color: '#fac858' }, lineStyle: { width: 3, type: 'dashed' }, emphasis: { focus: 'series' } }
                ]
            };

            feedbackChart.setOption(option, true);
        }

        feedbackChart.on('legendselectchanged', function (params) { /* ... (Keep logic as before) ... */
            const isTotalSelected = params.selected['总量'];
            const clickedName = params.name;
            let newSelectedState = { ...params.selected };

            if (clickedName === '总量') {
                if (isTotalSelected) {
                    newSelectedState['咨询'] = false; newSelectedState['建议'] = false; newSelectedState['投诉'] = false;
                } else {
                    // If unselecting total, re-select individuals (or keep their previous state)
                    // For simplicity, let's re-select all individuals if total is unselected
                     newSelectedState['咨询'] = true; newSelectedState['建议'] = true; newSelectedState['投诉'] = true;
                }
            } else {
                // If any individual is selected/deselected, ensure total is off
                const anyIndividualSelected = newSelectedState['咨询'] || newSelectedState['建议'] || newSelectedState['投诉'];
                if (anyIndividualSelected) {
                    newSelectedState['总量'] = false;
                }
                 // Optional: If all individuals are deselected, maybe select total?
                 // else {
                 //    newSelectedState['总量'] = true;
                 // }
            }
            feedbackChart.setOption({ legend: { selected: newSelectedState } });
        });

        window.addEventListener('resize', function () { feedbackChart.resize(); });
        updateChart(); // Initial chart draw
        setTimeout(function() { feedbackChart.resize(); }, 200); // Ensure rendering

        // --- Feedback Heatmap (Plotly) ---
        const feedbackHeatmapData = { /* ... (Keep data as before) ... */
            'all': { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [0, 0, 0, 1, 0, 2, 0, 0, 1, 0, 1, 21], [19, 6, 21, 12, 15, 26, 23, 21, 19, 10, 13, 9], [13, 4, 7, 11, 18, 22, 28, 27, 5, 6, 12, 10], [20, 13, 10, 11, 14, 22, 38, 16, 15, 14, 17, 14], [24, 23, 15, 29, 18, 49, 71, 27, 20, 6, 16, 22], [17, 19, 14, 10, 19, 18, 39, 25, 11, 23, 9, 15], [22, 21, 18, 17, 18, 28, 36, 30, 17, 16, 11, 19], [19, 15, 23, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '咨询': { years: [2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10], [6, 6, 9, 3, 5, 9, 4, 9, 4, 2, 2, 4], [6, 2, 5, 6, 12, 10, 4, 7, 2, 5, 4, 5], [4, 3, 5, 5, 4, 4, 5, 13, 4, 4, 6, 4], [14, 11, 3, 14, 5, 12, 10, 2, 4, 4, 9, 14], [8, 11, 0, 3, 5, 3, 11, 6, 6, 9, 3, 5], [5, 5, 3, 1, 2, 10, 6, 6, 5, 3, 4, 2], [5, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '建议': { years: [2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 1, 0, 2, 0, 0, 1, 0, 1, 9], [7, 0, 5, 3, 7, 4, 12, 9, 8, 5, 7, 4], [4, 1, 2, 4, 3, 6, 8, 6, 0, 0, 4, 3], [5, 4, 3, 1, 0, 9, 12, 1, 1, 3, 1, 5], [7, 2, 8, 8, 6, 17, 18, 10, 6, 0, 3, 1], [1, 1, 5, 1, 2, 3, 11, 5, 0, 3, 1, 5], [8, 4, 5, 2, 3, 3, 7, 4, 2, 6, 1, 3], [4, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] },
            '投诉': { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025], months: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'], values: [ [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2], [6, 0, 7, 6, 3, 13, 7, 3, 7, 3, 4, 1], [3, 1, 0, 1, 3, 6, 16, 14, 3, 1, 4, 2], [11, 6, 2, 5, 10, 9, 21, 2, 10, 7, 10, 5], [3, 10, 4, 7, 7, 20, 43, 15, 10, 2, 4, 7], [8, 7, 9, 6, 12, 12, 17, 14, 5, 11, 5, 5], [9, 12, 10, 14, 13, 15, 23, 20, 10, 7, 6, 14], [10, 12, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0] ] }
        };
        function initFeedbackHeatmap() { /* ... (Keep function as before) ... */
            const selector = document.getElementById('feedback-type-selector');
            const container = document.getElementById('feedback-heatmap');

            function createHeatmap(type) {
                const data = feedbackHeatmapData[type];
                const customColorScale = [ /* ... (Keep colorscale as before) ... */
                    [0, 'rgb(255, 255, 204)'], [0.125, 'rgb(255, 237, 160)'], [0.25, 'rgb(254, 217, 118)'],
                    [0.375, 'rgb(254, 178, 76)'], [0.5, 'rgb(253, 141, 60)'], [0.625, 'rgb(252, 78, 42)'],
                    [0.75, 'rgb(227, 26, 28)'], [0.875, 'rgb(189, 0, 38)'], [1, 'rgb(128, 0, 38)']
                ];
                const heatmapData = [{
                    z: data.values, 
                    x: data.months, 
                    y: data.years, 
                    type: 'heatmap',
                    colorscale: customColorScale, 
                    showscale: true,
                    colorbar: {
                        title: '数量（条）',
                        titleside: 'right',
                        titlefont: {
                            size: 14,
                            family: 'Arial, sans-serif'
                        }
                    },
                    hovertemplate: '%{y}年%{x}: %{z}条反馈<extra></extra>',
                    text: data.values.map(row => row.map(val => val > 0 ? String(val) : '')),
                    texttemplate: '%{text}', 
                    textfont: { size: 12 }
                }];

                const layout = {
                    title: {
                        text: type === 'all' ? '' : `${type}类反馈月度热力图`,
                        font: { size: 18 }
                    },
                    margin: { l: 50, r: 80, b: 80, t: 50, pad: 4 },
                    xaxis: { 
                        title: {
                            text: '月份',
                            font: { size: 14 }
                        }, 
                        side: 'bottom' 
                    },
                    yaxis: { 
                        title: {
                            text: '年份',
                            font: { size: 14 }
                        }, 
                        autorange: 'reversed' 
                    },
                    annotations: []
                };

                 // Add annotations with adjusted text color logic
                const allValuesFlat = data.values.flat().filter(v => v > 0);
                const maxValue = Math.max(...allValuesFlat);
                const midValue = maxValue / 2; // Simple threshold

                for (let i = 0; i < data.years.length; i++) {
                    for (let j = 0; j < data.months.length; j++) {
                        const value = data.values[i] ? data.values[i][j] : 0; // Check if row exists
                        if (value > 0) {
                            const textColor = value > midValue ? 'white' : 'black'; // Dark background -> white text
                            layout.annotations.push({
                                x: data.months[j], y: data.years[i], text: value.toString(),
                                font: { color: textColor, size: 12 }, showarrow: false
                            });
                        }
                    }
                }

                const config = { responsive: true, displayModeBar: false };
                Plotly.newPlot(container, heatmapData, layout, config);
            }

            createHeatmap(selector.value); // Initial draw
            selector.addEventListener('change', function() { createHeatmap(this.value); });
            window.addEventListener('resize', function() { Plotly.relayout('feedback-heatmap', { width: document.getElementById('feedback-heatmap').offsetWidth }); });
        }
        initFeedbackHeatmap(); // Call the heatmap init function

        // --- Feedback Detail Charts (Chart.js) ---
        function initFeedbackDetailCharts() {
            const level1Ctx = document.getElementById('level1FeedbackChart')?.getContext('2d');
            if (level1Ctx) { /* ... (Keep Chart.js doughnut chart logic as before) ... */
                const level1Data = { labels: ['运营服务问题', '设施环境问题', '其他问题'], datasets: [{ label: '反馈数量', data: [789, 594, 56], backgroundColor: ['rgba(255, 159, 64, 0.7)', 'rgba(54, 162, 235, 0.7)', 'rgba(201, 203, 207, 0.7)'], borderColor: ['rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)', 'rgba(201, 203, 207, 1)'], borderWidth: 1 }] };
                new Chart(level1Ctx, { type: 'doughnut', data: level1Data, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels:{ padding: 15 } }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; let value = context.raw || 0; let total = context.chart.getDatasetMeta(0).total; let percentage = ((value / total) * 100).toFixed(1) + '%'; return `${label}: ${value}条 (${percentage})`; } } } }, cutout: '60%' } });
            } else { console.error("Canvas 'level1FeedbackChart' not found."); }

            const level2Ctx = document.getElementById('level2FeedbackChart')?.getContext('2d');
            if (level2Ctx) {
                // 定义一级分类对应的颜色
                const categoryColors = {
                    '运营服务': 'rgba(255, 159, 64, 0.7)',  // 橙色 - 运营服务问题
                    '设施环境': 'rgba(54, 162, 235, 0.7)'   // 蓝色 - 设施环境问题
                };
                
                // 每个二级问题归属的一级分类
                const problemCategories = {
                    '开放时间调整': '运营服务',
                    '人员服务问题': '运营服务',
                    '空间规划与选址': '设施环境',
                    '噪音控制问题': '设施环境',
                    '空调通风系统': '设施环境',
                    '卫生设施问题': '设施环境',
                    '物理设施损坏': '设施环境',
                    '座位资源不足': '设施环境',
                    '照明系统问题': '设施环境',
                    '饮水设施问题': '设施环境'
                };
                
                // 原始标签和数据（已经是reverse顺序）
                const originalLabels = ['开放时间调整', '人员服务问题', '空间规划与选址', '噪音控制问题', '空调通风系统', '卫生设施问题', '物理设施损坏', '座位资源不足', '照明系统问题', '饮水设施问题'].reverse();
                const originalData = [409, 304, 300, 86, 75, 67, 49, 47, 26, 18].reverse();
                
                // 生成每个条形的背景颜色数组
                const backgroundColors = originalLabels.map(label => {
                    const category = problemCategories[label];
                    return category ? categoryColors[category] : 'rgba(201, 203, 207, 0.7)'; // 默认灰色
                });
                
                // 生成每个条形的边框颜色数组（稍深一点的颜色）
                const borderColors = backgroundColors.map(color => {
                    return color.replace('0.7', '1'); // 边框使用不透明的颜色
                });
                
                const level2Data = {
                    labels: originalLabels,
                    datasets: [{
                        label: '反馈数量',
                        data: originalData,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                };
                
                new Chart(level2Ctx, {
                    type: 'bar',
                    data: level2Data,
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const category = problemCategories[label] || '其他';
                                        return `${category}类问题: ${context.raw}条`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: { display: true, text: '反馈数量（条）' }
                            },
                            y: {
                                ticks: { font: { size: 11 } }
                            }
                        }
                    }
                });
            } else {
                console.error("Canvas 'level2FeedbackChart' not found.");
            }
        }
         // Call Chart.js init after DOM is ready and Chart.js is confirmed loaded
        if (typeof Chart !== 'undefined') {
             initFeedbackDetailCharts();
         } else {
             console.error("Chart.js not loaded, cannot initialize feedback detail charts.");
             // Optionally add retry logic or user notification
         }

        // --- National Distribution Chart (ECharts) ---
        const nationalChartDom = document.getElementById('nationalDistributionChart');
        if (nationalChartDom) {
            const nationalChart = echarts.init(nationalChartDom);
            const nationalDataRaw = [ /* ... (Keep national data as before) ... */
                { name: '浙江', value: 531, cities: [ {name: '温州', value: 172}, {name: '台州', value: 102}, {name: '绍兴', value: 75}, {name: '衢州', value: 42}, {name: '湖州', value: 35}, {name: '嘉兴', value: 31}, {name: '舟山', value: 21}, {name: '宁波', value: 18}, {name: '丽水', value: 14}, {name: '杭州', value: 12}, {name: '金华', value: 9} ]},
                { name: '河南', value: 353, cities: [ {name: '洛阳', value: 204}, {name: '郑州', value: 89}, {name: '驻马店', value: 27}, {name: '开封', value: 22}, {name: '南阳', value: 8}, {name: '焦作', value: 3} ]},
                { name: '广东', value: 233, cities: [ {name: '佛山', value: 188}, {name: '韶关', value: 35}, {name: '深圳', value: 10} ]},
                { name: '山东', value: 232, cities: [ {name: '济南', value: 53}, {name: '淄博', value: 45}, {name: '威海', value: 44}, {name: '济宁', value: 37}, {name: '日照', value: 25}, {name: '临沂', value: 14}, {name: '菏泽', value: 14} ]},
                { name: '江苏', value: 170, cities: [ {name: '苏州', value: 64}, {name: '扬州', value: 51}, {name: '常州', value: 41}, {name: '连云港', value: 9}, {name: '常熟', value: 5} ]},
                { name: '安徽', value: 169, cities: [ {name: '合肥', value: 99}, {name: '芜湖', value: 46}, {name: '铜陵', value: 16}, {name: '淮北', value: 5}, {name: '滁州', value: 3} ]},
                { name: '上海', value: 120, cities: [{name: '上海', value: 120}]},
                { name: '湖北', value: 68, cities: [ {name: '武汉', value: 52}, {name: '孝感', value: 8}, {name: '黄冈', value: 6}, {name: '宜昌', value: 2} ]},
                { name: '江西', value: 59, cities: [ {name: '南昌', value: 37}, {name: '九江', value: 20}, {name: '萍乡', value: 2} ]},
                { name: '内蒙古', value: 58, cities: [{name: '呼和浩特', value: 58}]},
                { name: '北京', value: 57, cities: [{name: '北京', value: 57}]},
                { name: '河北', value: 38, cities: [ {name: '沧州', value: 19}, {name: '唐山', value: 13}, {name: '廊坊', value: 6} ]},
                { name: '天津', value: 28, cities: [{name: '天津', value: 28}]},
                { name: '重庆', value: 27, cities: [{name: '重庆', value: 27}]},
                { name: '山西', value: 26, cities: [{name: '太原', value: 18}, {name: '晋中', value: 8}]}
            ];
            nationalDataRaw.sort((a, b) => b.value - a.value);
            const nationalData = nationalDataRaw.slice(0, 15);

            function createProvinceOption() { /* ... (Keep function as before) ... */
                 return {
                    title: { text: '全国城市书房分布', left: 'center', top: 10, subtext: '点击省份条形图可查看省内城市书房分布详情', subtextStyle: { color: '#666', fontSize: 12 } },
                    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' }, formatter: '{b}: {c} 家' },
                    grid: { left: '3%', right: '4%', bottom: '3%', top: '80px', containLabel: true },
                    xAxis: { type: 'value', boundaryGap: [0, 0.01], name: '数量 (家)' },
                    yAxis: { type: 'category', data: nationalData.map(item => item.name).reverse(), axisLabel: { interval: 0 } },
                    series: [{ name: '城市书房数量', type: 'bar', data: nationalData.map(item => item.value).reverse(), itemStyle: { color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{ offset: 0, color: '#83bff6' }, { offset: 0.5, color: '#188df0' }, { offset: 1, color: '#188df0' }]) }, emphasis: { itemStyle: { color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{ offset: 0, color: '#2378f7' }, { offset: 0.7, color: '#2378f7' }, { offset: 1, color: '#83bff6' }]) } } }]
                };
            }
            function createCityOption(province) { /* ... (Keep function as before) ... */
                const cityData = nationalDataRaw.find(item => item.name === province)?.cities || []; // Add default empty array
                 cityData.sort((a, b) => b.value - a.value);

                 return {
                     title: { text: `${province}省城市书房分布`, left: 'center', top: 10 },
                     tooltip: { trigger: 'item', formatter: '{b}: {c} 家 ({d}%)' },
                     legend: { orient: 'vertical', right: 10, top: 'center', type: 'scroll' },
                     series: [{
                         name: '城市分布', type: 'pie', radius: ['40%', '70%'], center: ['50%', '55%'],
                         avoidLabelOverlap: true,
                         itemStyle: { borderRadius: 10, borderColor: '#fff', borderWidth: 2 },
                         label: { show: true, formatter: '{b}\n{c}家 ({d}%)' },
                         emphasis: { label: { show: true, fontSize: '18', fontWeight: 'bold' } },
                         data: cityData
                     }]
                 };
            }

            nationalChart.setOption(createProvinceOption());
            nationalChart.on('click', function(params) { /* ... (Keep logic as before, ensure back button works) ... */
                 const provinceName = params.name;
                 const provinceData = nationalDataRaw.find(item => item.name === provinceName);

                 if (provinceData && provinceData.cities && provinceData.cities.length > 0) { // Check if cities exist
                     nationalChart.setOption(createCityOption(provinceName));

                     // Remove existing back button if any
                     const existingButton = nationalChart.getDom().parentNode.querySelector('.back-to-province');
                     if (existingButton) existingButton.remove();

                     const backButton = document.createElement('button');
                     backButton.textContent = '返回省份分布';
                     backButton.className = 'back-to-province'; // Add class for easy selection
                     backButton.style.cssText = 'position: absolute; left: 20px; top: 20px; z-index: 100; padding: 8px 15px; background-color: #188df0; color: white; border: none; border-radius: 4px; cursor: pointer;';

                     backButton.addEventListener('click', function() {
                         nationalChart.setOption(createProvinceOption());
                         this.remove();
                     });

                     nationalChart.getDom().parentNode.appendChild(backButton);
                 }
            });
            window.addEventListener('resize', function() { nationalChart.resize(); });
            setTimeout(function() { nationalChart.resize(); }, 200); // Ensure rendering
        } else { console.error("全国分布图表容器未找到"); }

        // --- Modal Logic ---
        const modal = document.getElementById('libraryModal');
        const closeButton = modal?.querySelector('.close-button'); // Use optional chaining
        const libraryCards = document.querySelectorAll('.showcase-item.library-card');

        const libraryDetails = { /* ... (Keep details as before) ... */
            'shangyang': { name: "上阳宫城市书房", image: "static/picture/shangyang-library.jpg", features: "坐落于上阳宫文化园内，建筑风格与园区唐风遗韵巧妙融合，提供沉浸式历史文化阅读体验。（注：该书房目前正在进行搬迁升级，具体开放信息请关注官方公告）", stats: { "类型": "历史文脉型 / 景区融合", "原面积": "约 200 ㎡", "原座席": "约 60 个", "原藏书量": "约 7,000 册", "特色": "唐风古韵，环境典雅，文旅结合", "当前状态": "<strong style='color:orange;'>搬迁升级中</strong>" }, description: "作为历史文脉型书房的代表，原上阳宫城市书房不仅是一个阅读空间，更是体验唐代宫廷文化、感受古都魅力的窗口。它将阅读服务与历史文化景区有机结合，吸引了大量市民和游客。目前，该书房正在进行搬迁升级，期待未来以崭新的面貌重新服务读者，具体信息请以官方发布为准。" },
            'yirenfang': { name: "宜人坊城市书房 (洛龙区最大)", image: "static/picture/yiren-library.jpg", features: "由4S店改造升级，保留现代工业风设计，通过绿植与落地窗营造开放而静谧的阅读氛围。荣获河南省新型公共文化空间典型案例。", stats: { "类型": "空间改造共建型", "面积": "超 1000 ㎡", "座席": "150 余个", "藏书量": "配备 2 万余册", "开放时间": "自2019年开放 8:30-21:30" }, description: "宜人坊城市书房是洛阳探索“空间改造+社会参与”模式的杰出范例。它将闲置的大型商业空间巧妙转型为公共文化地标，不仅极大地拓展了阅读服务覆盖面，更以其独特的设计感、丰富的藏书和完善的便民设施（如水吧、儿童区），成为备受市民喜爱的“文化客厅”和社交空间。其成功经验为盘活城市存量资产、实现文化功能植入提供了宝贵借鉴。" },
            'community_park': { name: "伊川县西山植物园城市书房", image: "static/picture/yichuan-library.jpg", features: "嵌入风景优美的西山植物园中，环境宜人，将阅读与自然休闲完美结合，服务周边社区居民及公园游客。", stats: { "类型": "社区嵌入型 / 公园型", "面积": "105 ㎡", "座席": "42", "藏书量": "约 5,000-6,000 册 (标准配置)", "特色": "环境优美，亲近自然，服务社区及游客" }, description: "此类“小而美”的书房是“河洛书苑”网络的重要组成部分，它们如同散落在社区公园里的“文化珍珠”，将阅读的便利送到了市民的日常生活中。西山植物园书房充分利用了公园的优美环境，为市民和游客提供了一个可以在鸟语花香中休憩、阅读的宁静角落，体现了公共文化服务的人性化关怀和与城市绿色空间的融合。" }
        };

        if (modal && closeButton && libraryCards.length > 0) {
            libraryCards.forEach(card => {
                card.addEventListener('click', function() { /* ... (Keep logic as before) ... */
                    const libraryId = this.getAttribute('data-library-id');
                    const details = libraryDetails[libraryId];

                    if (details) {
                        document.getElementById('modal-library-name').textContent = details.name;
                        document.getElementById('modal-library-image').src = details.image;
                        document.getElementById('modal-library-image').alt = details.name + " 图片";
                        document.getElementById('modal-library-features').textContent = details.features;
                        document.getElementById('modal-library-description').textContent = details.description;
                        const statsList = document.getElementById('modal-library-stats');
                        statsList.innerHTML = '';
                        if (details.stats) {
                            for (const key in details.stats) {
                                const li = document.createElement('li');
                                li.innerHTML = `<i class="fas fa-check-circle" style="color:#28a745; margin-right: 8px; font-size: 0.9em;"></i><strong>${key}:</strong> ${details.stats[key]}`;
                                statsList.appendChild(li);
                            }
                        }
                        modal.style.display = 'flex';
                         // Trigger reflow/repaint before adding class for animation
                         modal.offsetHeight;
                         modal.classList.add('show');
                    } else { console.error("Details not found for library ID:", libraryId); }
                });
            });

            function closeModal() {
                 modal.classList.remove('show');
                 // Wait for fade out animation before hiding
                 setTimeout(() => {
                     modal.style.display = 'none';
                 }, 300); // Match animation duration
            }

            closeButton.addEventListener('click', closeModal);
            modal.addEventListener('click', function(event) { if (event.target === modal) { closeModal(); } });
            document.addEventListener('keydown', function(event) { if (event.key === "Escape" && modal.style.display === 'flex') { closeModal(); } });

        } else { console.error("Modal elements not found. Modal functionality disabled."); }
    });
</script>

</body>
</html>